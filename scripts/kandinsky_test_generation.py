import io
import sys
import os
import uuid
import torch


base_directory = os.getcwd()
sys.path.insert(0, base_directory)

from utility.http import generation_request
from utility.http import request
from utility.minio.cmd import connect_to_minio_client, upload_data
from worker.generation_task.generation_task import GenerationTask
from kandinsky_worker.dataloaders.image_embedding import ImageEmbedding

def read_msgpack_file(file_path):
    """Reads a msgpack file and returns its bytes."""
    with open(file_path, "rb") as f:
        return f.read()

def generate_img2img_generation_jobs_with_kandinsky(image_embedding,
                                                    negative_image_embedding,
                                                    dataset_name,
                                                    prompt_generation_policy,
                                                    self_training= False,
                                                    init_img_path="./test/test_inpainting/white_512x512.jpg"):

    # get sequential ids
    sequential_ids = request.http_get_sequential_id(dataset_name, 1)

    count = 0
    # generate UUID
    task_uuid = str(uuid.uuid4())
    task_type = "img2img_generation_kandinsky"
    model_name = "kandinsky_2_2"
    model_file_name = "kandinsky-2-2-decoder"
    model_file_path = "input/model/kandinsky/kandinsky-2-2-decoder"
    task_input_dict = {
        "strength": 0.75,
        "seed": "",
        "dataset": dataset_name,
        "file_path": sequential_ids[count]+".jpg",
        "init_img": init_img_path,
        "num_images": 1,
        "image_width": 512,
        "image_height": 512,
        "decoder_steps": 100,
        "decoder_guidance_scale": 12,
        "self_training": self_training
    }

    prompt_generation_data={
        "prompt_generation_policy": prompt_generation_policy
    }

    image_embedding= image_embedding.detach().cpu().numpy().tolist()[0]
    negative_image_embedding= image_embedding.detach().cpu().numpy().tolist()[0] if negative_image_embedding is not None else None

    # create the job
    generation_task = GenerationTask(uuid=task_uuid,
                                     task_type=task_type,
                                     model_name=model_name,
                                     model_file_name=model_file_name,
                                     model_file_path=model_file_path,
                                     task_input_dict=task_input_dict,
                                     prompt_generation_data=prompt_generation_data)
    generation_task_json = generation_task.to_dict()

    # add job
    response = generation_request.http_add_kandinsky_job(job=generation_task_json,
                                                         positive_embedding=image_embedding,
                                                         negative_embedding=negative_image_embedding)

    return response


if __name__ == "__main__":
    image_embedding_list = [-0.8106171137869465, 0.24239269647453257, -0.9509251938616278, -0.42745019743681995, 0.2927357949730893, 0.4281494071381888, -0.2236305694878019, 0.22596126849236473, -1.0366949172295392, -0.3896928735629024, -0.40507548699301693, -0.9350764406306007, 0.22071719573209841, 0.1834260116590934, 0.5052955441892178, 0.4941081889673164, -0.23353604025719388, 0.14357105868106929, 0.39738418027795963, 0.016154657475376, -0.3673181631190994, 0.12550814139570748, -0.5402560292576601, -0.3304931188470069, 0.3020585909913406, -0.03650457315896506, 0.4903790705600159, -0.5379253302530973, -0.7197198526089967, 0.10878537603796931, -0.27875160094571244, -1.1103450057737243, -0.4113683743053365, -0.5808101919370531, 0.4642752417089124, 0.03676677679697838, 0.2857436979594009, -0.0536060771049447, 0.15067969064498588, 0.7859117043385806, 0.4791917153381144, 0.14508601303403512, -0.21873610157822002, -0.11222315706969946, 0.36941579222320586, 0.18016303305270545, -1.3014623241478749, -0.6083124401908943, -0.054684025394555004, -0.5155506198092943, 0.21535658802160393, -0.773792069514854, -0.5341962118457968, -0.31883962382419284, 0.07702960210080098, 0.36871658252183703, -0.755612617279264, -0.16897567783080394, 0.10697908430943312, 0.26243670791377277, -0.1459017576856321, -0.019665272850998738, 1.9633808414437137, -0.258474519606016, 0.1482324566901949, 0.046264375240571844, 0.19414722708008234, -0.21628886762342905, -0.45611779519294254, 0.18016303305270545, 0.4586815640979616, 0.35589773799674157, 0.676834990925041, 0.01229443724906884, -0.45332095638746717, 0.1619835808171155, 0.7099309167898329, 0.13075221415597382, 0.48385311334724, -1.0171170455912117, -0.7388315844464117, -0.14357105868106929, -0.4528548165865546, -0.04530296190118968, -0.2034700230983336, 0.4871160919536279, 1.2324736336128157, 0.7430268426546248, 0.2694288049274612, 0.5290686740357586, -0.06088951149420349, 0.09940431254460398, -0.7551464774783515, 0.29390114447537075, -0.4654405912111938, 0.018936929412072857, -0.2668650360224421, 0.40577469669438576, -0.7351024660391112, -0.6521295814766751, -0.48478539294906514, -0.43351001484868323, -0.17783233404814264, -0.6707751735131776, 0.9956746147492338, -0.03187230888739647, -0.4032109277893667, 0.12935379475323613, -0.8842672023311313, 0.3416804740689084, -0.4694027795189506, -0.5579693416923375, 0.35543159819582903, -0.5644952989051133, -0.11869084680736126, -0.24635488478228934, 0.8413823406471755, 0.14869859649110748, 0.1333159830609929, -0.14007501017422508, 0.24868558378685215, -0.4833869735463274, -0.2456556750809205, 0.43234466534640187, -0.43351001484868323, -0.032454983638537174, -0.046613980091256266, 0.5747503745251897, 0.5924636869598671, 0.12376011714228538, 0.03493135133088516, -0.5411883088594852, 0.1694418176317165, -0.12387665209251351, -0.5836070307425284, -0.7570110366820018, 0.009526732181150499, 0.10639640955829242, -0.3020585909913406, -0.6465359038657243, 1.443168823625294, 1.1420425122357785, -0.1694418176317165, -0.15196157509749542, -0.4111353044048802, -0.7420945630527997, 0.9374071396351634, 0.570088976516064, -0.17223865643719188, 0.3540331787930913, -0.32723014024061897, -0.3020585909913406, -0.10033659214642911, 1.2697648176858207, -0.4787255755372018, 0.2710602942306552, -0.17387014574038587, -0.38339998625058275, 0.681030249133254, -0.21372509871840997, -0.0120540839142233, -0.04180691339434546, 0.38339998625058275, -0.5076262431937807, 0.43840448275826516, -0.5006341461800923, 0.2000905095417175, -0.44935876807971037, -0.4703350591207757, 0.013845808773980962, -0.2032369531978773, -0.021063692253736423, -0.02284085024471557, 0.18494096601205923, -0.5379253302530973, -0.2235140345375738, 0.5458497068686109, -0.3843322658524079, 0.32862855964335663, -0.1246923967441105, -0.47336496782670734, 0.6996758411697566, 0.010684798249042646, -0.7360347456409364, -0.15895367211118386, 0.05319820477914621, 0.40927074520122997, -0.17468589039198285, -0.12189555793863513, 0.3899259434633586, -0.4516894670842732, 0.20486844250107128, 0.6194997954127958, 0.80036203816687, -0.09678227616447081, -0.13459786751350247, -0.5761487939279274, -0.2705941544297426, -0.5421205884613104, 1.405877639552289, -0.1272561656491296, 0.06694932890606681, -1.8347262563918465, -0.22444631413939892, -0.14636789748654466, 0.3465749419784903, -0.09031458642680901, -0.4726657581253385, 2.724120996533016, -0.19298187757780094, -0.49177748996275356, 0.4365399235546149, 0.015470014642785673, -0.4339761546495958, 0.42745019743681995, -0.09619960141333012, -0.4053085568934732, -0.5649614387060259, -0.15196157509749542, 0.028958935131692953, 0.5188135984156822, -0.2109282599129346, -1.140177953032128, 0.34074819446708327, 0.4116014442057928, -0.28667597756122604, -0.142522244129016, 0.08139966273435625, 1.1951824495398107, -0.5938621063626048, 1.2753584952967714, 0.06572571192867133, -0.07196033176587685, 0.165712699224416, -0.05905408602811028, 0.4796578551390269, -0.227010083044418, 0.806887995379646, 0.2201345209809577, -0.35263475939035366, -0.1097759231149085, -0.539323749655835, -0.7295087884281605, 0.32000497332647426, 0.5388576098549224, -0.23435178490879086, -0.39808338997932846, 0.10121060427314016, 0.584073170543441, 0.7649354132975152, 0.06275407069785374, 1.4189295539778406, -1.0814443381171452, 0.6302210108337847, -0.48944679095819077, -0.7915053819495314, -0.6525957212775877, 0.17200558653673562, -0.8176092108006349, 0.07726267200125726, 0.04460375219982084, -0.8101509739860339, -0.6474681834675495, -0.07120285458939395, -1.0301689600167634, -0.8087525545832962, -0.9490606346579775, 0.15860406726049944, 0.5780133531315776, -0.41276679370807423, -1.2091666435671875, 0.10534759500623915, -0.1702575622833135, 0.3318915382497446, -0.44073518176282794, -0.28364606885529436, -0.7542141978765263, 0.8800719441229182, 0.49177748996275356, 0.6567909794858008, -0.807820274981471, 0.5146183402074691, -0.23551713441107228, 0.38013700764419484, 0.7733259297139414, -0.19065117857323813, 0.6153045372045827, 0.13611282186646828, 0.6400099466529485, 0.8712152879055796, 0.18867008441935973, -1.9764327558692656, -0.6428067854584238, -0.5635630193032882, -0.10907671341353965, -0.45705007479476767, 0.23038959660103409, 0.02656996865201607, -0.49317590936549127, 0.22596126849236473, 0.35589773799674157, 0.01500387484187311, 0.14555215283494768, 0.5174151790129445, 0.6185675158109706, -0.3344553071547637, -0.28387913875575066, 0.17328747098924516, -0.5150844800083817, 0.18319294175863712, -1.2557806236584437, -0.013219433416504707, 0.7467559610619253, -0.35589773799674157, 0.9928777759437584, -0.5355946312485345, -0.4428328108669345, 0.5738180949233646, -0.30905068800502905, 0.5020325655828299, 0.11402944879823564, -0.8721475675074047, 0.0338825367788319, 0.0338825367788319, -1.5438550206224075, 0.12317744239114467, 0.8199399098051977, 0.06240446584716932, 0.2906381658689828, 0.07644692734966027, 0.031056564235799486, 0.3020585909913406, 0.2656996865201607, -0.15067969064498588, -0.7467559610619253, 0.04259352430838541, 1.5373290634096315, 0.16326546526962507, -1.2492546664456678, -0.13063567920574568, 2.228148248362049, 0.03286285596433566, -1.034830358025889, 1.2362027520201162, 0.03114396544847059, -0.3318915382497446, -0.5761487939279274, 0.5598339008959877, 0.5859377297470912, -0.13599628691624016, 0.6353485486438228, -0.14403719848198185, -0.89312385854847, -0.1264404209975326, -0.40880460540031743, -0.3680173728204682, -0.4216234499254129, 0.3342222372543074, 0.0598989644172643, 0.06805641093323414, -0.4715004086230571, -0.17783233404814264, 1.4543561788471955, 0.40973688500214256, -0.6274241720283094, 0.34004898476571443, -0.491311350161841, 0.5052955441892178, -0.691751464554243, 0.7169230138035213, -0.1301695394048331, -0.28644290766076974, -0.5048294043883054, 0.46730515041484405, 0.271759503932024, -0.9038450739694589, -0.922956805806874, -0.1072121542098894, -0.6446713446620741, 1.004997410767485, 0.8502389968645142, 0.14869859649110748, -0.6283564516301344, -0.2563768905019094, 0.21908570642890443, 0.3824677066487576, 0.9150324291913604, -0.05025569728588566, 1.1495007490503795, -0.06537610707798691, -0.8884624605393444, 0.822736748610673, -0.5430528680631355, 0.07644692734966027, 0.13960887037331252, 0.27129336413111144, -1.1970470087434608, 0.40204557828708526, 0.2894728163667014, -0.2236305694878019, -0.135879751966012, -1.4562207380508456, -0.6190336556118832, -0.4866499521527154, -0.33259074795111343, -0.4579823543965928, 0.5197458780175074, 0.5747503745251897, 0.47336496782670734, 0.015994421918812306, -0.36988193202411845, 0.20451883765038686, 0.5346623516467094, 0.271759503932024, -0.3745433300332441, -1.0264398416094629, 1.041356315238665, -0.9467299356534147, -0.528602534234846, 0.23540059946084413, 1.15322986745768, 0.03242584990098014, 0.20859756090837178, -0.06759027113232158, -1.1821305351142588, -0.2232809646371175, -0.091130331078406, 0.23108880630240292, -0.34890564098305316, 0.5155506198092943, 0.38852752406062097, -0.43234466534640187, -0.10400744307861554, 0.2040526978494743, 0.35496545839491644, -0.5374591904521847, 0.10208461639985121, 0.060481639168405, -0.7938360809540942, -0.21022905021156574, 0.5719535357197143, 0.25031707309004614, -0.6003880635753807, 0.1911173183741507, 0.16093476626506226, -0.3498379205848783, 0.4861838123518028, 0.2521816322936964, -0.15685604300707734, -0.22689354809418985, -0.19612832123396073, -0.09002324905123865, -0.569156696914239, -0.23365257520742203, -0.7723936501121162, 0.003747326993273648, -0.42022503052267524, 0.16070169636460596, -0.41602977231446214, -0.19135038827460696, 0.3391167051638893, -0.1570891129075336, -0.0730674137930442, -0.2608052186105788, -0.4223226596267817, 0.10295862852656228, -0.2416934867731637, 0.785445564537668, -1.034830358025889, 0.45938077379933046, 0.3022916608917969, 0.10610507218272207, -0.394354271572028, 0.5472481262713486, 0.7980313391623072, -0.65119730187485, 0.3029908705931657, 0.2482194439859396, 0.3055546394981848, -0.9425346774452017, -0.28714211736213857, -0.3712803514268561, 0.24472339547909538, -0.1679268632787507, -0.19741020568647027, -0.8716814277064922, 0.3976172501784159, 0.0820988724357251, 0.4363068536541586, 0.8609602122855032, 0.531865512841234, 0.3267640004397064, 0.017043236470865572, -0.21570619287228837, -0.3675512330195556, -0.04856594050757762, 0.24192655667362, 0.5686905571133264, 0.6493327426711998, 0.14228917422855974, -0.43817141285780886, -0.6041171819826812, 0.24262576637498884, 0.5052955441892178, -0.015615683330570848, -0.5509772446786491, -0.043758873810666815, 0.5472481262713486, 0.2955326337785647, 0.2275927577955587, -0.03726205033544797, -0.13075221415597382, 0.6675121949067897, -0.3896928735629024, -0.4213903800249566, -0.10878537603796931, 0.22782582769601498, -1.2222185579927392, 0.3673181631190994, 0.10552239743158137, 0.2026542784467366, 0.013758407561309857, 0.40460934719210434, -0.6525957212775877, -0.8022265973705203, 0.28387913875575066, -0.02608926198232499, -0.7817164461303675, -0.3102160375073104, -0.010961568755834481, -0.7840471451349303, 0.415097492712637, -1.027372121211288, 0.8618924918873283, -0.05523756640813867, 0.008019061262573929, 0.0026074695113546473, 0.42978089644138273, 0.4185935412194812, 0.6987435615679314, 0.8278642864207112, 0.5547063630859496, 1.101022209755473, -0.7262458098217726, -0.24379111587727026, 0.5080923829946933, -0.054043083168300234, -0.16408120992122205, 0.24029506737042602, 0.7509512192701384, 0.2563768905019094, -0.08297288456243615, -0.26546661661970444, 0.0541013506434143, -0.08093352293344369, -0.021748335086326752, -0.4377052730568963, -0.20766528130654666, 0.7276442292245102, -0.6348824088429104, 0.2743232728370431, 0.1215459530879507, -0.733237906835461, -0.4871160919536279, -0.15930327696186827, 0.34867257108259686, 0.9206261068023112, -0.5122876412029064, -0.6824286685359917, -0.07866109140399495, -0.5654275785069385, -0.15289385469932054, -0.34377810317301494, 0.13483093741395874, -0.5225427168229827, -0.8926577187475574, 0.4715004086230571, -0.46310989220663096, 0.5593677610950751, -0.21279281911658485, -0.42861554693910137, 0.5947943859644299, 0.28970588626715765, 0.39854952978024105, 0.13366558791167735, -0.07021230751245475, 0.2295738519494371, -0.5267379750311958, 0.37617481933643804, -0.4437650904687596, -0.7043372391788821, -0.20615032695358082, 0.09450984463502207, 0.9411362580424639, 0.2994948220863215, 0.0492942839465035, 0.20941330555996876, 0.666113775504052, 0.8698168685028419, 0.23563366936130042, 0.18062917285361801, 0.10569719985692358, -0.023379824389520718, 0.8847333421320439, 0.5425867282622229, 1.1215323609956256, 0.6647153561013143, -1.0133879271839112, -0.08477917629097233, -0.43467536435096465, -0.009971021678895286, -0.20673300170472153, -0.18097877770430243, 0.18983543392164112, 0.3099829676068542, 0.43374308474913953, -0.27945081064708127, 0.6143722576027576, -0.513686060605644, -0.04760452716819546, 0.46380910190799984, 0.2698949447283738, 0.6912853247533304, 0.39248971236837776, -0.5411883088594852, -0.28644290766076974, -0.1627993254687125, 0.05127537810038189, 0.05485882781989721, 0.41299986360853047, 0.5654275785069385, 0.028842400181464813, -0.07551464774783515, 1.033898078424064, 0.024137301566003633, -0.20708260655540595, 0.15242771489840798, -0.18016303305270545, 0.8190076302033725, 0.6278903118292218, -0.15429227410205823, 1.1345842754211775, 0.5971250849689927, -0.7164568740026087, -0.42325493922860685, 0.5598339008959877, -0.6246273332228339, -0.22293135978643308, 0.8176092108006349, 0.19333148242848536, 0.34890564098305316, -0.45215560688518575, 0.057276928037131136, 0.18680552521570948, 0.14485294313357883, 0.24215962657407628, -0.0677650735576638, -0.08565318841768338, -1.2073020843635371, -0.028827833312686294, -0.44586271957286616, -0.13681203156783714, -0.12550814139570748, -0.15114583044589844, 0.06345328039922259, 0.06828948083369042, 0.18995196887186927, -0.6460697640648118, -0.055528903783709026, 0.012818844525095472, 0.3202380432269305, 0.11927352155850196, 1.0469499928496158, -0.34750722158031544, 0.8851994819329564, -0.2622036380133165, 0.2885405367648763, -0.16850953802989138, -0.19741020568647027, 0.4204581004231315, 0.6241611934219213, -0.1386765907714874, -0.04868247545780576, -0.3316584683492883, -0.5603000406969003, 0.8749444063128801, -0.2556776808005406, 0.04154470975633214, 1.1336519958193523, 0.40996995490259885, -0.424187218830432, -0.9457976560515896, 0.1056389323818095, 0.09876337031834921, 0.025958160163318332, 0.1785315437495115, -0.34843950118214057, 0.025885325819425743, 0.3353875867565888, -0.6856916471423796, 0.20416923279970242, 0.5864038695480038, 0.008543468538600562, 0.08810042237247434, 0.040612430154507016, 0.12877112000209542, 0.536060771049447, -0.21826996177730745, -1.027372121211288, 0.04667224756637033, -0.7211182720117344, 0.42348800912906315, 0.2952995638781084, 0.2563768905019094, -0.5458497068686109, 0.15452534400251453, -0.23178801600377177, 0.21081172496270645, 0.8875301809375192, 0.4029778578889104, 0.12504200159479492, -1.004997410767485, 0.15638990320616478, -0.31534357531734863, -0.33492144695567627, -0.7486205202655756, 0.3251325111365124, -0.29879561238495267, 0.2682634554251798, 0.033066792127234915, -0.681030249133254, 0.024923912480043584, -0.74395912225645, -0.6278903118292218, 0.21279281911658485, 0.6031849023808561, -0.24868558378685215, 0.9406701182415514, -0.1144955885991482, 0.2218825452343798, 0.09812242809209444, -0.004981869122253013, -0.16373160507053763, 0.11286409929595423, -1.0115233679802609, 0.3202380432269305, -0.416728982015831, 0.1840086864102341, -0.01621292495049007, 0.2932019347740019, 0.7416284232518872, -0.4325777352468581, 0.13459786751350247, -0.6148383974036701, 0.24425725567818282, 0.227010083044418, 0.424187218830432, 0.04935255142161757, 0.6572571192867133, 0.16000248666323713, 1.1588235450686306, 0.32886162954381293, 0.16641190892578486, -0.47383110762761993, 0.15487494885319894, 0.07551464774783515, -0.6470020436666369, 0.636280828245648, -0.46683901061393146, -0.7360347456409364, -0.06922176043551555, 0.3829338464496702, 0.6320855700374349, 0.08407996658960348, -0.06828948083369042, 0.47080119892168826, -0.6185675158109706, -0.6372131078474731, -0.2341187150083346, 0.3861968250560581, 1.2380673112237663, 0.23062266650149035, -0.2780523912443436, -0.07347528611884269, 0.053052536091361034, -0.7640031336956902, -0.08180753506015474, 0.6013203431772058, 1.0003360127583594, -0.038106928724601995, 0.4032109277893667, 0.7723936501121162, 0.07446583319578189, 0.5621645999005506, 0.35869457680221695, -0.19216613292620394, -0.1188073817575894, 0.4537870961883797, 0.13646242671715272, -0.09066419127749344, -0.6684444745086148, 0.2554446109000843, 0.056315514697748974, 0.12434279189342608, -0.5052955441892178, 0.2256116636416803, 0.0487990104080339, 0.13436479761304618, 0.1241097219929698, -1.22781223560369, -0.13308291316053664, 0.16058516141437781, 0.037582521448575365, 0.2218825452343798, -0.922956805806874, 0.028172324217653005, -0.4367729934550712, -0.22805889759647127, -0.370348071825031, 0.613906117801845, 0.42978089644138273, -0.4717334785235134, -0.5938621063626048, 0.13110181900665824, 1.3284984326008036, 0.10056966204688539, 0.729042648627248, -0.48851451135636564, -0.2645343370178793, 0.6372131078474731, -0.022942818326165192, -0.6101769993945445, 1.1839950943179092, 0.02234557670624597, -0.5267379750311958, 0.39458734147248425, -0.4731318979262511, -0.6181013760100581, 0.4265179178349948, 0.41952582082130635, -0.14916473629202004, -0.033591199403261544, 0.4474942088760601, 0.28667597756122604, 0.17771579909791452, 0.6824286685359917, -0.3430788934716461, -0.14263877907924416, -0.3209372529282994, 0.49457432876822893, 0.8875301809375192, 0.12655695594776076, 0.2880743969639637, -0.29716412308175866, -0.3633559748113426, -1.2110312027708376, 0.17806540394859893, -0.3507702001867034, 0.7117954759934831, -0.07271780894235977, 0.3691827223227496, -0.2927357949730893, 0.27665397184160595, 0.9178292679968358, 0.27222564373293656, -0.07743747442659947, 0.7420945630527997, -0.4479603486769727, -0.14485294313357883, -0.24239269647453257, 0.4703350591207757, 0.531865512841234, -0.12748923554958588, 0.25894065940692856, 0.1619835808171155, -0.0642107575757055, -0.863290911290066, 0.22514552384076775, 0.28248071935301294, 0.5076262431937807, 0.1851740359125155, 1.3872320475157864, 0.07038710993779695, 0.34471038277484006, -0.18062917285361801, 0.16804339822897882, 0.06980443518665626, -0.3903920832642712, 0.5980573645708178, 0.23283683055582505, -0.6204320750146208, -0.11700109002905322, 0.4111353044048802, 0.35100327008715965, -0.9854195391291574, 0.2052180473517557, 0.7164568740026087, -0.23633287906266925, -0.15557415855456777, -0.39248971236837776, -0.43234466534640187, -0.273390993235218, -0.34471038277484006, -0.32862855964335663, -0.3717464912277687, 1.1467039102449041, -0.25474540119871547, -0.3179073442223677, 0.9350764406306007, 0.2710602942306552, 0.31254673651187326, -0.6386115272502108, -0.47825943573628926, -1.147636189846729, -0.6409422262547736, -0.6665799153049645, 0.5514433844795616, 0.840916200846263, 0.1017350115491668, 0.273390993235218, -0.3118475268105044, -0.08075872050810147, 0.31883962382419284, -0.11437905364892005, -0.22864157234761198, -0.2994948220863215, 0.1753851000933517, 0.3176742743219114, -0.18505750096228737, 0.7071340779843576, -0.3607922059063235, 1.0823766177189704, 0.21710461227502606, -0.04955648758451681, -0.21197707446498787, 0.24775330418502703, -0.43351001484868323, 0.6740381521195655, -0.8432468998508258, -1.0805120585153203, 0.08262327971175172, 0.8287965660225364, -0.3099829676068542, -0.44842648847788524, 0.4328108051473144, 0.340515124566627, -0.25101628279141497, -0.5304670934384963, -0.04055416267939295, -0.3491387108835094, 0.06077297654397535, 1.466475813670922, -0.17130637683536676, -0.007778707927728389, -0.8157446515969846, -0.8698168685028419, -0.03755338771101833, -0.2468210245832019, 0.30532156959772855, -0.8637570510909786, 0.4015794384861727, -0.20906370070928434, 0.38876059396107726, 0.37617481933643804, -0.21745421712571048, 0.32350102183331847, 0.3579953671008481, -0.41323293350898677, 1.45155934004172, 0.4356076439527898, -0.4866499521527154, 0.25800837980510344, 0.7122616157943957, -0.5313993730403214, -0.3242002315346873, 0.3540331787930913, -0.38106928724601996, 0.20743221140609036, 0.4176612616176561, -0.18657245531525318, -0.6488666028702872, -0.23691555381380996, 0.357063087499023, 0.026540834914459036, -0.12329397734137282, -0.0328919897018927, -0.7532819182747013, 1.2100989231690127, -0.5272041148321084, 0.3433119633721024, 0.4356076439527898, 0.11321370414663864, -0.10727042168500348, 0.2077818162567748, -0.42861554693910137, -0.33981591486525814, 0.22432977918917077, 0.9994037331565343, 0.39155743276655264, 0.5556386426877746, -0.31557664521780493, 0.3710472815263999, 0.6306871506346973, 0.3542662486935476, -0.848374437660864, 0.6428067854584238, 0.386896034757427, -0.33002697904609435, -0.12282783754046026, -0.4377052730568963, -0.7901069625467937, -0.42745019743681995, 0.16664497882624113, -1.1485684694485543, -0.9192276873995735, 0.32862855964335663, 0.04524469442607561, 0.08996498157612459, -0.35985992630449837, 0.2855106280589446, 0.3815354270469325, -0.31650892481963006, 0.5076262431937807, 1.1774691371051331, 0.20044011439240192, 0.09911297516903363, 0.271759503932024, -0.7462898212610127, 0.371979561128225, -0.6278903118292218, -0.1734040059394733, 0.01984007527634095, -0.09596653151287383, -0.13774431116966226, 0.33352302755293856, -0.8768089655165303, -0.3938881317711154, 0.17118984188513864, 0.44236667106602195, 0.44516350987149733, -0.26639889622152957, -0.5742842347242771, 0.36848351262138074, 0.0773792069514854, -0.23458485480924715, -0.8040911565741705, 0.7560787570801766, -0.01777157990979145, 0.4393367623600903, 0.48851451135636564, 0.22106680058278283, 0.4367729934550712, -0.2848114183575758, 0.07504850794692258, 0.10493972268044066, 0.8124816729905967, 0.42372107902951944, 0.11968139388430045, -0.5024987053837425, -0.6129738382000198, -0.6908191849524178, -0.05512103145791053, 0.09293662280694218, 0.1802795680029336, 0.27548862233932453, 0.044137612398908274, -0.5122876412029064, 0.4691697096184943, -0.49597274817096665, 0.5868700093489163, 0.3906251531647275, -0.2178038219763949, -0.37267877082959383, 0.430013966341839, -0.38083621734556367, -0.08909096944941354, -0.3528678292908099, -0.3600929962049546, -0.562630739701463, 0.03630063699606582, 1.072121542098894, 0.18867008441935973, -0.3903920832642712, -1.108480446570074, 1.385367488312136, -0.2906381658689828, -0.02349635933974886, -0.5006341461800923, 0.3491387108835094, -0.8176092108006349, -0.2813153698507315, 0.19752674063669842, 0.27292485343430545, 0.1965944610348733, 0.26896266512654865, -0.40996995490259885, 0.04993522617275827, -0.7723936501121162, 0.4102030248030551, -0.2629028477146853, 0.371979561128225, 0.5519095242804741, -0.30835147830366016, -0.06065644159374721, -0.2482194439859396, 0.19309841252802906, 0.12061367348612557, -0.07650519482477434, 0.41602977231446214, -0.2521816322936964, 0.7276442292245102, -0.7164568740026087, 0.045506898064088926, -0.38503147555377676, 0.4787255755372018, 0.5388576098549224, 0.3990156695811536, 0.27875160094571244, -0.1834260116590934, -0.14636789748654466, -0.23225415580468434, 0.24192655667362, -0.20044011439240192, -0.21722114722525418, -0.7080663575861826, 0.25427926139780294, 0.7024726799752319, 0.33002697904609435, -1.0823766177189704, -0.9364748600333384, -0.20102278914354263, 0.6800979695314289, -0.005375174579272988, 0.8050234361759957, 0.15114583044589844, 0.2164054025736572, 0.5831408909416158, 0.09538385676173312, -0.9844872595273323, -0.13110181900665824, 0.4006471588843476, -0.47080119892168826, 0.866553889896454, -2.2132317747328476, -0.4330438750477707, -0.49457432876822893, 0.5658937183078511, -0.8754105461137927, 0.47126733872260085, 0.052149390227092945, 0.295765703679021, -0.08722641024576329, -0.4428328108669345, -0.15126236539612659, -1.115938683384675, -0.2040526978494743, 0.8437130396517384, 0.43490843425142095, 0.2250289888905396, -0.8805380839238308, 0.36475439421408024, 0.40927074520122997, -0.4875822317545405, -0.37221263102868124, -0.058413143801855506, -0.2181534268270793, 0.06823121335857636, -0.677767270526866, 0.03260065232632235, -0.7201859924099092, 0.6800979695314289, -0.08349729183846279, 0.04303053037174094, -1.0096588087766107, -0.16373160507053763, -0.30765226860229133, -0.0419234483445736, -0.39621883077567827, 0.506227823791043, 0.29996096188723403, 0.2181534268270793, -0.7947683605559193, 0.09567519413730348, -0.1639646749709939, -0.35613080789719787, -0.5761487939279274, -0.5253395556284581, 0.8138800923933344, 0.9658416674908298, 0.35636387779765416, -0.07201859924099092, -0.42348800912906315, 0.30835147830366016, -0.17247172633764818, -0.09631613636355825, 0.14357105868106929, -0.48059013474085205, -0.30905068800502905, -0.6745042919204781, 0.4927097695645787, -0.755612617279264, 0.28970588626715765, 0.30835147830366016, -0.8073541351805584, -0.04603130534011556, 0.3917905026670089, -0.516949039212032, -0.8996498157612459, 0.4761618066321827, -0.45262174668609834, -0.4829208337454149, -0.196361391134417, -0.030386488271987675, 0.5822086113397907, 0.26127135841149135, -0.9723676247036056, -0.2622036380133165, 0.1329663782103085, -1.0320335192204138, -0.38013700764419484, 0.36288983501043, 0.5057616839901304, 0.6684444745086148, 0.2666319661219858, 0.2140747035690944, -1.1075481669682488, -0.043234466534640185, 0.03149357029915501, 0.04894467909581908, 0.3668520233181868, -0.14951434114270445, 1.183062814716084, 0.01084503380560634, 0.21011251526133762, -1.4757986096891733, -0.6194997954127958, 0.45215560688518575, -0.22444631413939892, -0.45262174668609834, -0.09363583250831102, 0.12480893169433864, -0.7201859924099092, 0.056169846009963796, 0.3715134213273124, -0.182260662156812, 0.47779329593537667, -0.3351545168561325, 0.303223940493622, -0.25870758950647227, -0.14427026838243814, -0.2890066765657888, 0.041719512181674356, 0.08070045303298741, -0.003024446130139713, -0.32583172083788126, 0.9290166232187373, -0.11315543667152458, 0.5197458780175074, -0.11787510215576427, -0.7784534675239796, -0.4509902573829043, 0.07825321907819645, 1.0693247032934188, 0.6283564516301344, 0.12212862783909141, -0.295765703679021, -0.07166899439030651, 0.6292887312319596, 0.23912971786814463, 0.25008400318958984, 0.2668650360224421, -0.5714873959188018, -0.900582095363071, 0.06013203431772058, 1.064663305284293, -0.7621385744920399, 0.5416544486603978, 0.18249373205726827, -1.0767829401080198, 0.36288983501043]
    image_embedding_tensor = torch.tensor(image_embedding_list)
    normalized_tensor = torch.nn.functional.normalize(image_embedding_tensor, p=2, dim=0)
    image_embedding_tensor = torch.unsqueeze(image_embedding_tensor, 0)
    negative_image_embedding = None
    prompt_generation_policy = "top-k"

    # Generate img2img generation jobs with Kandinsky using the embeddings
    response = generate_img2img_generation_jobs_with_kandinsky(
        image_embedding=image_embedding_tensor,
        negative_image_embedding = None,  
        dataset_name="test-generations",
        prompt_generation_policy=prompt_generation_policy
    )

    print(response)