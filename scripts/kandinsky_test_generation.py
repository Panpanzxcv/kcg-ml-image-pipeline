import io
import sys
import os
import uuid
import torch


base_directory = os.getcwd()
sys.path.insert(0, base_directory)

from utility.http import generation_request
from utility.http import request
from utility.minio.cmd import connect_to_minio_client, upload_data
from worker.generation_task.generation_task import GenerationTask
from kandinsky_worker.dataloaders.image_embedding import ImageEmbedding

def read_msgpack_file(file_path):
    """Reads a msgpack file and returns its bytes."""
    with open(file_path, "rb") as f:
        return f.read()

def generate_img2img_generation_jobs_with_kandinsky(image_embedding,
                                                    negative_image_embedding,
                                                    dataset_name,
                                                    prompt_generation_policy,
                                                    self_training= False,
                                                    init_img_path="./test/test_inpainting/white_512x512.jpg"):

    # get sequential ids
    sequential_ids = request.http_get_sequential_id(dataset_name, 1)

    count = 0
    # generate UUID
    task_uuid = str(uuid.uuid4())
    task_type = "img2img_generation_kandinsky"
    model_name = "kandinsky_2_2"
    model_file_name = "kandinsky-2-2-decoder"
    model_file_path = "input/model/kandinsky/kandinsky-2-2-decoder"
    task_input_dict = {
        "strength": 0.75,
        "seed": "",
        "dataset": dataset_name,
        "file_path": sequential_ids[count]+".jpg",
        "init_img": init_img_path,
        "num_images": 1,
        "image_width": 512,
        "image_height": 512,
        "decoder_steps": 100,
        "decoder_guidance_scale": 12,
        "self_training": self_training
    }

    prompt_generation_data={
        "prompt_generation_policy": prompt_generation_policy
    }

    image_embedding= image_embedding.detach().cpu().numpy().tolist()[0]
    negative_image_embedding= image_embedding.detach().cpu().numpy().tolist()[0] if negative_image_embedding is not None else None

    # create the job
    generation_task = GenerationTask(uuid=task_uuid,
                                     task_type=task_type,
                                     model_name=model_name,
                                     model_file_name=model_file_name,
                                     model_file_path=model_file_path,
                                     task_input_dict=task_input_dict,
                                     prompt_generation_data=prompt_generation_data)
    generation_task_json = generation_task.to_dict()

    # add job
    response = generation_request.http_add_kandinsky_job(job=generation_task_json,
                                                         positive_embedding=image_embedding,
                                                         negative_embedding=negative_image_embedding)

    return response


if __name__ == "__main__":
    image_embedding_list = [-1.8100561103726973, 0.5412473705542281, -2.1233550690973564, -0.9544689207658215, 0.6536602859770293, 0.9560302112578047, -0.49935274235267485, 0.5045570439926194, -2.314873369447314, -0.8701592341987205, -0.9045076250223543, -2.087965817945734, 0.4928473653027442, 0.40957853906363223, 1.1282925955399679, 1.1033119476682343, -0.521471024322439, 0.32058498102058125, 0.8873334296105374, 0.03607231574186532, -0.8201979384552534, 0.2802516433110114, -1.2063571201391352, -0.7379699725441302, 0.6744774925368073, -0.08151237443563074, 1.094985065044323, -1.2011528184991909, -1.6070883464148618, 0.24291077904440958, -0.6224344761373622, -2.4793293012695603, -0.9185592394502043, -1.2969119686741697, 1.0366968866769446, 0.0820978583701245, 0.6380473810571958, -0.11969893771872352, 0.33645810102241197, 1.7548905129892856, 1.0700044171725893, 0.3239677770865452, -0.4884237089087914, -0.2505871239633277, 0.8248818099312034, 0.4022925167677099, -2.9060820357450092, -1.3583227280255148, -0.12210592722719785, -1.1511915227557237, 0.48087747153087185, -1.7278281444615742, -1.1928259358752795, -0.7119484643444077, 0.17200216920016576, 0.82332051943922, -1.6872345916700071, -0.3773118688959763, 0.2388774452734526, 0.5860043646577507, -0.32578928266052576, -0.043911295087031725, 4.384103701489248, -0.5771570518698451, 0.33099358430047027, 0.10330538755289834, 0.43351832660737694, -0.4829591921868497, -1.0184818309371388, 0.4022925167677099, 1.0242065627410777, 0.7946968604195253, 1.511329196239883, 0.027452691150707243, -1.0122366689692055, 0.3616989639761428, 1.585230279527095, 0.2919613220008865, 1.0804130204524784, -2.27115723567178, -1.6497636198624068, -0.32058498102058125, -1.0111958086412165, -0.10115861312642123, -0.4543355331671549, 1.0876990427484006, 2.752034707202652, 1.6591313628143067, 0.6016172695775843, 1.1813764722674016, -0.13596238034355007, 0.22196346494363295, -1.6861937313420183, 0.6562624367970016, -1.0392990374969169, 0.04228495082454907, -0.5958925377736454, 0.9060689155143375, -1.6414367372384955, -1.4561635988564714, -1.0824947411084562, -0.9680001050296771, -0.39708821512776543, -1.4977980119760272, 2.2232776605842908, -0.07116882492624105, -0.9003441837103986, 0.2888387410169198, -1.9745120421949436, 0.7629506204158638, -1.0481463502848225, -1.2459098126027135, 0.7936560000915364, -1.2604818571945582, -0.26502906101417373, -0.5500946833421337, 1.8787528920199648, 0.33203444462845916, 0.29768605380482543, -0.3127785285606645, 0.5552989849820782, -1.0793721601244894, -0.5485333928501503, 0.9653979542097049, -0.9680001050296771, -0.07246990033622717, -0.10408603279889002, 1.2833807844103138, 1.322933476873892, 0.276348417081053, 0.0779994708286682, -1.208438840795113, 0.3783527292239652, -0.2766086321630502, -1.303157130642103, -1.690357172653974, 0.021272582953273146, 0.23757636986346645, -0.6744774925368073, -1.4436732749206045, 3.222503575453635, 2.5501078035728053, -0.3783527292239652, -0.33932046692438145, -0.91803880928621, -1.657049642158329, 2.093170119585678, 1.2729721811304249, -0.38459789119189863, 0.7905334191075697, -0.7306839502482079, -0.6744774925368073, -0.22404518559961076, 2.8353035334417642, -1.0689635568446005, 0.6052602807255454, -0.38824090233985975, -0.8561076197708704, 1.520696939191783, -0.47723446038291073, -0.026915997544087966, -0.09335216066650448, 0.8561076197708704, -1.1334968971799122, 0.9789291384735606, -1.1178839922600787, 0.4467892957892354, -1.0033893561812997, -1.0502280709408003, 0.0309168044297953, -0.45381510300316047, -0.047033876070998425, -0.051002156071456105, 0.41296133512959615, -1.2011528184991909, -0.4990925272706776, 1.2188474440750021, -0.8581893404268481, 0.7338065312321747, -0.2784301377370308, -1.0569936630727281, 1.5623313523113391, 0.023858470330620572, -1.6435184578944733, -0.354933371844215, 0.11878818493173322, 0.9138753679742543, -0.39006240791384034, -0.2721849757690974, 0.8706796643627149, -1.0085936578212442, 0.45745811415112164, 1.3833033758972484, 1.7871571831569415, -0.2161086255986954, -0.3005484197067949, -1.2865033653942806, -0.6042194203975565, -1.2105205614510908, 3.139234749214523, -0.28415486954096975, 0.1494935646074058, -4.096826250964311, -0.5011742479266554, -0.32683014298851465, 0.7738796538597472, -0.20166668854784942, -1.0554323725807448, 6.082787756767132, -0.43091617578740465, -1.0981076460282897, 0.974765697161605, 0.034543552135131626, -0.969040965357666, 0.9544689207658215, -0.21480755018870926, -0.9050280551863487, -1.261522717522547, -0.33932046692438145, 0.06466344787631043, 1.1584775450516458, -0.47098929841497733, -2.5459443622608497, 0.760868899759886, 0.9190796696141988, -0.6401291017131736, -0.3182430452826062, 0.1817602347750617, 2.66876588096354, -1.3260560578578588, 2.847793857377631, 0.1467613062464349, -0.16068281313328647, 0.370025846600054, -0.1318639928020938, 1.0710452775005783, -0.5068989797305944, 1.8017292277487862, 0.4915462898927581, -0.787410838123603, -0.245122607241386, -1.2042753994831574, -1.6289464133026288, 0.7145506151643799, 1.2032345391551686, -0.5232925298964195, -0.8888947201025207, 0.22599679871458994, 1.3041979909700918, 1.7080517982297851, 0.1401258216555057, 3.168378838398212, -2.4147959609342484, 1.407243163440993, -1.0929033443883451, -1.7673808369251525, -1.4572044591844602, 0.38407746102790413, -1.8256690152925308, 0.1725225993641602, 0.09959732263443788, -1.8090152500447085, -1.4457549955765823, -0.1589914151003045, -2.3003013248554693, -1.8058926690607418, -2.119191627785401, 0.3541527265982233, 1.2906668067062361, -0.9216818204341711, -2.699991690803207, 0.23523443412549144, -0.38017423479794576, 0.7410925535280969, -0.9841334401135051, -0.6333635095812458, -1.6841120106860406, 1.9651442992430435, 1.0981076460282897, 1.4665722021363603, -1.803810948404764, 1.1491098020997457, -0.5258946807163918, 0.8488215974749481, 1.7267872841335854, -0.42571187414746015, 1.3739356329453483, 0.30393121577275883, 1.4291012303287598, 1.9453679530112544, 0.42128821775350733, -4.413247790672937, -1.4353463922966934, -1.2584001365385802, -0.24356131674940262, -1.0205635515931166, 0.5144452171085139, 0.059329038695367306, -1.1012302270122563, 0.5045570439926194, 0.7946968604195253, 0.03350269180714272, 0.32500863741453406, 1.1553549640676792, 1.3812216552412706, -0.7468172853320358, -0.6338839397452402, 0.3869398269298736, -1.1501506624277347, 0.4090581088996378, -2.804077723602097, -0.029518148364060214, 1.667458245438218, -0.7946968604195253, 2.217032498616357, -1.1959485168592463, -0.9888173115894552, 1.281299063754336, -0.6900903974566408, 1.1210065732440455, 0.2546204577342847, -1.9474496736672322, 0.07565753509069317, 0.07565753509069317, -3.4473294062992372, 0.27504734167106687, 1.8308733169324753, 0.13934517640951402, 0.6489764145010792, 0.17070109379017961, 0.06934731935226048, 0.6744774925368073, 0.5932903869536731, -0.33645810102241197, -1.667458245438218, 0.09510861246998575, 3.4327573617073925, 0.3645613298781123, -2.7895056790102526, -0.2917011069188893, 4.975312367786943, 0.07338065312321745, -2.3107099281353585, 2.760361589826563, 0.06954248066375839, -0.7410925535280969, -1.2865033653942806, 1.250073253914669, 1.3083614322820476, -0.30367100069076164, 1.418692627048871, -0.32162584134857014, -1.9942883884267326, -0.28233336396698916, -0.9128345076462654, -0.8217592289472366, -0.9414581666659602, 0.7462968551680415, 0.13375055214657366, 0.15196560788637942, -1.0528302217607726, -0.39708821512776543, 3.2474842233253685, 0.9149162283022433, -1.4009980014730596, 0.7593076092679026, -1.0970667857003007, 1.1282925955399679, -1.5446367267355279, 1.6008431844469284, -0.29066024659090034, -0.6396086715491791, -1.1272517352119789, 1.0434624788088724, 0.6068215712175288, -2.0182281759704774, -2.0609034494180225, -0.23939787543744703, -1.439509833608649, 2.2440948671440686, 1.8985292382517538, 0.33203444462845916, -1.4030797221290374, -0.572473180393895, 0.4892043541547831, 0.8540258991148926, 2.043208823842211, -0.1122177541113033, 2.5667615688206276, -0.14598066100044324, -1.9838797851468437, 1.8371184789004087, -1.2126022821070688, 0.17070109379017961, 0.31173766823267557, 0.6057807108895399, -2.6729293222754955, 0.8977420328904264, 0.646374263681107, -0.49935274235267485, -0.3034107856087644, -3.251647664637324, -1.3822625155692594, -1.0866581824204118, -0.7426538440200803, -1.0226452722490944, 1.1605592657076236, 1.2833807844103138, 1.0569936630727281, 0.035714520004119135, -0.8259226702591923, 0.45667746890512995, 1.1938667962032685, 0.6068215712175288, -0.8363312735390813, -2.291974442231558, 2.3252819727272027, -2.1139873261454563, -1.1803356119394128, 0.5256344656343945, 2.575088451444539, 0.07240484656572786, 0.4657849967750328, -0.15092474755839053, -2.6396217917798506, -0.49857209710668315, -0.20348819412182997, 0.5160065076004973, -0.7790839554996918, 1.1511915227557237, 0.8675570833787483, -0.9653979542097049, -0.23224196068252334, 0.45563660857714106, 0.7926151397635475, -1.2001119581712019, 0.22794841182956913, 0.1350516275565598, -1.772585138565097, -0.469428007922994, 1.2771356224423804, 0.5589419961300394, -1.3406281024497033, 0.42675273447544904, 0.3593570282381678, -0.7811656761556696, 1.0856173220924228, 0.5631054374419949, -0.3502495003682649, -0.5066387646485971, -0.43794198300132975, -0.20101615084285634, -1.270890460474447, -0.5217312394044362, -1.7247055634776076, 0.008367541230473268, -0.9383355856819935, 0.35883659807417334, -0.9289678427300934, -0.42727316463944354, 0.7572258886119249, -0.35076993053225936, -0.1631548564122601, -0.5823613535097897, -0.9430194571579436, 0.2299000249445483, -0.5396860800622447, 1.7538496526612968, -2.3107099281353585, 1.0257678532330612, 0.6749979227008017, 0.2369258321584734, -0.8805678374786096, 1.2219700250589687, 1.7819528815169972, -1.4540818782004936, 0.6765592131927851, 0.5542581246540893, 0.6822839449967241, -2.104619583193556, -0.6411699620411625, -0.829045251243159, 0.5464516721941726, -0.37496993315800126, -0.4408043489032992, -1.9464088133392432, 0.8878538597745318, 0.18332152526704504, 0.9742452669976105, 1.9224690257954986, 1.1876216342353352, 0.729643089920219, 0.03805645574209416, -0.48165811677686354, -0.8207183686192477, -0.10844463542234353, 0.5402065102262392, 1.269849600146458, 1.4499184368885378, 0.3177226151186118, -0.9784087083095662, -1.3489549850736147, 0.5417678007182225, 1.1282925955399679, -0.034868820987628155, -1.23029690768288, -0.09771076328995801, 1.2219700250589687, 0.6599054479449626, 0.5082000551405805, -0.0832037724686127, -0.2919613220008865, 1.4905119896801051, -0.8701592341987205, -0.9409377365019658, -0.24291077904440958, 0.5087204853045749, -2.7291357799868963, 0.8201979384552534, 0.23562475674848726, 0.45251402759317433, 0.030721643118297382, 0.9034667646943654, -1.4572044591844602, -1.791320624468897, 0.6338839397452402, -0.05825565148212875, -1.7455227700373857, -0.6926925482766131, -0.02447648115036398, -1.75072707167733, 0.9268861220741156, -2.2940561628875358, 1.9245507464514764, -0.12334194886668466, 0.01790605032993405, 0.005822312459687911, 0.9596732224057659, 0.9346925745340323, 1.5602496316553613, 1.8485679425082866, 1.2386237903067912, 2.458512094709782, -1.6216603910067064, -0.5443699515381948, 1.1345377575079012, -0.12067474427621311, -0.3663828354520928, 0.536563499078278, 1.6768259883901182, 0.572473180393895, -0.18527313838202422, -0.5927699567896786, 0.12080485181721172, -0.18071937444707278, -0.048562639677732125, -0.9773678479815773, -0.46370327611905504, 1.6247829719906732, -1.4176517667208821, 0.6125463030214677, 0.2714043305231057, -1.63727329592654, -1.0876990427484006, -0.3557140170902066, 0.7785635253356973, 2.055699147778078, -1.1439055004598013, -1.5238195201757498, -0.1756451803481269, -1.262563577850536, -0.34140218758035923, -0.7676344918918139, 0.30106884987078936, -1.1668044276755571, -1.9932475280987438, 1.0528302217607726, -1.0340947358569723, 1.2490323935866803, -0.4751527397269329, -0.9570710715857937, 1.3281377785138366, 0.6468946938451015, 0.8899355804305096, 0.29846669905081713, -0.15677958690332808, 0.5126237115345333, -1.1761721706274573, 0.8399742846870424, -0.990899032245433, -1.572739955591228, -0.4603204800530911, 0.21103443149974951, 2.1014970022095896, 0.6687527607328684, 0.1100709796848262, 0.4676065023490134, 1.4873894086961383, 1.9422453720272876, 0.526154895798389, 0.40333337709569883, 0.2360150793714831, -0.05220565082569327, 1.9755529025229326, 1.2115614217790798, 2.5043099491412937, 1.4842668277121716, -2.262830353047869, -0.18930647215298121, -0.9706022558496494, -0.022264652953387566, -0.4616215554630772, -0.40411402234169047, 0.42389036857347956, 0.6921721181126186, 0.9685205351936715, -0.6239957666293456, 1.3718539122893705, -1.1470280814437679, -0.10629786099586643, 1.0356560263489556, 0.6026581299055732, 1.5435958664075389, 0.8764043961666539, -1.208438840795113, -0.6396086715491791, -0.3635204695501234, 0.11449463607877902, 0.12249624985019368, 0.9222022505981655, 1.262563577850536, 0.0644032327943132, -0.16861937313420183, 2.3086282074793805, 0.05389704885867524, -0.4624022007090689, 0.34036132725237034, -0.4022925167677099, 1.8287915962764976, 1.4020388618010484, -0.34452476856432596, 2.533454038324983, 1.3333420801537812, -1.5998023241189396, -0.9451011778139213, 1.250073253914669, -1.3947528395051263, -0.4977914518606915, 1.8256690152925308, 0.43169682103339635, 0.7790839554996918, -1.0096345181492332, 0.1278957128016361, 0.4171247764415517, 0.3234473469225507, 0.5407269403902336, -0.15131507018138635, -0.1912580852679604, -2.6958282494912513, -0.06437070590906355, -0.995582903721383, -0.30549250626474217, -0.2802516433110114, -0.33749896135040086, 0.14168711214748902, 0.15248603805037386, 0.4241505836554768, -1.4426324145926157, -0.12399248657167773, 0.028623659019694755, 0.7150710453283744, 0.2663301364241598, 2.33777229666307, -0.7759613745157251, 1.9765937628509214, -0.5854839344937564, 0.6442925430251292, -0.3762710085679874, -0.4408043489032992, 0.938856015845988, 1.3937119791771373, -0.3096559475766978, -0.10870485050434076, -0.7405721233641025, -1.251114114242658, 1.9536948356351655, -0.5709118899019118, 0.09276667673201072, 2.531372317669005, 0.9154366584662377, -0.9471828984698991, -2.1119056054894783, 0.23588497183048449, 0.2205322819926482, 0.05796290951488188, 0.39864950561974877, -0.7780430951717029, 0.05780027508863361, 0.7488990059880136, -1.5311055424716722, 0.45589682365913825, 1.3094022926100364, 0.01907701819892156, 0.19672260198990213, 0.09068495607603293, 0.28753766560693367, 1.196989377187235, -0.4873828485808025, -2.2940561628875358, 0.10421614033988863, -1.6102109273988285, 0.9456216079779158, 0.6593850177809683, 0.572473180393895, -1.2188474440750021, 0.3450451987283204, -0.5175677980924805, 0.4707290833329801, 1.981798064490866, 0.8998237535464042, 0.2792107829830225, -2.2440948671440686, 0.349208640040276, -0.704142011884491, -0.7478581456600247, -1.6716216867501736, 0.7260000787722578, -0.667191470240885, 0.599015118757612, 0.0738360295167126, -1.520696939191783, 0.055653500662156505, -1.6612130834702847, -1.4020388618010484, 0.4751527397269329, 1.3468732644176369, -0.5552989849820782, 2.1004561418816006, -0.2556613180622736, 0.4954495161227165, 0.21910109904166347, -0.01112419475538137, -0.3656021902061012, 0.25201830691431243, -2.2586669117359133, 0.7150710453283744, -0.9305291332220768, 0.4108796144736183, -0.03620242328286393, 0.6547011463050182, 1.6560087818303402, -0.9659183843736994, 0.3005484197067949, -1.3728947726173593, 0.5454108118661837, 0.5068989797305944, 0.9471828984698991, 0.1102010872258248, 1.4676130624643493, 0.35727530758218995, 2.587578775380406, 0.734326961396169, 0.37158713709203733, -1.058034523400717, 0.3458258439743121, 0.16861937313420183, -1.4447141352485935, 1.4207743477048487, -1.0424216184808834, -1.6435184578944733, -0.15456775870635167, 0.8550667594428815, 1.4114066047529485, 0.18774518166099788, -0.15248603805037386, 1.051268931268789, -1.3812216552412706, -1.4228560683608265, -0.5227720997324251, 0.8623527817388038, 2.7645250311385188, 0.5149656472725084, -0.620873185645379, -0.1640656091992504, 0.1184629160792367, -1.7059700775738074, -0.18267098756205197, 1.342709823105681, 2.23368626386418, -0.08509033181309258, 0.9003441837103986, 1.7247055634776076, 0.1662774373962268, 1.2552775555546136, 0.8009420223874587, -0.42909467021342407, -0.2652892760961709, 1.0132775292971943, 0.30471186101875053, -0.20244733379384108, -1.492593710336083, 0.5703914597379173, 0.125748938375159, 0.2776494924910391, -1.1282925955399679, 0.5037763987466277, 0.10896506558633798, 0.30002798954280047, 0.27712906232704465, -2.741626103922763, -0.297165623640831, 0.3585763829921761, 0.08391936394410507, 0.4954495161227165, -2.0609034494180225, 0.06290699607282915, -0.9752861273255995, -0.5092409154685694, -0.8269635305871812, 1.3708130519613815, 0.9596732224057659, -1.0533506519247668, -1.3260560578578588, 0.2927419672468782, 2.9664519347683656, 0.2245656157636052, 1.6279055529746398, -1.0908216237323674, -0.5906882361337008, 1.4228560683608265, -0.05122984426820368, -1.3624861693374704, 2.6437852330918066, 0.0498962419729679, -1.1761721706274573, 0.881088267642604, -1.0564732329087336, -1.3801807949132816, 0.9523872001098437, 0.9367742951900101, -0.33307530495644805, -0.07500699738570012, 0.9992259148693441, 0.6401291017131736, 0.3968280000457682, 1.5238195201757498, -0.7660732013998305, -0.31850326036460347, -0.7166323358203578, 1.104352807996223, 1.981798064490866, 0.2825935790489864, 0.6432516826971403, -0.6635484590929238, -0.8113506256673476, -2.7041551321151625, 0.3976086452917599, -0.7832473968116473, 1.5893937208390505, -0.16237421116626843, 0.8243613797672089, -0.6536602859770293, 0.6177506046614123, 2.0494539858101444, 0.6078624315455177, -0.17291292198715605, 1.657049642158329, -1.000266775197333, -0.3234473469225507, -0.5412473705542281, 1.0502280709408003, 1.1876216342353352, -0.2846752997049642, 0.578197912197834, 0.3616989639761428, -0.14337851018047099, -1.9276733274354432, 0.5027355384186388, 0.6307613587612735, 1.1334968971799122, 0.4134817652935906, 3.097600336094967, 0.15716990952632393, 0.7697162125477917, -0.40333337709569883, 0.3752301482399985, 0.15586883411633778, -0.8717205246907038, 1.335423800809759, 0.5199097338304556, -1.3853850965532262, -0.26125594232521393, 0.91803880928621, 0.7837678269756418, -2.200378733368535, 0.4582387593971133, 1.5998023241189396, -0.5277161862903724, -0.34738713446629543, -0.8764043961666539, -0.9653979542097049, -0.61046458236549, -0.7697162125477917, -0.7338065312321747, -0.8300861115711479, 2.5605164068526944, -0.5688301692459339, -0.70986674368843, 2.087965817945734, 0.6052602807255454, 0.6978968499165575, -1.4259786493447932, -1.0679226965166115, -2.562598127508672, -1.4311829509847378, -1.4884302690241271, 1.2313377680108688, 1.877712031691976, 0.22716776658357746, 0.61046458236549, -0.6963355594245741, -0.18032905182407696, 0.7119484643444077, -0.25540110298027635, -0.5105419908785556, -0.6687527607328684, 0.3916236984058237, 0.7093463135244354, -0.41322155021159335, 1.5789851175591616, -0.8056258938634088, 2.416877681590226, 0.48478069776083027, -0.11065646361931995, -0.47333123415295236, 0.5532172643261004, -0.9680001050296771, 1.5050840342719496, -1.8829163333319203, -2.4127142402782704, 0.18449249313603255, 1.8506496631642644, -0.6921721181126186, -1.0013076355253219, 0.9664388145376938, 0.7603484695958915, -0.5605032866220228, -1.1844990532513684, -0.09055484853503432, -0.7796043856636862, 0.13570216526155285, 3.27454659185308, -0.3825161705359208, -0.01736935672331477, -1.8215055739805752, -1.9422453720272876, -0.08385431017360577, -0.5511355436701226, 0.6817635148327296, -1.928714187763432, 0.8967011725624375, -0.4668258571030217, 0.8680775135427428, 0.8399742846870424, -0.4855613430068219, 0.7223570676242967, 0.7993807318954753, -0.92272268076216, 3.241239061357435, 0.9726839765056272, -1.0866581824204118, 0.5761161915418562, 1.5904345811670395, -1.1865807739073462, -0.72391835811628, 0.7905334191075697, -0.8509033181309259, 0.46318284595506054, 0.9326108538780545, -0.41660434627755727, -1.448877576560549, -0.5290172617003585, 0.7972990112394975, 0.059263984924868, -0.27530755675306406, -0.07344570689371677, -1.6820302900300625, 2.702073411459185, -1.177213030955446, 0.766593631563825, 0.9726839765056272, 0.2527989521603041, -0.23952798297844566, 0.46396349120105224, -0.9570710715857937, -0.7587871791039082, 0.5009140328446582, 2.231604543208202, 0.8743226755106761, 1.240705510962769, -0.7046624420484854, 0.8285248210791645, 1.408284023768982, 0.7910538492715641, -1.8943657969397982, 1.4353463922966934, 0.8639140722307871, -0.7369291122161413, -0.2742666964250752, -0.9773678479815773, -1.7642582559411857, -0.9544689207658215, 0.3721075672560318, -2.56467984816465, -2.052576566794111, 0.7338065312321747, 0.10102850558542262, 0.20088604330185772, -0.8035441732074309, 0.6375269508932013, 0.8519441784589148, -0.7067441627044632, 1.1334968971799122, 2.629213188499962, 0.44756994103522707, 0.2213129272386399, 0.6068215712175288, -1.666417385110229, 0.8306065417351424, -1.4020388618010484, -0.38720004201187086, 0.044301617710027566, -0.2142871200247148, -0.30757422692072, 0.7447355646760581, -1.9578582769471211, -0.8795269771506207, 0.3822559554539236, 0.9877764512614663, 0.9940216132293996, -0.5948516774456565, -1.282339924082325, 0.8228000892752255, 0.17278281444615742, -0.523812960060414, -1.7954840657808528, 1.6882754519979961, -0.039682800004576815, 0.9810108591295383, 1.0908216237323674, 0.4936280105487359, 0.9752861273255995, -0.635965660401218, 0.16757851280621291, 0.23432368133850115, 1.8142195516846529, 0.9461420381419102, 0.26724088921115013, -1.1220474335720343, -1.3687313313054037, -1.54255500607955, -0.12308173378468744, 0.20752152789278697, 0.40255273184970713, 0.61514845384144, 0.09855646230644899, -1.1439055004598013, 1.047625920120828, -1.1074753889801898, 1.3104431529380254, 0.8722409548546983, -0.4863419882528136, -0.8321678322271256, 0.9601936525697604, -0.8503828879669314, -0.19893443018687854, -0.7879312682875974, -0.8040646033714254, -1.2563184158826024, 0.0810569980421356, 2.39397875437447, 0.42128821775350733, -0.8717205246907038, -2.4751658599576047, 3.0934368947830113, -0.6489764145010792, -0.0524658659076905, -1.1178839922600787, 0.7796043856636862, -1.8256690152925308, -0.6281592079413012, 0.4410645639852964, 0.6094237220375011, 0.43898284332931864, 0.6005764092495954, -0.9154366584662377, 0.11150216263581093, -1.7247055634776076, 0.9159570886302322, -0.5870452249857396, 0.8306065417351424, 1.2323786283388578, -0.6885291069646574, -0.13544195017955563, -0.5542581246540893, 0.4311763908694019, 0.2693226098671279, -0.17083120133117824, 0.9289678427300934, -0.5631054374419949, 1.6247829719906732, -1.5998023241189396, 0.10161398951991638, -0.8597506309188315, 1.0689635568446005, 1.2032345391551686, 0.8909764407584986, 0.6224344761373622, -0.40957853906363223, -0.32683014298851465, -0.5186086584204695, 0.5402065102262392, -0.44756994103522707, -0.48504091284282747, -1.5810668382151394, 0.567789308917945, 1.5685765142792725, 0.7369291122161413, -2.416877681590226, -2.0910883989297004, -0.4488710164452132, 1.5186152185358053, -0.012002420657122004, 1.7975657864368306, 0.33749896135040086, 0.4832194072688469, 1.302116270314114, 0.2129860446147287, -2.198297012712557, -0.2927419672468782, 0.8946194519064596, -1.051268931268789, 1.9349593497313653, -4.942004837291298, -0.9669592447016883, -1.104352807996223, 1.2636044381785247, -1.9547356959631546, 1.052309791596778, 0.1164462491937582, 0.6604258781089571, -0.19477098887492295, -0.9888173115894552, -0.3377591764323981, -2.491819625205427, -0.45563660857714106, 1.8839571936599093, 0.9711226860136438, 0.5024753233366416, -1.9661851595710325, 0.8144732066513144, 0.9138753679742543, -1.0887399030763896, -0.8311269718991368, -0.13043280985110906, -0.48712263349880525, 0.15235593050937526, -1.5134109168958607, 0.07279516918872371, -1.6081292067428508, 1.5186152185358053, -0.18644410625101174, 0.09608441902747535, -2.2545034704239577, -0.3656021902061012, -0.6869678164726741, -0.0936123757485017, -0.8847312787905651, 1.1303743161959456, 0.6697936210608573, 0.48712263349880525, -1.7746668592210748, 0.21363658231972177, -0.36612262037009563, -0.7952172905835198, -1.2865033653942806, -1.1730495896434905, 1.8173421326686197, 2.1566625995930013, 0.7957377207475141, -0.16081292067428507, -0.9456216079779158, 0.6885291069646574, -0.3851183213558931, -0.2150677652707065, 0.32058498102058125, -1.073126998156556, -0.6900903974566408, -1.5061248945999386, 1.1001893666842675, -1.6872345916700071, 0.6468946938451015, 0.6885291069646574, -1.802770088076775, -0.10278495738890389, 0.8748431056746706, -1.1543141037396902, -2.0088604330185773, 1.0632388250406615, -1.010675378477222, -1.0783312997965007, -0.4384624131653242, -0.06785108263077642, 1.3000345496581363, 0.5834022138377786, -2.1712346441848456, -0.5854839344937564, 0.2969054085588338, -2.304464766167425, -0.8488215974749481, 0.8103097653393587, 1.1293334558679566, 1.492593710336083, 0.5953721076096509, 0.47801510562890237, -2.4730841393016267, -0.09653979542097049, 0.07032312590975007, 0.10929033443883451, 0.8191570781272645, -0.33385595020243974, 2.6417035124358286, 0.024216266068366753, 0.46916779284099674, -3.295363798412858, -1.3833033758972484, 1.0096345181492332, -0.5011742479266554, -1.010675378477222, -0.20908281838477033, 0.27869035281902804, -1.6081292067428508, 0.12542366952266246, 0.8295656814071534, -0.40697638824365995, 1.0668818361886228, -0.7483785758240192, 0.6770796433567795, -0.5776774820338396, -0.3221462715125646, -0.6453334033531181, 0.09315699935500657, 0.18019894428307834, -0.006753394549959231, -0.7275613692642412, 2.074434633681878, -0.2526688446193055, 1.1605592657076236, -0.26320755544019314, -1.7382367477414633, -1.007032367329261, 0.1747344275611366, 2.387733592406537, 1.4030797221290374, 0.27270540593309184, -0.6604258781089571, -0.1600322754282934, 1.4051614427850152, 0.5339613482583058, 0.558421565966045, 0.5958925377736454, -1.2760947621143917, -2.0109421536745553, 0.1342709823105681, 2.377324989126648, -1.7018066362618518, 1.209479701123102, 0.4074968184076544, -2.4043873576543593, 0.8103097653393587]
    image_embedding_tensor = torch.tensor(image_embedding_list)
    normalized_tensor = torch.nn.functional.normalize(image_embedding_tensor, p=2, dim=0)
    image_embedding_tensor = torch.unsqueeze(image_embedding_tensor, 0)
    negative_image_embedding = None
    prompt_generation_policy = "top-k"

    # Generate img2img generation jobs with Kandinsky using the embeddings
    response = generate_img2img_generation_jobs_with_kandinsky(
        image_embedding=image_embedding_tensor,
        negative_image_embedding = None,  
        dataset_name="test-generations",
        prompt_generation_policy=prompt_generation_policy
    )

    print(response)