import io
import sys
import os
import uuid
import torch


base_directory = os.getcwd()
sys.path.insert(0, base_directory)

from utility.http import generation_request
from utility.http import request
from utility.minio.cmd import connect_to_minio_client, upload_data
from worker.generation_task.generation_task import GenerationTask
from kandinsky_worker.dataloaders.image_embedding import ImageEmbedding

def read_msgpack_file(file_path):
    """Reads a msgpack file and returns its bytes."""
    with open(file_path, "rb") as f:
        return f.read()

def generate_img2img_generation_jobs_with_kandinsky(image_embedding,
                                                    negative_image_embedding,
                                                    dataset_name,
                                                    prompt_generation_policy,
                                                    self_training= False,
                                                    init_img_path="./test/test_inpainting/white_512x512.jpg"):

    # get sequential ids
    sequential_ids = request.http_get_sequential_id(dataset_name, 1)

    count = 0
    # generate UUID
    task_uuid = str(uuid.uuid4())
    task_type = "img2img_generation_kandinsky"
    model_name = "kandinsky_2_2"
    model_file_name = "kandinsky-2-2-decoder"
    model_file_path = "input/model/kandinsky/kandinsky-2-2-decoder"
    task_input_dict = {
        "strength": 0.75,
        "seed": "",
        "dataset": dataset_name,
        "file_path": sequential_ids[count]+".jpg",
        "init_img": init_img_path,
        "num_images": 1,
        "image_width": 512,
        "image_height": 512,
        "decoder_steps": 100,
        "decoder_guidance_scale": 12,
        "self_training": self_training
    }

    prompt_generation_data={
        "prompt_generation_policy": prompt_generation_policy
    }

    image_embedding= image_embedding.detach().cpu().numpy().tolist()[0]
    negative_image_embedding= image_embedding.detach().cpu().numpy().tolist()[0] if negative_image_embedding is not None else None

    # create the job
    generation_task = GenerationTask(uuid=task_uuid,
                                     task_type=task_type,
                                     model_name=model_name,
                                     model_file_name=model_file_name,
                                     model_file_path=model_file_path,
                                     task_input_dict=task_input_dict,
                                     prompt_generation_data=prompt_generation_data)
    generation_task_json = generation_task.to_dict()

    # add job
    response = generation_request.http_add_kandinsky_job(job=generation_task_json,
                                                         positive_embedding=image_embedding,
                                                         negative_embedding=negative_image_embedding)

    return response


if __name__ == "__main__":
    image_embedding_list = [-3.242468455147786, 0.9695707858981303, -3.803700775446511, -1.7098007897472798, 1.1709431798923573, 1.712597628552755, -0.8945222779512076, 0.9038450739694589, -4.146779668918157, -1.5587714942516095, -1.6203019479720677, -3.7403057625224028, 0.8828687829283937, 0.7337040466363736, 2.0211821767568714, 1.9764327558692656, -0.9341441610287755, 0.5742842347242771, 1.5895367211118385, 0.064618629901504, -1.4692726524763975, 0.5020325655828299, -2.1610241170306406, -1.3219724753880275, 1.2082343639653623, -0.14601829263586025, 1.9615162822400636, -2.151701321012389, -2.878879410435987, 0.43514150415187725, -1.1150064037828498, -4.441380023094897, -1.645473497221346, -2.3232407677482123, 1.8571009668356495, 0.14706710718791352, 1.1429747918376036, -0.2144243084197788, 0.6027187625799435, 3.1436468173543224, 1.9167668613524576, 0.5803440521361405, -0.8749444063128801, -0.44889262827879783, 1.4776631688928235, 0.7206521322108218, -5.2058492965914995, -2.433249760763577, -0.21873610157822002, -2.062202479237177, 0.8614263520864157, -3.095168278059416, -2.136784847383187, -1.2753584952967714, 0.3081184084032039, 1.4748663300873481, -3.022450469117056, -0.6759027113232158, 0.4279163372377325, 1.049746831655091, -0.5836070307425284, -0.07866109140399495, 7.853523365774855, -1.033898078424064, 0.5929298267607797, 0.18505750096228737, 0.7765889083203293, -0.8651554704937162, -1.8244711807717702, 0.7206521322108218, 1.8347262563918465, 1.4235909519869663, 2.707339963700164, 0.04917774899627536, -1.8132838255498687, 0.647934323268462, 2.8397236671593316, 0.5230088566238953, 1.93541245338896, -4.068468182364847, -2.955326337785647, -0.5742842347242771, -1.8114192663462183, -0.18121184760475872, -0.8138800923933344, 1.9484643678145117, 4.929894534451263, 2.9721073706184993, 1.0777152197098447, 2.1162746961430345, -0.24355804597681396, 0.3976172501784159, -3.020585909913406, 1.175604577901483, -1.8617623648447752, 0.07574771764829143, -1.0674601440897684, 1.623098786777543, -2.940409864156445, -2.6085183259067004, -1.9391415717962606, -1.734040059394733, -0.7113293361925705, -2.6831006940527105, 3.982698458996935, -0.12748923554958588, -1.6128437111574667, 0.5174151790129445, -3.5370688093245253, 1.3667218962756336, -1.8776111180758024, -2.23187736676935, 1.4217263927833161, -2.257981195620453, -0.47476338722944506, -0.9854195391291574, 3.365529362588702, 0.5947943859644299, 0.5332639322439716, -0.5603000406969003, 0.9947423351474086, -1.9335478941853097, -0.982622700323682, 1.7293786613856075, -1.734040059394733, -0.1298199345541487, -0.18645592036502506, 2.299001498100759, 2.3698547478394683, 0.4950404685691415, 0.13972540532354064, -2.164753235437941, 0.677767270526866, -0.49550660837005406, -2.3344281229701136, -3.028044146728007, 0.038106928724601995, 0.4255856382331697, -1.2082343639653623, -2.5861436154628974, 5.772675294501176, 4.568170048943114, -0.677767270526866, -0.6078463003899817, -1.6445412176195209, -2.968378252211199, 3.7496285585406537, 2.280355906064256, -0.6889546257487675, 1.4161327151723653, -1.3089205609624759, -1.2082343639653623, -0.40134636858571643, 5.079059270743283, -1.9149023021488072, 1.0842411769226208, -0.6954805829615435, -1.533599945002331, 2.724120996533016, -0.8549003948736399, -0.0482163356568932, -0.16722765357738184, 1.533599945002331, -2.0305049727751228, 1.7536179310330606, -2.002536584720369, 0.80036203816687, -1.7974350723188415, -1.881340236483103, 0.05538323509592385, -0.8129478127915092, -0.08425476901494569, -0.09136340097886228, 0.7397638640482369, -2.151701321012389, -0.8940561381502952, 2.1833988274744436, -1.5373290634096315, 1.3145142385734265, -0.498769586976442, -1.8934598713068294, 2.7987033646790263, 0.042739192996170586, -2.9441389825637456, -0.6358146884447354, 0.21279281911658485, 1.6370829808049199, -0.6987435615679314, -0.4875822317545405, 1.5597037738534345, -1.8067578683370928, 0.8194737700042851, 2.477999181651183, 3.20144815266748, -0.38712910465788325, -0.5383914700540099, -2.3045951757117096, -1.0823766177189704, -2.1684823538452416, 5.623510558209156, -0.5090246625965184, 0.26779731562426723, -7.338905025567386, -0.8977852565575957, -0.5854715899461786, 1.3862997679139613, -0.36125834570723603, -1.890663032501354, 10.896483986132065, -0.7719275103112038, -1.9671099598510142, 1.7461596942184596, 0.06188005857114269, -1.7359046185983833, 1.7098007897472798, -0.38479840565332046, -1.621234227573893, -2.2598457548241035, -0.6078463003899817, 0.11583574052677181, 2.075254393662729, -0.8437130396517384, -4.560711812128512, 1.362992777868333, 1.6464057768231712, -1.1467039102449041, -0.570088976516064, 0.325598650937425, 4.780729798159243, -2.3754484254504193, 5.1014339811870855, 0.2629028477146853, -0.2878413270635074, 0.662850796897664, -0.2362163441124411, 1.9186314205561077, -0.908040332177672, 3.227551981518584, 0.8805380839238308, -1.4105390375614146, -0.439103692459634, -2.15729499862334, -2.918035153712642, 1.280019893305897, 2.1554304394196895, -0.9374071396351634, -1.5923335599173138, 0.40484241709256064, 2.336292682173764, 3.059741653190061, 0.25101628279141497, 5.675718215911362, -4.325777352468581, 2.5208840433351387, -1.957787163832763, -3.1660215277981254, -2.6103828851103508, 0.6880223461469425, -3.2704368432025395, 0.30905068800502905, 0.17841500879928335, -3.2406038959441354, -2.589872733870198, -0.2848114183575758, -4.120675840067054, -3.235010218333185, -3.79624253863191, 0.6344162690419978, 2.3120534125263106, -1.651067174832297, -4.83666657426875, 0.4213903800249566, -0.681030249133254, 1.3275661529989784, -1.7629407270513118, -1.1345842754211775, -3.0168567915061053, 3.520287776491673, 1.9671099598510142, 2.627163917943203, -3.231281099925884, 2.0584733608298764, -0.9420685376442891, 1.5205480305767793, 3.0933037188557657, -0.7626047142929525, 2.4612181488183307, 0.5444512874658731, 2.560039786611794, 3.4848611516223182, 0.7546803376774389, -7.905731023477062, -2.5712271418336954, -2.254252077213153, -0.4363068536541586, -1.8282002991790707, 0.9215583864041363, 0.10627987460806428, -1.972703637461965, 0.9038450739694589, 1.4235909519869663, 0.06001549936749244, 0.5822086113397907, 2.069660716051778, 2.4742700632438823, -1.3378212286190547, -1.1355165550230026, 0.6931498839569806, -2.060337920033527, 0.7327717670345485, -5.023122494633775, -0.05287773366601883, 2.9870238442477013, -1.4235909519869663, 3.9715111037750335, -2.142378524994138, -1.771331243467738, 2.295272379693458, -1.2362027520201162, 2.0081302623313197, 0.45611779519294254, -3.488590270029619, 0.1355301471153276, 0.1355301471153276, -6.17542008248963, 0.4927097695645787, 3.279759639220791, 0.24961786338867728, 1.1625526634759311, 0.3057877093986411, 0.12422625694319794, 1.2082343639653623, 1.0627987460806427, -0.6027187625799435, -2.9870238442477013, 0.17037409723354163, 6.149316253638526, 0.6530618610785003, -4.997018665782671, -0.5225427168229827, 8.912592993448197, 0.13145142385734265, -4.139321432103556, 4.944811008080465, 0.12457586179388236, -1.3275661529989784, -2.3045951757117096, 2.239335603583951, 2.343750918988365, -0.5439851476649606, 2.5413941945752914, -0.5761487939279274, -3.57249543419388, -0.5057616839901304, -1.6352184216012697, -1.4720694912818728, -1.6864937997016516, 1.3368889490172295, 0.2395958576690572, 0.27222564373293656, -1.8860016344922284, -0.7113293361925705, 5.817424715388782, 1.6389475400085702, -2.5096966881132374, 1.3601959390628577, -1.965245400647364, 2.0211821767568714, -2.767005858216972, 2.867692055214085, -0.5206781576193324, -1.145771630643079, -2.0193176175532215, 1.8692206016593762, 1.087038015728096, -3.6153802958778356, -3.691827223227496, -0.4288486168395576, -2.5786853786482964, 4.01998964306994, 3.400955987458057, 0.5947943859644299, -2.5134258065205377, -1.0255075620076377, 0.8763428257156177, 1.5298708265950305, 3.6601297167654416, -0.20102278914354263, 4.598002996201518, -0.26150442831194765, -3.5538498421573776, 3.290946994442692, -2.172211472252542, 0.3057877093986411, 0.5584354814932501, 1.0851734565244457, -4.788188034973843, 1.608182313148341, 1.1578912654668057, -0.8945222779512076, -0.543519007864048, -5.8248829522033825, -2.4761346224475327, -1.9465998086108616, -1.3303629918044537, -1.8319294175863712, 2.0789835120700295, 2.299001498100759, 1.8934598713068294, 0.06397768767524922, -1.4795277280964738, 0.8180753506015475, 2.1386494065868376, 1.087038015728096, -1.4981733201329763, -4.1057593664378516, 4.16542526095466, -3.7869197426136587, -2.114410136939384, 0.9416023978433765, 4.61291946983072, 0.12970339960392055, 0.8343902436334871, -0.2703610845292863, -4.728522140457035, -0.89312385854847, -0.364521324313624, 0.9243552252096117, -1.3956225639322126, 2.062202479237177, 1.5541100962424839, -1.7293786613856075, -0.41602977231446214, 0.8162107913978972, 1.4198618335796658, -2.149836761808739, 0.40833846559940484, 0.24192655667362, -3.1753443238163768, -0.840916200846263, 2.287814142878857, 1.0012682923601846, -2.4015522543015226, 0.7644692734966028, 0.643739065060249, -1.3993516823395131, 1.9447352494072112, 1.0087265291747856, -0.6274241720283094, -0.9075741923767594, -0.7845132849358429, -0.3600929962049546, -2.276626787656956, -0.9346103008296881, -3.089574600448465, 0.014989307973094591, -1.680900122090701, 0.6428067854584238, -1.6641190892578486, -0.7654015530984278, 1.3564668206555572, -0.6283564516301344, -0.2922696551721768, -1.0432208744423153, -1.689290638507127, 0.4118345141062491, -0.9667739470926549, 3.141782258150672, -4.139321432103556, 1.8375230951973218, 1.2091666435671875, 0.4244202887308883, -1.577417086288112, 2.1889925050853942, 3.1921253566492287, -2.6047892074994, 1.2119634823726628, 0.9928777759437584, 1.2222185579927392, -3.770138709780807, -1.1485684694485543, -1.4851214057074245, 0.9788935819163815, -0.6717074531150028, -0.7896408227458811, -3.4867257108259686, 1.5904690007136637, 0.3283954897429004, 1.7452274146166344, 3.443840849142013, 2.127462051364936, 1.3070560017588255, 0.06817294588346229, -0.8628247714891535, -1.4702049320782224, -0.19426376203031048, 0.96770622669448, 2.2747622284533056, 2.597330970684799, 0.569156696914239, -1.7526856514312354, -2.4164687279307246, 0.9705030654999554, 2.0211821767568714, -0.062462733322283394, -2.2039089787145962, -0.17503549524266726, 2.1889925050853942, 1.1821305351142588, 0.9103710311822348, -0.1490482013417919, -0.5230088566238953, 2.670048779627159, -1.5587714942516095, -1.6855615200998264, -0.43514150415187725, 0.9113033107840599, -4.888874231970957, 1.4692726524763975, 0.4220895897263255, 0.8106171137869465, 0.055033630245239426, 1.6184373887684174, -2.6103828851103508, -3.208906389482081, 1.1355165550230026, -0.10435704792929996, -3.12686578452147, -1.2408641500292417, -0.043846275023337926, -3.1361885805397214, 1.660389970850548, -4.109488484845152, 3.447569967549313, -0.22095026563255468, 0.032076245050295715, 0.010429878045418589, 1.719123585765531, 1.674374164877925, 2.7949742462717255, 3.3114571456828448, 2.2188254523437982, 4.404088839021892, -2.9049832392870902, -0.975164463509081, 2.032369531978773, -0.21617233267320093, -0.6563248396848882, 0.9611802694817041, 3.0038048770805537, 1.0255075620076377, -0.3318915382497446, -1.0618664664788178, 0.2164054025736572, -0.32373409173377476, -0.08699334034530701, -1.7508210922275853, -0.8306611252261866, 2.910576916898041, -2.5395296353716414, 1.0972930913481724, 0.4861838123518028, -2.932951627341844, -1.9484643678145117, -0.6372131078474731, 1.3946902843303874, 3.6825044272092446, -2.0491505648116255, -2.729714674143967, -0.3146443656159798, -2.261710314027754, -0.6115754187972822, -1.3751124126920597, 0.539323749655835, -2.090170867291931, -3.5706308749902296, 1.8860016344922284, -1.8524395688265238, 2.2374710443803005, -0.8511712764663394, -1.7144621877564055, 2.3791775438577196, 1.1588235450686306, 1.5941981191209642, 0.5346623516467094, -0.280849230049819, 0.9182954077977484, -2.106951900124783, 1.5046992773457522, -1.7750603618750385, -2.8173489567155285, -0.8246013078143233, 0.3780393785400883, 3.7645450321698557, 1.197979288345286, 0.197177135786014, 0.837653222239875, 2.664455102016208, 3.4792674740113676, 0.9425346774452017, 0.7225166914144721, 0.4227887994276943, -0.09351929755808287, 3.5389333685281756, 2.1703469130488915, 4.486129443982502, 2.658861424405257, -4.053551708735645, -0.3391167051638893, -1.7387014574038586, -0.03988408671558114, -0.8269320068188861, -0.7239151108172097, 0.7593417356865645, 1.2399318704274167, 1.7349723389965581, -1.117803242588325, 2.4574890304110304, -2.054744242422576, -0.19041810867278183, 1.8552364076319994, 1.079579778913495, 2.7651412990133215, 1.569958849473511, -2.164753235437941, -1.145771630643079, -0.65119730187485, 0.20510151240152755, 0.21943531127958885, 1.6519994544341219, 2.261710314027754, 0.11536960072585925, -0.3020585909913406, 4.135592313696256, 0.09654920626401453, -0.8283304262216238, 0.6097108595936319, -0.7206521322108218, 3.27603052081349, 2.5115612473168873, -0.6171690964082329, 4.53833710168471, 2.388500339875971, -2.865827496010435, -1.6930197569144274, 2.239335603583951, -2.4985093328913357, -0.8917254391457323, 3.2704368432025395, 0.7733259297139414, 1.3956225639322126, -1.808622427540743, 0.22910771214852454, 0.7472221008628379, 0.5794117725343153, 0.9686385062963051, -0.2710602942306552, -0.3426127536707335, -4.829208337454149, -0.11531133325074518, -1.7834508782914646, -0.5472481262713486, -0.5020325655828299, -0.6045833217835938, 0.25381312159689035, 0.2731579233347617, 0.7598078754874771, -2.584279056259247, -0.2221156151348361, 0.05127537810038189, 1.280952172907722, 0.47709408623400784, 4.187799971398463, -1.3900288863212618, 3.5407979277318256, -1.048814552053266, 1.1541621470595052, -0.6740381521195655, -0.7896408227458811, 1.681832401692526, 2.4966447736876853, -0.5547063630859496, -0.19472990183122305, -1.3266338733971532, -2.2412001627876013, 3.4997776252515203, -1.0227107232021624, 0.16617883902532857, 4.534607983277409, 1.6398798196103954, -1.696748875321728, -3.7831906242063584, 0.422555729527238, 0.39505348127339684, 0.10383264065327333, 0.714126174998046, -1.3937580047285623, 0.10354130327770297, 1.3415503470263552, -2.7427665885695185, 0.8166769311988097, 2.3456154781920153, 0.03417387415440225, 0.35240168948989736, 0.16244972061802807, 0.5150844800083817, 2.144243084197788, -0.8730798471092298, -4.109488484845152, 0.18668899026548133, -2.8844730880469376, 1.6939520365162526, 1.1811982555124336, 1.0255075620076377, -2.1833988274744436, 0.6181013760100581, -0.9271520640150871, 0.8432468998508258, 3.550120723750077, 1.6119114315556415, 0.5001680063791797, -4.01998964306994, 0.6255596128246591, -1.2613743012693945, -1.339685787822705, -2.9944820810623023, 1.3005300445460497, -1.1951824495398107, 1.0730538217007193, 0.13226716850893966, -2.724120996533016, 0.09969564992017434, -2.9758364890258, -2.5115612473168873, 0.8511712764663394, 2.4127396095234244, -0.9947423351474086, 3.762680472966206, -0.4579823543965928, 0.8875301809375192, 0.39248971236837776, -0.019927476489012053, -0.6549264202821505, 0.4514563971838169, -4.0460934719210435, 1.280952172907722, -1.666915928063324, 0.7360347456409364, -0.06485169980196027, 1.1728077390960077, 2.9665136930075486, -1.7303109409874324, 0.5383914700540099, -2.4593535896146803, 0.9770290227127313, 0.908040332177672, 1.696748875321728, 0.19741020568647027, 2.629028477146853, 0.6400099466529485, 4.6352941802745224, 1.3154465181752517, 0.6656476357031395, -1.8953244305104797, 0.6194997954127958, 0.3020585909913406, -2.5880081746665478, 2.545123312982592, -1.8673560424557258, -2.9441389825637456, -0.2768870417420622, 1.5317353857986808, 2.5283422801497397, 0.33631986635841393, -0.2731579233347617, 1.883204795686753, -2.4742700632438823, -2.5488524313898924, -0.9364748600333384, 1.5447873002242325, 4.952269244895065, 0.9224906660059614, -1.1122095649773744, -0.29390114447537075, 0.21221014436544414, -3.0560125347827607, -0.32723014024061897, 2.4052813727088234, 4.0013440510334375, -0.15242771489840798, 1.6128437111574667, 3.089574600448465, 0.29786333278312754, 2.2486583996022023, 1.4347783072088678, -0.7686645317048157, -0.4752295270303576, 1.8151483847535188, 0.5458497068686109, -0.36265676510997374, -2.673777898034459, 1.0217784436003372, 0.2252620587909959, 0.4973711675737043, -2.0211821767568714, 0.9024466545667212, 0.1951960416321356, 0.5374591904521847, 0.4964388879718792, -4.91124894241476, -0.5323316526421465, 0.6423406456575113, 0.15033008579430146, 0.8875301809375192, -3.691827223227496, 0.11268929687061202, -1.7470919738202848, -0.9122355903858851, -1.481392287300124, 2.45562447120738, 1.719123585765531, -1.8869339140940535, -2.3754484254504193, 0.524407276026633, 5.313993730403214, 0.40227864818754155, 2.916170594508992, -1.9540580454254626, -1.0581373480715173, 2.5488524313898924, -0.09177127330466077, -2.440707997578178, 4.735980377271637, 0.08938230682498388, -2.106951900124783, 1.578349365889937, -1.8925275917050044, -2.4724055040402324, 1.7060716713399793, 1.6781032832852254, -0.5966589451680802, -0.13436479761304618, 1.7899768355042405, 1.1467039102449041, 0.7108631963916581, 2.729714674143967, -1.3723155738865844, -0.5705551163169766, -1.2837490117131976, 1.9782973150729157, 3.550120723750077, 0.506227823791043, 1.1522975878558548, -1.1886564923270346, -1.4534238992453703, -4.844124811083351, 0.7122616157943957, -1.4030808007468136, 2.8471819039739326, -0.2908712357694391, 1.4767308892909985, -1.1709431798923573, 1.1066158873664238, 3.6713170719873434, 1.0889025749317462, -0.3097498977063979, 2.968378252211199, -1.7918413947078908, -0.5794117725343153, -0.9695707858981303, 1.881340236483103, 2.127462051364936, -0.5099569421983435, 1.0357626376277143, 0.647934323268462, -0.256843030302822, -3.453163645160264, 0.900582095363071, 1.1299228774120518, 2.0305049727751228, 0.740696143650062, 5.548928190063146, 0.2815484397511878, 1.3788415310993603, -0.7225166914144721, 0.6721735929159153, 0.27921774074662503, -1.5615683330570849, 2.3922294582832713, 0.9313473222233002, -2.4817283000584833, -0.4680043601162129, 1.6445412176195209, 1.4040130803486386, -3.9416781565166294, 0.8208721894070228, 2.865827496010435, -0.945331516250677, -0.6222966342182711, -1.569958849473511, -1.7293786613856075, -1.093563972940872, -1.3788415310993603, -1.3145142385734265, -1.4869859649110748, 4.586815640979617, -1.0189816047948619, -1.2716293768894709, 3.7403057625224028, 1.0842411769226208, 1.250186946047493, -2.554446109000843, -1.913037742945157, -4.590544759386916, -2.5637689050190944, -2.666319661219858, 2.2057735379182466, 3.363664803385052, 0.4069400461966672, 1.093563972940872, -1.2473901072420177, -0.3230348820324059, 1.2753584952967714, -0.4575162145956802, -0.9145662893904479, -1.197979288345286, 0.7015404003734068, 1.2706970972876457, -0.7402300038491495, 2.8285363119374303, -1.443168823625294, 4.329506470875882, 0.8684184491001042, -0.19822595033806725, -0.8479082978599515, 0.9910132167401081, -1.734040059394733, 2.696152608478262, -3.372987599403303, -4.322048234061281, 0.3304931188470069, 3.3151862640901455, -1.2399318704274167, -1.793705953911541, 1.7312432205892576, 1.362060498266508, -1.0040651311656599, -2.121868373753985, -0.1622166507175718, -1.3965548435340376, 0.2430919061759014, 5.865903254683688, -0.685225507341467, -0.031114831710913556, -3.2629786063879385, -3.4792674740113676, -0.1502135508440733, -0.9872840983328076, 1.2212862783909142, -3.4550282043639142, 1.606317753944691, -0.8362548028371374, 1.555042375844309, 1.5046992773457522, -0.8698168685028419, 1.2940040873332739, 1.4319814684033925, -1.652931734035947, 5.80623736016688, 1.7424305758111591, -1.9465998086108616, 1.0320335192204138, 2.849046463177583, -2.1255974921612855, -1.2968009261387492, 1.4161327151723653, -1.5242771489840798, 0.8297288456243614, 1.6706450464706244, -0.7462898212610127, -2.5954664114811488, -0.9476622152552399, 1.428252349996092, 0.10616333965783614, -0.49317590936549127, -0.1315679588075708, -3.013127673098805, 4.840395692676051, -2.1088164593284335, 1.3732478534884096, 1.7424305758111591, 0.4528548165865546, -0.4290816867400139, 0.8311272650270992, -1.7144621877564055, -1.3592636594610326, 0.8973191167566831, 3.997614932626137, 1.5662297310662106, 2.2225545707510985, -1.2623065808712197, 1.4841891261055995, 2.522748602538789, 1.4170649947741905, -3.393497750643456, 2.5712271418336954, 1.547584139029708, -1.3201079161843774, -0.491311350161841, -1.7508210922275853, -3.1604278501871748, -1.7098007897472798, 0.6665799153049645, -4.594273877794217, -3.676910749598294, 1.3145142385734265, 0.18097877770430243, 0.35985992630449837, -1.4394397052179935, 1.1420425122357785, 1.52614170818773, -1.2660356992785202, 2.0305049727751228, 4.7098765484205325, 0.8017604575696077, 0.3964519006761345, 1.087038015728096, -2.985159285044051, 1.4879182445129, -2.5115612473168873, -0.6936160237578932, 0.0793603011053638, -0.38386612605149534, -0.5509772446786491, 1.3340921102117542, -3.5072358620661213, -1.5755525270844617, 0.6847593675405546, 1.7694666842640878, 1.7806540394859893, -1.0655955848861183, -2.2971369388971086, 1.473934050485523, 0.3095168278059416, -0.9383394192369886, -3.216364626296682, 3.0243150283207063, -0.0710863196391658, 1.7573470494403611, 1.9540580454254626, 0.8842672023311313, 1.7470919738202848, -1.1392456734303031, 0.30019403178769033, 0.41975889072176265, 3.249926691962387, 1.6948843161180778, 0.4787255755372018, -2.00999482153497, -2.4518953528000793, -2.763276739809671, -0.22048412583164212, 0.3717464912277687, 0.7211182720117344, 1.1019544893572981, 0.1765504495956331, -2.0491505648116255, 1.8766788384739772, -1.9838909926838666, 2.3474800373956652, 1.56250061265891, -0.8712152879055796, -1.4907150833183753, 1.720055865367356, -1.5233448693822547, -0.35636387779765416, -1.4114713171632396, -1.4403719848198184, -2.250522958805852, 0.14520254798426327, 4.288486168395576, 0.7546803376774389, -1.5615683330570849, -4.433921786280296, 5.541469953248544, -1.1625526634759311, -0.09398543735899544, -2.002536584720369, 1.3965548435340376, -3.2704368432025395, -1.125261479402926, 0.7901069625467937, 1.0916994137372218, 0.7863778441394932, 1.0758506605061946, -1.6398798196103954, 0.1997409046910331, -3.089574600448465, 1.6408120992122204, -1.0516113908587412, 1.4879182445129, 2.2076380971218965, -1.2334059132146407, -0.24262576637498884, -0.9928777759437584, 0.7723936501121162, 0.4824546939445023, -0.3060207792990974, 1.6641190892578486, -1.0087265291747856, 2.910576916898041, -2.865827496010435, 0.1820275922563557, -1.540125902215107, 1.9149023021488072, 2.1554304394196895, 1.5960626783246143, 1.1150064037828498, -0.7337040466363736, -0.5854715899461786, -0.9290166232187373, 0.96770622669448, -0.8017604575696077, -0.8688845889010167, -2.8322654303447306, 1.0171170455912117, 2.8098907199009275, 1.3201079161843774, -4.329506470875882, -3.7458994401333534, -0.8040911565741705, 2.7203918781257155, -0.021500698317091952, 3.220093744703983, 0.6045833217835938, 0.8656216102946288, 2.3325635637664632, 0.3815354270469325, -3.937949038109329, -0.524407276026633, 1.6025886355373904, -1.883204795686753, 3.466215559585816, -8.85292709893139, -1.7321755001910828, -1.9782973150729157, 2.2635748732314043, -3.5016421844551706, 1.8850693548904034, 0.20859756090837178, 1.183062814716084, -0.34890564098305316, -1.771331243467738, -0.6050494615845063, -4.4637547335387, -0.8162107913978972, 3.3748521586069535, 1.7396337370056838, 0.9001159555621584, -3.5221523356953233, 1.459017576856321, 1.6370829808049199, -1.950328927018162, -1.488850524114725, -0.23365257520742203, -0.8726137073083172, 0.27292485343430545, -2.711069082107464, 0.1304026093052894, -2.880743969639637, 2.7203918781257155, -0.33398916735385115, 0.17212212148696376, -4.038635235106443, -0.6549264202821505, -1.2306090744091653, -0.1676937933782944, -1.584875323102713, 2.024911295164172, 1.1998438475489361, 0.8726137073083172, -3.179073442223677, 0.3827007765492139, -0.6558586998839756, -1.4245232315887915, -2.3045951757117096, -2.1013582225138325, 3.2555203695733375, 3.863366669963319, 1.4254555111906166, -0.2880743969639637, -1.6939520365162526, 1.2334059132146407, -0.6898869053505927, -0.385264545454233, 0.5742842347242771, -1.9223605389634082, -1.2362027520201162, -2.6980171676819125, 1.9708390782583147, -3.022450469117056, 1.1588235450686306, 1.2334059132146407, -3.2294165407222337, -0.18412522136046225, 1.5671620106680355, -2.067796156848128, -3.5985992630449837, 1.9046472265287309, -1.8104869867443933, -1.9316833349816596, -0.785445564537668, -0.1215459530879507, 2.328834445359163, 1.0450854336459654, -3.8894704988144224, -1.048814552053266, 0.531865512841234, -4.128134076881655, -1.5205480305767793, 1.45155934004172, 2.0230467359605218, 2.673777898034459, 1.0665278644879432, 0.8562988142763776, -4.430192667872995, -0.17293786613856074, 0.12597428119662005, 0.19577871638327632, 1.4674080932727471, -0.5980573645708178, 4.732251258864336, 0.04338013522242536, 0.8404500610453505, -5.903194438756693, -2.477999181651183, 1.808622427540743, -0.8977852565575957, -1.8104869867443933, -0.3745433300332441, 0.49923572677735456, -2.880743969639637, 0.22467938403985518, 1.4860536853092496, -0.729042648627248, 1.9111731837415067, -1.34061806742453, 1.212895761974488, -1.034830358025889, -0.5770810735297526, -1.1560267062631553, 0.16687804872669743, 0.32280181213194964, -0.012097784520558852, -1.303326883351525, 3.7160664928749494, -0.45262174668609834, 2.0789835120700295, -0.4715004086230571, -3.1138138700959184, -1.8039610295316173, 0.3130128763127858, 4.277298813173675, 2.5134258065205377, 0.48851451135636564, -1.183062814716084, -0.28667597756122604, 2.5171549249278384, 0.9565188714725785, 1.0003360127583594, 1.0674601440897684, -2.2859495836752073, -3.602328381452284, 0.24052813727088232, 4.258653221137172, -3.0485542979681597, 2.166617794641591, 0.7299749282290731, -4.307131760432079, 1.45155934004172]
    image_embedding_tensor = torch.tensor(image_embedding_list)
    normalized_tensor = torch.nn.functional.normalize(image_embedding_tensor, p=2, dim=0)
    image_embedding_tensor = torch.unsqueeze(image_embedding_tensor, 0)
    negative_image_embedding = None
    prompt_generation_policy = "top-k"

    # Generate img2img generation jobs with Kandinsky using the embeddings
    response = generate_img2img_generation_jobs_with_kandinsky(
        image_embedding=image_embedding_tensor,
        negative_image_embedding = None,  
        dataset_name="test-generations",
        prompt_generation_policy=prompt_generation_policy
    )

    print(response)