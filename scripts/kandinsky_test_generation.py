import io
import sys
import os
import uuid
import torch


base_directory = os.getcwd()
sys.path.insert(0, base_directory)

from utility.http import generation_request
from utility.http import request
from utility.minio.cmd import connect_to_minio_client, upload_data
from worker.generation_task.generation_task import GenerationTask
from kandinsky_worker.dataloaders.image_embedding import ImageEmbedding

def read_msgpack_file(file_path):
    """Reads a msgpack file and returns its bytes."""
    with open(file_path, "rb") as f:
        return f.read()

def generate_img2img_generation_jobs_with_kandinsky(image_embedding,
                                                    negative_image_embedding,
                                                    dataset_name,
                                                    prompt_generation_policy,
                                                    self_training= False,
                                                    init_img_path="./test/test_inpainting/white_512x512.jpg"):

    # get sequential ids
    sequential_ids = request.http_get_sequential_id(dataset_name, 1)

    count = 0
    # generate UUID
    task_uuid = str(uuid.uuid4())
    task_type = "img2img_generation_kandinsky"
    model_name = "kandinsky_2_2"
    model_file_name = "kandinsky-2-2-decoder"
    model_file_path = "input/model/kandinsky/kandinsky-2-2-decoder"
    task_input_dict = {
        "strength": 0.75,
        "seed": "",
        "dataset": dataset_name,
        "file_path": sequential_ids[count]+".jpg",
        "init_img": init_img_path,
        "num_images": 1,
        "image_width": 512,
        "image_height": 512,
        "decoder_steps": 100,
        "decoder_guidance_scale": 12,
        "self_training": self_training
    }

    prompt_generation_data={
        "prompt_generation_policy": prompt_generation_policy
    }

    image_embedding= image_embedding.detach().cpu().numpy().tolist()[0]
    negative_image_embedding= image_embedding.detach().cpu().numpy().tolist()[0] if negative_image_embedding is not None else None

    # create the job
    generation_task = GenerationTask(uuid=task_uuid,
                                     task_type=task_type,
                                     model_name=model_name,
                                     model_file_name=model_file_name,
                                     model_file_path=model_file_path,
                                     task_input_dict=task_input_dict,
                                     prompt_generation_data=prompt_generation_data)
    generation_task_json = generation_task.to_dict()

    # add job
    response = generation_request.http_add_kandinsky_job(job=generation_task_json,
                                                         positive_embedding=image_embedding,
                                                         negative_embedding=negative_image_embedding)

    return response


if __name__ == "__main__":
    image_embedding_list = [-1.621234227573893, 0.48478539294906514, -1.9018503877232555, -0.8549003948736399, 0.5854715899461786, 0.8562988142763776, -0.4472611389756038, 0.45192253698472945, -2.0733898344590784, -0.7793857471258048, -0.8101509739860339, -1.8701528812612014, 0.44143439146419683, 0.3668520233181868, 1.0105910883784357, 0.9882163779346328, -0.46707208051438776, 0.28714211736213857, 0.7947683605559193, 0.032309314950752, -0.7346363262381987, 0.25101628279141497, -1.0805120585153203, -0.6609862376940138, 0.6041171819826812, -0.07300914631793012, 0.9807581411200318, -1.0758506605061946, -1.4394397052179935, 0.21757075207593862, -0.5575032018914249, -2.2206900115474486, -0.822736748610673, -1.1616203838741062, 0.9285504834178248, 0.07353355359395676, 0.5714873959188018, -0.1072121542098894, 0.30135938128997175, 1.5718234086771612, 0.9583834306762288, 0.29017202606807024, -0.43747220315644003, -0.22444631413939892, 0.7388315844464117, 0.3603260661054109, -2.6029246482957498, -1.2166248803817885, -0.10936805078911001, -1.0311012396185886, 0.43071317604320786, -1.547584139029708, -1.0683924236915936, -0.6376792476483857, 0.15405920420160196, 0.7374331650436741, -1.511225234558528, -0.3379513556616079, 0.21395816861886624, 0.5248734158275455, -0.2918035153712642, -0.039330545701997476, 3.9267616828874274, -0.516949039212032, 0.2964649133803898, 0.09252875048114369, 0.38829445416016467, -0.4325777352468581, -0.9122355903858851, 0.3603260661054109, 0.9173631281959232, 0.7117954759934831, 1.353669981850082, 0.02458887449813768, -0.9066419127749343, 0.323967161634231, 1.4198618335796658, 0.26150442831194765, 0.96770622669448, -2.0342340911824235, -1.4776631688928235, -0.28714211736213857, -0.9057096331731092, -0.09060592380237936, -0.4069400461966672, 0.9742321839072559, 2.4649472672256314, 1.4860536853092496, 0.5388576098549224, 1.0581373480715173, -0.12177902298840698, 0.19880862508920796, -1.510292954956703, 0.5878022889507415, -0.9308811824223876, 0.03787385882414571, -0.5337300720448842, 0.8115493933887715, -1.4702049320782224, -1.3042591629533502, -0.9695707858981303, -0.8670200296973665, -0.3556646680962853, -1.3415503470263552, 1.9913492294984676, -0.06374461777479294, -0.8064218555787334, 0.25870758950647227, -1.7685344046622626, 0.6833609481378168, -0.9388055590379012, -1.115938683384675, 0.7108631963916581, -1.1289905978102266, -0.23738169361472253, -0.4927097695645787, 1.682764681294351, 0.29739719298221495, 0.2666319661219858, -0.28015002034845016, 0.4973711675737043, -0.9667739470926549, -0.491311350161841, 0.8646893306928037, -0.8670200296973665, -0.06490996727707435, -0.09322796018251253, 1.1495007490503795, 1.1849273739197341, 0.24752023428457076, 0.06986270266177032, -1.0823766177189704, 0.338883635263433, -0.24775330418502703, -1.1672140614850568, -1.5140220733640035, 0.019053464362300997, 0.21279281911658485, -0.6041171819826812, -1.2930718077314487, 2.886337647250588, 2.284085024471557, -0.338883635263433, -0.30392315019499083, -0.8222706088097604, -1.4841891261055995, 1.8748142792703268, 1.140177953032128, -0.34447731287438377, 0.7080663575861826, -0.6544602804812379, -0.6041171819826812, -0.20067318429285821, 2.5395296353716414, -0.9574511510744036, 0.5421205884613104, -0.34774029148077173, -0.7667999725011655, 1.362060498266508, -0.42745019743681995, -0.0241081678284466, -0.08361382678869092, 0.7667999725011655, -1.0152524863875614, 0.8768089655165303, -1.0012682923601846, 0.400181019083435, -0.8987175361594207, -0.9406701182415514, 0.027691617547961924, -0.4064739063957546, -0.042127384507472845, -0.04568170048943114, 0.36988193202411845, -1.0758506605061946, -0.4470280690751476, 1.0916994137372218, -0.7686645317048157, 0.6572571192867133, -0.249384793488221, -0.9467299356534147, 1.3993516823395131, 0.021369596498085293, -1.4720694912818728, -0.3179073442223677, 0.10639640955829242, 0.8185414904024599, -0.3493717807839657, -0.24379111587727026, 0.7798518869267173, -0.9033789341685464, 0.40973688500214256, 1.2389995908255915, 1.60072407633374, -0.19356455232894162, -0.26919573502700495, -1.1522975878558548, -0.5411883088594852, -1.0842411769226208, 2.811755279104578, -0.2545123312982592, 0.13389865781213361, -3.669452512783693, -0.44889262827879783, -0.2927357949730893, 0.6931498839569806, -0.18062917285361801, -0.945331516250677, 5.448241993066032, -0.3859637551556019, -0.9835549799255071, 0.8730798471092298, 0.030940029285571345, -0.8679523092991916, 0.8549003948736399, -0.19239920282666023, -0.8106171137869465, -1.1299228774120518, -0.30392315019499083, 0.05791787026338591, 1.0376271968313644, -0.4218565198258692, -2.280355906064256, 0.6814963889341665, 0.8232028884115856, -0.5733519551224521, -0.285044488258032, 0.1627993254687125, 2.3903648990796214, -1.1877242127252097, 2.5507169905935427, 0.13145142385734265, -0.1439206635317537, 0.331425398448832, -0.11810817205622055, 0.9593157102780538, -0.454020166088836, 1.613775990759292, 0.4402690419619154, -0.7052695187807073, -0.219551846229817, -1.07864749931167, -1.459017576856321, 0.6400099466529485, 1.0777152197098447, -0.4687035698175817, -0.7961667799586569, 0.20242120854628032, 1.168146341086882, 1.5298708265950305, 0.12550814139570748, 2.837859107955681, -2.1628886762342905, 1.2604420216675694, -0.9788935819163815, -1.5830107638990627, -1.3051914425551754, 0.34401117307347123, -1.6352184216012697, 0.15452534400251453, 0.08920750439964167, -1.6203019479720677, -1.294936366935099, -0.1424057091787879, -2.060337920033527, -1.6175051091665924, -1.898121269315955, 0.3172081345209989, 1.1560267062631553, -0.8255335874161485, -2.418333287134375, 0.2106951900124783, -0.340515124566627, 0.6637830764994892, -0.8814703635256559, -0.5672921377105887, -1.5084283957530527, 1.7601438882458365, 0.9835549799255071, 1.3135819589716016, -1.615640549962942, 1.0292366804149382, -0.47103426882214455, 0.7602740152883897, 1.5466518594278829, -0.38130235714647626, 1.2306090744091653, 0.27222564373293656, 1.280019893305897, 1.7424305758111591, 0.37734016883871946, -3.952865511738531, -1.2856135709168477, -1.1271260386065765, -0.2181534268270793, -0.9141001495895353, 0.46077919320206817, 0.05313993730403214, -0.9863518187309825, 0.45192253698472945, 0.7117954759934831, 0.03000774968374622, 0.29110430566989537, 1.034830358025889, 1.2371350316219412, -0.6689106143095274, -0.5677582775115013, 0.3465749419784903, -1.0301689600167634, 0.36638588351727425, -2.5115612473168873, -0.026438866833009413, 1.4935119221238506, -0.7117954759934831, 1.9857555518875167, -1.071189262497069, -0.885665621733869, 1.147636189846729, -0.6181013760100581, 1.0040651311656599, 0.22805889759647127, -1.7442951350148095, 0.0677650735576638, 0.0677650735576638, -3.087710041244815, 0.24635488478228934, 1.6398798196103954, 0.12480893169433864, 0.5812763317379656, 0.15289385469932054, 0.06211312847159897, 0.6041171819826812, 0.5313993730403214, -0.30135938128997175, -1.4935119221238506, 0.08518704861677082, 3.074658126819263, 0.32653093053925014, -2.4985093328913357, -0.26127135841149135, 4.456296496724098, 0.06572571192867133, -2.069660716051778, 2.4724055040402324, 0.06228793089694118, -0.6637830764994892, -1.1522975878558548, 1.1196678017919754, 1.1718754594941825, -0.2719925738324803, 1.2706970972876457, -0.2880743969639637, -1.78624771709694, -0.2528808419950652, -0.8176092108006349, -0.7360347456409364, -0.8432468998508258, 0.6684444745086148, 0.1197979288345286, 0.13611282186646828, -0.9430008172461142, -0.3556646680962853, 2.908712357694391, 0.8194737700042851, -1.2548483440566187, 0.6800979695314289, -0.982622700323682, 1.0105910883784357, -1.383502929108486, 1.4338460276070426, -0.2603390788096662, -0.5728858153215395, -1.0096588087766107, 0.9346103008296881, 0.543519007864048, -1.8076901479389178, -1.845913611613748, -0.2144243084197788, -1.2893426893241482, 2.00999482153497, 1.7004779937290284, 0.29739719298221495, -1.2567129032602689, -0.5127537810038189, 0.43817141285780886, 0.7649354132975152, 1.8300648583827208, -0.10051139457177131, 2.299001498100759, -0.13075221415597382, -1.7769249210786888, 1.645473497221346, -1.086105736126271, 0.15289385469932054, 0.27921774074662503, 0.5425867282622229, -2.3940940174869216, 0.8040911565741705, 0.5789456327334028, -0.4472611389756038, -0.271759503932024, -2.9124414761016912, -1.2380673112237663, -0.9732999043054308, -0.6651814959022269, -0.9159647087931856, 1.0394917560350148, 1.1495007490503795, 0.9467299356534147, 0.03198884383762461, -0.7397638640482369, 0.40903767530077373, 1.0693247032934188, 0.543519007864048, -0.7490866600664882, -2.0528796832189258, 2.08271263047733, -1.8934598713068294, -1.057205068469692, 0.47080119892168826, 2.30645973491536, 0.06485169980196027, 0.41719512181674356, -0.13518054226464316, -2.3642610702285176, -0.446561929274235, -0.182260662156812, 0.46217761260480583, -0.6978112819661063, 1.0311012396185886, 0.7770550481212419, -0.8646893306928037, -0.20801488615723107, 0.4081053956989486, 0.7099309167898329, -1.0749183809043694, 0.20416923279970242, 0.12096327833681, -1.5876721619081884, -0.4204581004231315, 1.1439070714394286, 0.5006341461800923, -1.2007761271507613, 0.3822346367483014, 0.3218695325301245, -0.6996758411697566, 0.9723676247036056, 0.5043632645873928, -0.3137120860141547, -0.4537870961883797, -0.39225664246792147, -0.1800464981024773, -1.138313393828478, -0.46730515041484405, -1.5447873002242325, 0.007494653986547296, -0.8404500610453505, 0.3214033927292119, -0.8320595446289243, -0.3827007765492139, 0.6782334103277786, -0.3141782258150672, -0.1461348275860884, -0.5216104372211576, -0.8446453192535635, 0.20591725705312455, -0.4833869735463274, 1.570891129075336, -2.069660716051778, 0.9187615475986609, 0.6045833217835938, 0.21221014436544414, -0.788708543144056, 1.0944962525426971, 1.5960626783246143, -1.3023946037497, 0.6059817411863314, 0.4964388879718792, 0.6111092789963696, -1.8850693548904034, -0.5742842347242771, -0.7425607028537122, 0.48944679095819077, -0.3358537265575014, -0.39482041137294055, -1.7433628554129843, 0.7952345003568319, 0.1641977448714502, 0.8726137073083172, 1.7219204245710065, 1.063731025682468, 0.6535280008794128, 0.034086472941731144, -0.43141238574457674, -0.7351024660391112, -0.09713188101515524, 0.48385311334724, 1.1373811142266528, 1.2986654853423996, 0.2845783484571195, -0.8763428257156177, -1.2082343639653623, 0.4852515327499777, 1.0105910883784357, -0.031231366661141697, -1.1019544893572981, -0.08751774762133363, 1.0944962525426971, 0.5910652675571294, 0.4551855155911174, -0.07452410067089595, -0.26150442831194765, 1.3350243898135794, -0.7793857471258048, -0.8427807600499132, -0.21757075207593862, 0.45565165539202995, -2.4444371159854783, 0.7346363262381987, 0.21104479486316274, 0.4053085568934732, 0.027516815122619713, 0.8092186943842087, -1.3051914425551754, -1.6044531947410405, 0.5677582775115013, -0.05217852396464998, -1.563432892260735, -0.6204320750146208, -0.021923137511668963, -1.5680942902698607, 0.830194985425274, -2.054744242422576, 1.7237849837746566, -0.11047513281627734, 0.016038122525147858, 0.0052149390227092945, 0.8595617928827655, 0.8371870824389624, 1.3974871231358628, 1.6557285728414224, 1.1094127261718991, 2.202044419510946, -1.4524916196435451, -0.4875822317545405, 1.0161847659893866, -0.10808616633660047, -0.3281624198424441, 0.48059013474085205, 1.5019024385402768, 0.5127537810038189, -0.1659457691248723, -0.5309332332394089, 0.1082027012868286, -0.16186704586688738, -0.043496670172653504, -0.8754105461137927, -0.4153305626130933, 1.4552884584490204, -1.2697648176858207, 0.5486465456740862, 0.2430919061759014, -1.466475813670922, -0.9742321839072559, -0.31860655392373655, 0.6973451421651937, 1.8412522136046223, -1.0245752824058127, -1.3648573370719834, -0.1573221828079899, -1.130855157013877, -0.3057877093986411, -0.6875562063460299, 0.2696618748279175, -1.0450854336459654, -1.7853154374951148, 0.9430008172461142, -0.9262197844132619, 1.1187355221901503, -0.4255856382331697, -0.8572310938782027, 1.1895887719288598, 0.5794117725343153, 0.7970990595604821, 0.2673311758233547, -0.1404246150249095, 0.4591477038988742, -1.0534759500623916, 0.7523496386728761, -0.8875301809375192, -1.4086744783577643, -0.41230065390716164, 0.18901968927004414, 1.8822725160849278, 0.598989644172643, 0.098588567893007, 0.4188266111199375, 1.332227551008104, 1.7396337370056838, 0.47126733872260085, 0.36125834570723603, 0.21139439971384716, -0.046759648779041436, 1.7694666842640878, 1.0851734565244457, 2.243064721991251, 1.3294307122026285, -2.0267758543678225, -0.16955835258194465, -0.8693507287019293, -0.01994204335779057, -0.41346600340944306, -0.36195755540860486, 0.37967086784328224, 0.6199659352137084, 0.8674861694982791, -0.5589016212941625, 1.2287445152055152, -1.027372121211288, -0.09520905433639092, 0.9276182038159997, 0.5397898894567476, 1.3825706495066608, 0.7849794247367555, -1.0823766177189704, -0.5728858153215395, -0.325598650937425, 0.10255075620076377, 0.10971765563979442, 0.8259997272170609, 1.130855157013877, 0.057684800362929625, -0.1510292954956703, 2.067796156848128, 0.048274603132007265, -0.4141652131108119, 0.30485542979681596, -0.3603260661054109, 1.638015260406745, 1.2557806236584437, -0.30858454820411646, 2.269168550842355, 1.1942501699379855, -1.4329137480052174, -0.8465098784572137, 1.1196678017919754, -1.2492546664456678, -0.44586271957286616, 1.6352184216012697, 0.3866629648569707, 0.6978112819661063, -0.9043112137703715, 0.11455385607426227, 0.37361105043141896, 0.28970588626715765, 0.48431925314815255, -0.1355301471153276, -0.17130637683536676, -2.4146041687270743, -0.05765566662537259, -0.8917254391457323, -0.2736240631356743, -0.25101628279141497, -0.3022916608917969, 0.12690656079844517, 0.13657896166738084, 0.37990393774373854, -1.2921395281296235, -0.11105780756741805, 0.025637689050190943, 0.640476086453861, 0.23854704311700392, 2.0938999856992315, -0.6950144431606309, 1.7703989638659128, -0.524407276026633, 0.5770810735297526, -0.33701907605978276, -0.39482041137294055, 0.840916200846263, 1.2483223868438427, -0.2773531815429748, -0.09736495091561152, -0.6633169366985766, -1.1206000813938006, 1.7498888126257601, -0.5113553616010812, 0.08308941951266428, 2.2673039916387046, 0.8199399098051977, -0.848374437660864, -1.8915953121031792, 0.211277864763619, 0.19752674063669842, 0.051916320326636664, 0.357063087499023, -0.6968790023642811, 0.051770651638851486, 0.6707751735131776, -1.3713832942847592, 0.40833846559940484, 1.1728077390960077, 0.017086937077201124, 0.17620084474494868, 0.08122486030901403, 0.25754224000419085, 1.072121542098894, -0.4365399235546149, -2.054744242422576, 0.09334449513274067, -1.4422365440234688, 0.8469760182581263, 0.5905991277562168, 0.5127537810038189, -1.0916994137372218, 0.30905068800502905, -0.46357603200754355, 0.4216234499254129, 1.7750603618750385, 0.8059557157778208, 0.25008400318958984, -2.00999482153497, 0.31277980641232955, -0.6306871506346973, -0.6698428939113525, -1.4972410405311511, 0.6502650222730249, -0.5975912247699053, 0.5365269108503596, 0.06613358425446983, -1.362060498266508, 0.04984782496008717, -1.4879182445129, -1.2557806236584437, 0.4255856382331697, 1.2063698047617122, -0.4973711675737043, 1.881340236483103, -0.2289911771982964, 0.4437650904687596, 0.19624485618418888, -0.009963738244506026, -0.32746321014107527, 0.22572819859190846, -2.0230467359605218, 0.640476086453861, -0.833457964031662, 0.3680173728204682, -0.03242584990098014, 0.5864038695480038, 1.4832568465037743, -0.8651554704937162, 0.26919573502700495, -1.2296767948073402, 0.48851451135636564, 0.454020166088836, 0.848374437660864, 0.09870510284323514, 1.3145142385734265, 0.32000497332647426, 2.3176470901372612, 0.6577232590876259, 0.3328238178515697, -0.9476622152552399, 0.3097498977063979, 0.1510292954956703, -1.2940040873332739, 1.272561656491296, -0.9336780212278629, -1.4720694912818728, -0.1384435208710311, 0.7658676928993404, 1.2641711400748699, 0.16815993317920697, -0.13657896166738084, 0.9416023978433765, -1.2371350316219412, -1.2744262156949462, -0.4682374300166692, 0.7723936501121162, 2.4761346224475327, 0.4612453330029807, -0.5561047824886872, -0.14695057223768537, 0.10610507218272207, -1.5280062673913803, -0.16361507012030949, 1.2026406863544117, 2.0006720255167187, -0.07621385744920399, 0.8064218555787334, 1.5447873002242325, 0.14893166639156377, 1.1243291998011011, 0.7173891536044339, -0.3843322658524079, -0.2376147635151788, 0.9075741923767594, 0.27292485343430545, -0.18132838255498687, -1.3368889490172295, 0.5108892218001686, 0.11263102939549795, 0.24868558378685215, -1.0105910883784357, 0.4512233272833606, 0.0975980208160678, 0.26872959522609235, 0.2482194439859396, -2.45562447120738, -0.2661658263210733, 0.32117032282875563, 0.07516504289715073, 0.4437650904687596, -1.845913611613748, 0.05634464843530601, -0.8735459869101424, -0.45611779519294254, -0.740696143650062, 1.22781223560369, 0.8595617928827655, -0.9434669570470268, -1.1877242127252097, 0.2622036380133165, 2.656996865201607, 0.20113932409377078, 1.458085297254496, -0.9770290227127313, -0.5290686740357586, 1.2744262156949462, -0.045885636652330385, -1.220353998789089, 2.3679901886358183, 0.04469115341249194, -1.0534759500623916, 0.7891746829449685, -0.9462637958525022, -1.2362027520201162, 0.8530358356699896, 0.8390516416426127, -0.2983294725840401, -0.06718239880652309, 0.8949884177521202, 0.5733519551224521, 0.35543159819582903, 1.3648573370719834, -0.6861577869432922, -0.2852775581584883, -0.6418745058565988, 0.9891486575364579, 1.7750603618750385, 0.2531139118955215, 0.5761487939279274, -0.5943282461635173, -0.7267119496226851, -2.4220624055416753, 0.35613080789719787, -0.7015404003734068, 1.4235909519869663, -0.14543561788471954, 0.7383654446454992, -0.5854715899461786, 0.5533079436832119, 1.8356585359936717, 0.5444512874658731, -0.15487494885319894, 1.4841891261055995, -0.8959206973539454, -0.28970588626715765, -0.48478539294906514, 0.9406701182415514, 1.063731025682468, -0.25497847109917177, 0.5178813188138571, 0.323967161634231, -0.128421515151411, -1.726581822580132, 0.4502910476815355, 0.5649614387060259, 1.0152524863875614, 0.370348071825031, 2.774464095031573, 0.1407742198755939, 0.6894207655496801, -0.36125834570723603, 0.33608679645795764, 0.13960887037331252, -0.7807841665285424, 1.1961147291416356, 0.4656736611116501, -1.2408641500292417, -0.23400218005810644, 0.8222706088097604, 0.7020065401743193, -1.9708390782583147, 0.4104360947035114, 1.4329137480052174, -0.4726657581253385, -0.31114831710913554, -0.7849794247367555, -0.8646893306928037, -0.546781986470436, -0.6894207655496801, -0.6572571192867133, -0.7434929824555374, 2.2934078204898083, -0.5094908023974309, -0.6358146884447354, 1.8701528812612014, 0.5421205884613104, 0.6250934730237465, -1.2772230545004215, -0.9565188714725785, -2.295272379693458, -1.2818844525095472, -1.333159830609929, 1.1028867689591233, 1.681832401692526, 0.2034700230983336, 0.546781986470436, -0.6236950536210089, -0.16151744101620294, 0.6376792476483857, -0.2287581072978401, -0.45728314469522396, -0.598989644172643, 0.3507702001867034, 0.6353485486438228, -0.37011500192457475, 1.4142681559687151, -0.721584411812647, 2.164753235437941, 0.4342092245500521, -0.09911297516903363, -0.42395414892997574, 0.49550660837005406, -0.8670200296973665, 1.348076304239131, -1.6864937997016516, -2.1610241170306406, 0.16524655942350344, 1.6575931320450727, -0.6199659352137084, -0.8968529769557705, 0.8656216102946288, 0.681030249133254, -0.5020325655828299, -1.0609341868769926, -0.0811083253587859, -0.6982774217670188, 0.1215459530879507, 2.932951627341844, -0.3426127536707335, -0.015557415855456778, -1.6314893031939692, -1.7396337370056838, -0.07510677542203666, -0.4936420491664038, 0.6106431391954571, -1.7275141021819571, 0.8031588769723454, -0.4181274014185687, 0.7775211879221545, 0.7523496386728761, -0.43490843425142095, 0.6470020436666369, 0.7159907342016962, -0.8264658670179735, 2.90311868008344, 0.8712152879055796, -0.9732999043054308, 0.5160167596102069, 1.4245232315887915, -1.0627987460806427, -0.6484004630693746, 0.7080663575861826, -0.7621385744920399, 0.4148644228121807, 0.8353225232353122, -0.37314491063050637, -1.2977332057405744, -0.47383110762761993, 0.714126174998046, 0.05308166982891807, -0.24658795468274564, -0.0657839794037854, -1.5065638365494025, 2.4201978463380254, -1.0544082296642168, 0.6866239267442048, 0.8712152879055796, 0.2264274082932773, -0.21454084337000695, 0.4155636325135496, -0.8572310938782027, -0.6796318297305163, 0.44865955837834154, 1.9988074663130686, 0.7831148655331053, 1.1112772853755493, -0.6311532904356099, 0.7420945630527997, 1.2613743012693945, 0.7085324973870952, -1.696748875321728, 1.2856135709168477, 0.773792069514854, -0.6600539580921887, -0.2456556750809205, -0.8754105461137927, -1.5802139250935874, -0.8549003948736399, 0.33328995765248226, -2.2971369388971086, -1.838455374799147, 0.6572571192867133, 0.09048938885215121, 0.17992996315224918, -0.7197198526089967, 0.5710212561178892, 0.763070854093865, -0.6330178496392601, 1.0152524863875614, 2.3549382742102662, 0.40088022878480384, 0.19822595033806725, 0.543519007864048, -1.4925796425220255, 0.74395912225645, -1.2557806236584437, -0.3468080118789466, 0.0396801505526819, -0.19193306302574767, -0.27548862233932453, 0.6670460551058771, -1.7536179310330606, -0.7877762635422308, 0.3423796837702773, 0.8847333421320439, 0.8903270197429947, -0.5327977924430591, -1.1485684694485543, 0.7369670252427615, 0.1547584139029708, -0.4691697096184943, -1.608182313148341, 1.5121575141603532, -0.0355431598195829, 0.8786735247201806, 0.9770290227127313, 0.44213360116556566, 0.8735459869101424, -0.5696228367151516, 0.15009701589384516, 0.20987944536088132, 1.6249633459811934, 0.8474421580590389, 0.2393627877686009, -1.004997410767485, -1.2259476764000397, -1.3816383699048356, -0.11024206291582106, 0.18587324561388435, 0.3605591360058672, 0.5509772446786491, 0.08827522479781655, -1.0245752824058127, 0.9383394192369886, -0.9919454963419333, 1.1737400186978326, 0.781250306329455, -0.4356076439527898, -0.7453575416591877, 0.860027932683678, -0.7616724346911273, -0.17818193889882708, -0.7057356585816198, -0.7201859924099092, -1.125261479402926, 0.07260127399213163, 2.144243084197788, 0.37734016883871946, -0.7807841665285424, -2.216960893140148, 2.770734976624272, -0.5812763317379656, -0.04699271867949772, -1.0012682923601846, 0.6982774217670188, -1.6352184216012697, -0.562630739701463, 0.39505348127339684, 0.5458497068686109, 0.3931889220697466, 0.5379253302530973, -0.8199399098051977, 0.09987045234551654, -1.5447873002242325, 0.8204060496061102, -0.5258056954293706, 0.74395912225645, 1.1038190485609483, -0.6167029566073203, -0.12131288318749442, -0.4964388879718792, 0.3861968250560581, 0.24122734697225115, -0.1530103896495487, 0.8320595446289243, -0.5043632645873928, 1.4552884584490204, -1.4329137480052174, 0.09101379612817785, -0.7700629511075535, 0.9574511510744036, 1.0777152197098447, 0.7980313391623072, 0.5575032018914249, -0.3668520233181868, -0.2927357949730893, -0.4645083116093687, 0.48385311334724, -0.40088022878480384, -0.43444229445050836, -1.4161327151723653, 0.5085585227956059, 1.4049453599504638, 0.6600539580921887, -2.164753235437941, -1.8729497200666767, -0.40204557828708526, 1.3601959390628577, -0.010750349158545976, 1.6100468723519914, 0.3022916608917969, 0.4328108051473144, 1.1662817818832316, 0.19076771352346625, -1.9689745190546646, -0.2622036380133165, 0.8012943177686952, -0.9416023978433765, 1.733107779792908, -4.426463549465695, -0.8660877500955414, -0.9891486575364579, 1.1317874366157021, -1.7508210922275853, 0.9425346774452017, 0.10429878045418589, 0.591531407358042, -0.17445282049152658, -0.885665621733869, -0.30252473079225317, -2.23187736676935, -0.4081053956989486, 1.6874260793034768, 0.8698168685028419, 0.4500579777810792, -1.7610761678476616, 0.7295087884281605, 0.8185414904024599, -0.975164463509081, -0.7444252620573625, -0.11682628760371101, -0.4363068536541586, 0.13646242671715272, -1.355534541053732, 0.0652013046526447, -1.4403719848198184, 1.3601959390628577, -0.16699458367692557, 0.08606106074348188, -2.0193176175532215, -0.32746321014107527, -0.6153045372045827, -0.0838468966891472, -0.7924376615513565, 1.012455647582086, 0.5999219237744681, 0.4363068536541586, -1.5895367211118385, 0.19135038827460696, -0.3279293499419878, -0.7122616157943957, -1.1522975878558548, -1.0506791112569163, 1.6277601847866687, 1.9316833349816596, 0.7127277555953083, -0.14403719848198185, -0.8469760182581263, 0.6167029566073203, -0.34494345267529636, -0.1926322727271165, 0.28714211736213857, -0.9611802694817041, -0.6181013760100581, -1.3490085838409562, 0.9854195391291574, -1.511225234558528, 0.5794117725343153, 0.6167029566073203, -1.6147082703611169, -0.09206261068023112, 0.7835810053340178, -1.033898078424064, -1.7992996315224918, 0.9523236132643654, -0.9052434933721967, -0.9658416674908298, -0.392722782268834, -0.06077297654397535, 1.1644172226795815, 0.5225427168229827, -1.9447352494072112, -0.524407276026633, 0.265932756420617, -2.0640670384408275, -0.7602740152883897, 0.72577967002086, 1.0115233679802609, 1.3368889490172295, 0.5332639322439716, 0.4281494071381888, -2.2150963339364975, -0.08646893306928037, 0.06298714059831002, 0.09788935819163816, 0.7337040466363736, -0.2990286822854089, 2.366125629432168, 0.02169006761121268, 0.42022503052267524, -2.9515972193783466, -1.2389995908255915, 0.9043112137703715, -0.44889262827879783, -0.9052434933721967, -0.18727166501662204, 0.24961786338867728, -1.4403719848198184, 0.11233969201992759, 0.7430268426546248, -0.364521324313624, 0.9555865918707533, -0.670309033712265, 0.606447880987244, -0.5174151790129445, -0.2885405367648763, -0.5780133531315776, 0.08343902436334871, 0.16140090606597482, -0.006048892260279426, -0.6516634416757625, 1.8580332464374747, -0.22631087334304917, 1.0394917560350148, -0.23575020431152854, -1.5569069350479592, -0.9019805147658086, 0.1565064381563929, 2.1386494065868376, 1.2567129032602689, 0.24425725567818282, -0.591531407358042, -0.14333798878061302, 1.2585774624639192, 0.47825943573628926, 0.5001680063791797, 0.5337300720448842, -1.1429747918376036, -1.801164190726142, 0.12026406863544116, 2.129326610568586, -1.5242771489840798, 1.0833088973207956, 0.36498746411453653, -2.1535658802160396, 0.72577967002086]
    image_embedding_tensor = torch.tensor(image_embedding_list)
    normalized_tensor = torch.nn.functional.normalize(image_embedding_tensor, p=2, dim=0)
    image_embedding_tensor = torch.unsqueeze(image_embedding_tensor, 0)
    negative_image_embedding = None
    prompt_generation_policy = "top-k"

    # Generate img2img generation jobs with Kandinsky using the embeddings
    response = generate_img2img_generation_jobs_with_kandinsky(
        image_embedding=image_embedding_tensor,
        negative_image_embedding = None,  
        dataset_name="test-generations",
        prompt_generation_policy=prompt_generation_policy
    )

    print(response)