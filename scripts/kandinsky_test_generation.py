import io
import sys
import os
import uuid
import torch


base_directory = os.getcwd()
sys.path.insert(0, base_directory)

from utility.http import generation_request
from utility.http import request
from utility.minio.cmd import connect_to_minio_client, upload_data
from worker.generation_task.generation_task import GenerationTask
from kandinsky_worker.dataloaders.image_embedding import ImageEmbedding

def read_msgpack_file(file_path):
    """Reads a msgpack file and returns its bytes."""
    with open(file_path, "rb") as f:
        return f.read()

def generate_img2img_generation_jobs_with_kandinsky(image_embedding,
                                                    negative_image_embedding,
                                                    dataset_name,
                                                    prompt_generation_policy,
                                                    self_training= False,
                                                    init_img_path="./test/test_inpainting/white_512x512.jpg"):

    # get sequential ids
    sequential_ids = request.http_get_sequential_id(dataset_name, 1)

    count = 0
    # generate UUID
    task_uuid = str(uuid.uuid4())
    task_type = "img2img_generation_kandinsky"
    model_name = "kandinsky_2_2"
    model_file_name = "kandinsky-2-2-decoder"
    model_file_path = "input/model/kandinsky/kandinsky-2-2-decoder"
    task_input_dict = {
        "strength": 0.75,
        "seed": "",
        "dataset": dataset_name,
        "file_path": sequential_ids[count]+".jpg",
        "init_img": init_img_path,
        "num_images": 1,
        "image_width": 512,
        "image_height": 512,
        "decoder_steps": 100,
        "decoder_guidance_scale": 12,
        "self_training": self_training
    }

    prompt_generation_data={
        "prompt_generation_policy": prompt_generation_policy
    }

    image_embedding= image_embedding.detach().cpu().numpy().tolist()[0]
    negative_image_embedding= image_embedding.detach().cpu().numpy().tolist()[0] if negative_image_embedding is not None else None

    # create the job
    generation_task = GenerationTask(uuid=task_uuid,
                                     task_type=task_type,
                                     model_name=model_name,
                                     model_file_name=model_file_name,
                                     model_file_path=model_file_path,
                                     task_input_dict=task_input_dict,
                                     prompt_generation_data=prompt_generation_data)
    generation_task_json = generation_task.to_dict()

    # add job
    response = generation_request.http_add_kandinsky_job(job=generation_task_json,
                                                         positive_embedding=image_embedding,
                                                         negative_embedding=negative_image_embedding)

    return response


if __name__ == "__main__":
    image_embedding_list = [-0.9050280551863487, 0.27062368527711406, -1.0616775345486782, -0.47723446038291073, 0.32683014298851465, 0.47801510562890237, -0.24967637117633742, 0.2522785219963097, -1.157436684723657, -0.43507961709936027, -0.45225381251117713, -1.043982908972867, 0.2464236826513721, 0.20478926953181611, 0.5641462977699839, 0.5516559738341171, -0.2607355121612195, 0.16029249051029063, 0.4436667148052687, 0.01803615787093266, -0.4100989692276267, 0.1401258216555057, -0.6031785600695676, -0.3689849862720651, 0.33723874626840367, -0.04075618721781537, 0.5474925325221615, -0.6005764092495954, -0.8035441732074309, 0.12145538952220479, -0.3112172380686811, -1.2396646506347802, -0.4592796197251022, -0.6484559843370848, 0.5183484433384723, 0.04104892918506225, 0.3190236905285979, -0.05984946885936176, 0.16822905051120599, 0.8774452564946428, 0.5350022085862947, 0.1619838885432726, -0.2442118544543957, -0.12529356198166386, 0.4124409049656017, 0.20114625838385494, -1.4530410178725046, -0.6791613640127574, -0.06105296361359892, -0.5755957613778618, 0.24043873576543592, -0.8639140722307871, -0.5964129679376398, -0.35597423217220386, 0.08600108460008288, 0.41166025971961, -0.8436172958350036, -0.18865593444798814, 0.1194387226367263, 0.29300218232887537, -0.16289464133026288, -0.021955647543515863, 2.192051850744624, -0.28857852593492256, 0.16549679215023513, 0.05165269377644917, 0.21675916330368847, -0.24147959609342484, -0.5092409154685694, 0.20114625838385494, 0.5121032813705388, 0.3973484302097626, 0.7556645981199415, 0.013726345575353622, -0.5061183344846027, 0.1808494819880714, 0.7926151397635475, 0.14598066100044324, 0.5402065102262392, -1.13557861783589, -0.8248818099312034, -0.16029249051029063, -0.5055979043206082, -0.050579306563210615, -0.22716776658357746, 0.5438495213742003, 1.376017353601326, 0.8295656814071534, 0.30080863478879216, 0.5906882361337008, -0.06798119017177504, 0.11098173247181647, -0.8430968656710092, 0.3281312183985008, -0.5196495187484584, 0.021142475412274535, -0.2979462688868227, 0.4530344577571688, -0.8207183686192477, -0.7280817994282357, -0.5412473705542281, -0.4840000525148386, -0.19854410756388272, -0.7488990059880136, 1.1116388302921454, -0.035584412463120524, -0.4501720918551993, 0.1444193705084599, -0.9872560210974718, 0.3814753102079319, -0.5240731751424113, -0.6229549063013567, 0.3968280000457682, -0.6302409285972791, -0.13251453050708686, -0.27504734167106687, 0.9393764460099824, 0.16601722231422958, 0.14884302690241272, -0.15638926428033226, 0.2776494924910391, -0.5396860800622447, -0.2742666964250752, 0.48269897710485243, -0.4840000525148386, -0.03623495016811359, -0.05204301639944501, 0.6416903922051569, 0.661466738436946, 0.1381742085405265, 0.0389997354143341, -0.6042194203975565, 0.1891763646119826, -0.1383043160815251, -0.6515785653210515, -0.845178586326987, 0.010636291476636573, 0.11878818493173322, -0.33723874626840367, -0.7218366374603022, 1.6112517877268175, 1.2750539017864027, -0.1891763646119826, -0.16966023346219072, -0.459019404643105, -0.8285248210791645, 1.046585059792839, 0.6364860905652124, -0.19229894559594932, 0.39526670955378485, -0.36534197512410393, -0.33723874626840367, -0.11202259279980538, 1.4176517667208821, -0.5344817784223003, 0.3026301403627727, -0.19412045116992988, -0.4280538098854352, 0.7603484695958915, -0.23861723019145537, -0.013457998772043983, -0.04667608033325224, 0.4280538098854352, -0.5667484485899561, 0.4894645692367803, -0.5589419961300394, 0.2233946478946177, -0.5016946780906498, -0.5251140354704001, 0.01545840221489765, -0.22690755150158023, -0.023516938035499212, -0.025501078035728052, 0.20648066756479808, -0.6005764092495954, -0.2495462636353388, 0.6094237220375011, -0.42909467021342407, 0.3669032656160873, -0.1392150688685154, -0.5284968315363641, 0.7811656761556696, 0.011929235165310286, -0.8217592289472366, -0.1774666859221075, 0.05939409246586661, 0.45693768398712714, -0.19503120395692017, -0.1360924878845487, 0.43533983218135747, -0.5042968289106221, 0.22872905707556082, 0.6916516879486242, 0.8935785915784707, -0.1080543127993477, -0.15027420985339746, -0.6432516826971403, -0.30210971019877825, -0.6052602807255454, 1.5696173746072615, -0.14207743477048487, 0.0747467823037029, -2.0484131254821554, -0.2505871239633277, -0.16341507149425732, 0.3869398269298736, -0.10083334427392471, -0.5277161862903724, 3.041393878383566, -0.21545808789370233, -0.5490538230141448, 0.4873828485808025, 0.017271776067565813, -0.484520482678833, 0.47723446038291073, -0.10740377509435463, -0.45251402759317433, -0.6307613587612735, -0.16966023346219072, 0.03233172393815521, 0.5792387725258229, -0.23549464920748867, -1.2729721811304249, 0.380434449879943, 0.4595398348070994, -0.3200645508565868, -0.1591215226413031, 0.09088011738753085, 1.33438294048177, -0.6630280289289294, 1.4238969286888155, 0.07338065312321745, -0.08034140656664324, 0.185012923300027, -0.0659319964010469, 0.5355226387502892, -0.2534494898652972, 0.9008646138743931, 0.24577314494637906, -0.3937054190618015, -0.122561303620693, -0.6021376997415787, -0.8144732066513144, 0.35727530758218995, 0.6016172695775843, -0.26164626494820975, -0.44444736005126034, 0.11299839935729497, 0.6520989954850459, 0.8540258991148926, 0.07006291082775284, 1.584189419199106, -1.2073979804671242, 0.7036215817204965, -0.5464516721941726, -0.8836904184625762, -0.7286022295922301, 0.19203873051395207, -0.9128345076462654, 0.0862612996820801, 0.04979866131721894, -0.9045076250223543, -0.7228774977882911, -0.07949570755015226, -1.1501506624277347, -0.9029463345303709, -1.0595958138927004, 0.17707636329911164, 0.6453334033531181, -0.46084091021708556, -1.3499958454016034, 0.11761721706274572, -0.19008711739897288, 0.37054627676404844, -0.49206672005675256, -0.3166817547906229, -0.8420560053430203, 0.9825721496215217, 0.5490538230141448, 0.7332861010681802, -0.901905474202382, 0.5745549010498728, -0.2629473403581959, 0.42441079873747406, 0.8633936420667927, -0.21285593707373007, 0.6869678164726741, 0.15196560788637942, 0.7145506151643799, 0.9726839765056272, 0.21064410887675367, -2.2066238953364685, -0.7176731961483467, -0.6292000682692901, -0.12178065837470131, -0.5102817757965583, 0.25722260855425694, 0.029664519347683653, -0.5506151135061281, 0.2522785219963097, 0.3973484302097626, 0.01675134590357136, 0.16250431870726703, 0.5776774820338396, 0.6906108276206353, -0.3734086426660179, -0.3169419698726201, 0.1934699134649368, -0.5750753312138673, 0.2045290544498189, -1.4020388618010484, -0.014759074182030107, 0.833729122719109, -0.3973484302097626, 1.1085162493081786, -0.5979742584296232, -0.4944086557947276, 0.640649531877168, -0.3450451987283204, 0.5605032866220228, 0.12731022886714236, -0.9737248368336161, 0.03782876754534659, 0.03782876754534659, -1.7236647031496186, 0.13752367083553343, 0.9154366584662377, 0.06967258820475701, 0.3244882072505396, 0.08535054689508981, 0.03467365967613024, 0.33723874626840367, 0.29664519347683654, -0.16822905051120599, -0.833729122719109, 0.04755430623499288, 1.7163786808536963, 0.18228066493905615, -1.3947528395051263, -0.14585055345944464, 2.4876561838934714, 0.03669032656160873, -1.1553549640676792, 1.3801807949132816, 0.03477124033187919, -0.37054627676404844, -0.6432516826971403, 0.6250366269573345, 0.6541807161410238, -0.15183550034538082, 0.7093463135244354, -0.16081292067428507, -0.9971441942133663, -0.14116668198349458, -0.4564172538231327, -0.4108796144736183, -0.4707290833329801, 0.3731484275840207, 0.06687527607328683, 0.07598280394318971, -0.5264151108803863, -0.19854410756388272, 1.6237421116626842, 0.45745811415112164, -0.7004990007365298, 0.3796538046339513, -0.5485333928501503, 0.5641462977699839, -0.7723183633677639, 0.8004215922234642, -0.14533012329545017, -0.31980433577458955, -0.5636258676059894, 0.5217312394044362, 0.3034107856087644, -1.0091140879852387, -1.0304517247090113, -0.11969893771872352, -0.7197549168043245, 1.1220474335720343, 0.9492646191258769, 0.16601722231422958, -0.7015398610645187, -0.2862365901969475, 0.24460217707739154, 0.4270129495574463, 1.0216044119211054, -0.05610887705565165, 1.2833807844103138, -0.07299033050022162, -0.9919398925734219, 0.9185592394502043, -0.6063011410535344, 0.08535054689508981, 0.15586883411633778, 0.30289035544476994, -1.3364646611377478, 0.4488710164452132, 0.3231871318405535, -0.24967637117633742, -0.1517053928043822, -1.625823832318662, -0.6911312577846297, -0.5433290912102059, -0.37132692201004014, -0.5113226361245472, 0.5802796328538118, 0.6416903922051569, 0.5284968315363641, 0.017857260002059568, -0.41296133512959615, 0.22833873445256497, 0.5969333981016343, 0.3034107856087644, -0.41816563676954066, -1.145987221115779, 1.1626409863636014, -1.0569936630727281, -0.5901678059697064, 0.26281723281719727, 1.2875442257222696, 0.03620242328286393, 0.2328924983875164, -0.07546237377919526, -1.3198108958899253, -0.24928604855334158, -0.10174409706091499, 0.25800325380024863, -0.3895419777498459, 0.5755957613778618, 0.43377854168937413, -0.48269897710485243, -0.11612098034126167, 0.22781830428857053, 0.39630756988177374, -0.6000559790856009, 0.11397420591478456, 0.0675258137782799, -0.8862925692825485, -0.234714003961497, 0.6385678112211902, 0.2794709980650197, -0.6703140512248517, 0.21337636723772452, 0.1796785141190839, -0.3905828380778348, 0.5428086610462114, 0.28155271872099746, -0.17512475018413245, -0.25331938232429857, -0.21897099150066487, -0.10050807542142817, -0.6354452302372235, -0.2608656197022181, -0.8623527817388038, 0.004183770615236634, -0.46916779284099674, 0.17941829903708667, -0.4644839213650467, -0.21363658231972177, 0.37861294430596243, -0.17538496526612968, -0.08157742820613005, -0.29118067675489484, -0.4715097285789718, 0.11495001247227415, -0.26984304003112236, 0.8769248263306484, -1.1553549640676792, 0.5128839266165306, 0.33749896135040086, 0.1184629160792367, -0.4402839187393048, 0.6109850125294843, 0.8909764407584986, -0.7270409391002468, 0.33827960659639256, 0.27712906232704465, 0.34114197249836203, -1.052309791596778, -0.32058498102058125, -0.4145226256215795, 0.2732258360970863, -0.18748496657900063, -0.2204021744516496, -0.9732044066696216, 0.4439269298872659, 0.09166076263352252, 0.48712263349880525, 0.9612345128977493, 0.5938108171176676, 0.3648215449601095, 0.01902822787104708, -0.24082905838843177, -0.41035918430962387, -0.054222317711171766, 0.2701032551131196, 0.634924800073229, 0.7249592184442689, 0.1588613075593059, -0.4892043541547831, -0.6744774925368073, 0.27088390035911125, 0.5641462977699839, -0.017434410493814077, -0.61514845384144, -0.048855381644979004, 0.6109850125294843, 0.3299527239724813, 0.25410002757029027, -0.04160188623430635, -0.14598066100044324, 0.7452559948400526, -0.43507961709936027, -0.4704688682509829, -0.12145538952220479, 0.25436024265228746, -1.3645678899934481, 0.4100989692276267, 0.11781237837424363, 0.22625701379658716, 0.015360821559148691, 0.4517333823471827, -0.7286022295922301, -0.8956603122344485, 0.3169419698726201, -0.029127825741064376, -0.8727613850186928, -0.34634627413830654, -0.01223824057518199, -0.875363535838665, 0.4634430610370578, -1.1470280814437679, 0.9622753732257382, -0.06167097443334233, 0.008953025164967024, 0.0029111562298439553, 0.47983661120288296, 0.46734628726701616, 0.7801248158276807, 0.9242839712541433, 0.6193118951533956, 1.229256047354891, -0.8108301955033532, -0.2721849757690974, 0.5672688787539506, -0.060337372138106554, -0.1831914177260464, 0.268281749539139, 0.8384129941950591, 0.2862365901969475, -0.09263656919101211, -0.2963849783948393, 0.06040242590860586, -0.09035968722353639, -0.024281319838866063, -0.48868392399078864, -0.23185163805952752, 0.8123914859953366, -0.7088258833604411, 0.30627315151073387, 0.13570216526155285, -0.81863664796327, -0.5438495213742003, -0.1778570085451033, 0.38928176266784864, 1.027849573889039, -0.5719527502299007, -0.7619097600878749, -0.08782259017406345, -0.631281788925268, -0.17070109379017961, -0.38381724594590694, 0.15053442493539468, -0.5834022138377786, -0.9966237640493719, 0.5264151108803863, -0.5170473679284862, 0.6245161967933401, -0.23757636986346645, -0.47853553579289687, 0.6640688892569183, 0.3234473469225507, 0.4449677902152548, 0.14923334952540857, -0.07838979345166404, 0.25631185576726667, -0.5880860853137286, 0.4199871423435212, -0.4954495161227165, -0.786369977795614, -0.23016024002654556, 0.10551721574987476, 1.0507485011047948, 0.3343763803664342, 0.0550354898424131, 0.2338032511745067, 0.7436947043480692, 0.9711226860136438, 0.2630774478991945, 0.20166668854784942, 0.11800753968574156, -0.026102825412846635, 0.9877764512614663, 0.6057807108895399, 1.2521549745706468, 0.7421334138560858, -1.1314151765239344, -0.09465323607649061, -0.4853011279248247, -0.011132326476693783, -0.2308107777315386, -0.20205701117084524, 0.21194518428673978, 0.3460860590563093, 0.48426026759683577, -0.3119978833146728, 0.6859269561446852, -0.5735140407218839, -0.05314893049793321, 0.5178280131744778, 0.3013290649527866, 0.7717979332037694, 0.43820219808332694, -0.6042194203975565, -0.31980433577458955, -0.1817602347750617, 0.05724731803938951, 0.06124812492509684, 0.46110112529908276, 0.631281788925268, 0.0322016163971566, -0.08430968656710092, 1.1543141037396902, 0.02694852442933762, -0.23120110035453445, 0.17018066362618517, -0.20114625838385494, 0.9143957981382488, 0.7010194309005242, -0.17226238428216298, 1.2667270191624915, 0.6666710400768906, -0.7999011620594698, -0.47255058890696067, 0.6250366269573345, -0.6973764197525631, -0.24889572593034576, 0.9128345076462654, 0.21584841051669817, 0.3895419777498459, -0.5048172590746166, 0.06394785640081806, 0.20856238822077586, 0.16172367346127536, 0.2703634701951168, -0.07565753509069317, -0.0956290426339802, -1.3479141247456257, -0.032185352954531773, -0.4977914518606915, -0.15274625313237108, -0.1401258216555057, -0.16874948067520043, 0.07084355607374451, 0.07624301902518693, 0.2120752918277384, -0.7213162072963079, -0.061996243285838866, 0.014311829509847378, 0.3575355226641872, 0.1331650682120799, 1.168886148331535, -0.38798068725786256, 0.9882968814254607, -0.2927419672468782, 0.3221462715125646, -0.1881355042839937, -0.2204021744516496, 0.469428007922994, 0.6968559895885686, -0.1548279737883489, -0.05435242525217038, -0.37028606168205125, -0.625557057121329, 0.9768474178175828, -0.2854559449509559, 0.04638333836600536, 1.2656861588345025, 0.45771832923311884, -0.47359144923494956, -1.0559528027447391, 0.11794248591524224, 0.1102661409963241, 0.02898145475744094, 0.19932475280987438, -0.38902154758585145, 0.028900137544316806, 0.3744495029940068, -0.7655527712358361, 0.22794841182956913, 0.6547011463050182, 0.00953850909946078, 0.09836130099495106, 0.045342478038016464, 0.14376883280346683, 0.5984946885936175, -0.24369142429040125, -1.1470280814437679, 0.052108070169944315, -0.8051054636994143, 0.4728108039889579, 0.3296925088904841, 0.2862365901969475, -0.6094237220375011, 0.1725225993641602, -0.2587838990462403, 0.23536454166649004, 0.990899032245433, 0.4499118767732021, 0.13960539149151124, -1.1220474335720343, 0.174604320020138, -0.3520710059422455, -0.37392907283001237, -0.8358108433750868, 0.3630000393861289, -0.3335957351204425, 0.299507559378806, 0.0369180147583563, -0.7603484695958915, 0.027826750331078252, -0.8306065417351424, -0.7010194309005242, 0.23757636986346645, 0.6734366322088184, -0.2776494924910391, 1.0502280709408003, -0.1278306590311368, 0.24772475806135824, 0.10955054952083174, -0.005562097377690685, -0.1828010951030506, 0.12600915345715621, -1.1293334558679566, 0.3575355226641872, -0.4652645666110384, 0.20543980723680916, -0.018101211641431966, 0.3273505731525091, 0.8280043909151701, -0.4829591921868497, 0.15027420985339746, -0.6864473863086796, 0.27270540593309184, 0.2534494898652972, 0.47359144923494956, 0.0551005436129124, 0.7338065312321747, 0.17863765379109497, 1.293789387690203, 0.3671634806980845, 0.18579356854601867, -0.5290172617003585, 0.17291292198715605, 0.08430968656710092, -0.7223570676242967, 0.7103871738524243, -0.5212108092404417, -0.8217592289472366, -0.07728387935317584, 0.42753337972144073, 0.7057033023764743, 0.09387259083049894, -0.07624301902518693, 0.5256344656343945, -0.6906108276206353, -0.7114280341804132, -0.26138604986621256, 0.4311763908694019, 1.3822625155692594, 0.2574828236362542, -0.3104365928226895, -0.0820328045996252, 0.05923145803961835, -0.8529850387869037, -0.09133549378102598, 0.6713549115528405, 1.11684313193209, -0.04254516590654629, 0.4501720918551993, 0.8623527817388038, 0.0831387186981134, 0.6276387777773068, 0.40047101119372935, -0.21454733510671203, -0.13264463804808546, 0.5066387646485971, 0.15235593050937526, -0.10122366689692054, -0.7462968551680415, 0.28519572986895864, 0.0628744691875795, 0.13882474624551955, -0.5641462977699839, 0.25188819937331386, 0.05448253279316899, 0.15001399477140023, 0.13856453116352233, -1.3708130519613815, -0.1485828118204155, 0.17928819149608805, 0.041959681972052534, 0.24772475806135824, -1.0304517247090113, 0.031453498036414576, -0.48764306366279975, -0.2546204577342847, -0.4134817652935906, 0.6854065259806907, 0.47983661120288296, -0.5266753259623834, -0.6630280289289294, 0.1463709836234391, 1.4832259673841828, 0.1122828078818026, 0.8139527764873199, -0.5454108118661837, -0.2953441180668504, 0.7114280341804132, -0.02561492213410184, -0.6812430846687352, 1.3218926165459033, 0.02494812098648395, -0.5880860853137286, 0.440544133821302, -0.5282366164543668, -0.6900903974566408, 0.47619360005492184, 0.46838714759500505, -0.16653765247822402, -0.03750349869285006, 0.49961295743467204, 0.3200645508565868, 0.1984140000228841, 0.7619097600878749, -0.38303660069991524, -0.15925163018230173, -0.3583161679101789, 0.5521764039981115, 0.990899032245433, 0.1412967895244932, 0.32162584134857014, -0.3317742295464619, -0.4056753128336738, -1.3520775660575812, 0.19880432264587994, -0.3916236984058237, 0.7946968604195253, -0.08118710558313422, 0.41218068988360446, -0.32683014298851465, 0.30887530233070615, 1.0247269929050722, 0.30393121577275883, -0.08645646099357802, 0.8285248210791645, -0.5001333875986665, -0.16172367346127536, -0.27062368527711406, 0.5251140354704001, 0.5938108171176676, -0.1423376498524821, 0.289098956098917, 0.1808494819880714, -0.07168925509023549, -0.9638366637177216, 0.2513677692093194, 0.31538067938063674, 0.5667484485899561, 0.2067408826467953, 1.5488001680474834, 0.07858495476316196, 0.38485810627389583, -0.20166668854784942, 0.18761507411999925, 0.07793441705816889, -0.4358602623453519, 0.6677119004048795, 0.2599548669152278, -0.6926925482766131, -0.13062797116260697, 0.459019404643105, 0.3918839134878209, -1.1001893666842675, 0.22911937969855664, 0.7999011620594698, -0.2638580931451862, -0.17369356723314772, -0.43820219808332694, -0.48269897710485243, -0.305232291182745, -0.38485810627389583, -0.3669032656160873, -0.41504305578557393, 1.2802582034263472, -0.28441508462296694, -0.354933371844215, 1.043982908972867, 0.3026301403627727, 0.34894842495827877, -0.7129893246723966, -0.5339613482583058, -1.281299063754336, -0.7155914754923689, -0.7442151345120636, 0.6156688840054344, 0.938856015845988, 0.11358388329178873, 0.305232291182745, -0.3481677797122871, -0.09016452591203848, 0.35597423217220386, -0.12770055149013818, -0.2552709954392778, -0.3343763803664342, 0.19581184920291184, 0.3546731567622177, -0.20661077510579667, 0.7894925587795808, -0.4028129469317044, 1.208438840795113, 0.24239034888041514, -0.055328231809659977, -0.23666561707647618, 0.2766086321630502, -0.4840000525148386, 0.7525420171359748, -0.9414581666659602, -1.2063571201391352, 0.09224624656801628, 0.9253248315821322, -0.3460860590563093, -0.5006538177626609, 0.4832194072688469, 0.38017423479794576, -0.2802516433110114, -0.5922495266256842, -0.04527742426751716, -0.3898021928318431, 0.06785108263077642, 1.63727329592654, -0.1912580852679604, -0.008684678361657386, -0.9107527869902876, -0.9711226860136438, -0.041927155086802885, -0.2755677718350613, 0.3408817574163648, -0.964357093881716, 0.44835058628121877, -0.23341292855151086, 0.4340387567713714, 0.4199871423435212, -0.24278067150341096, 0.3611785338121484, 0.39969036594773766, -0.46136134038108, 1.6206195306787174, 0.4863419882528136, -0.5433290912102059, 0.2880580957709281, 0.7952172905835198, -0.5932903869536731, -0.36195917905814, 0.39526670955378485, -0.42545165906546295, 0.23159142297753027, 0.46630542693902727, -0.20830217313877863, -0.7244387882802745, -0.2645086308501792, 0.39864950561974877, 0.029631992462434, -0.13765377837653203, -0.03672285344685838, -0.8410151450150313, 1.3510367057295924, -0.588606515477723, 0.3832968157819125, 0.4863419882528136, 0.12639947608015206, -0.11976399148922283, 0.23198174560052612, -0.47853553579289687, -0.3793935895519541, 0.2504570164223291, 1.115802271604101, 0.43716133775533805, 0.6203527554813845, -0.3523312210242427, 0.41426241053958224, 0.704142011884491, 0.39552692463578204, -0.9471828984698991, 0.7176731961483467, 0.43195703611539354, -0.36846455610807066, -0.1371333482125376, -0.48868392399078864, -0.8821291279705928, -0.47723446038291073, 0.1860537836280159, -1.282339924082325, -1.0262882833970555, 0.3669032656160873, 0.05051425279271131, 0.10044302165092886, -0.40177208660371544, 0.31876347544660066, 0.4259720892294574, -0.3533720813522316, 0.5667484485899561, 1.314606594249981, 0.22378497051761354, 0.11065646361931995, 0.3034107856087644, -0.8332086925551145, 0.4153032708675712, -0.7010194309005242, -0.19360002100593543, 0.022150808855013783, -0.1071435600123574, -0.15378711346036, 0.37236778233802903, -0.9789291384735606, -0.43976348857531034, 0.1911279777269618, 0.49388822563073315, 0.4970108066146998, -0.29742583872282824, -0.6411699620411625, 0.41140004463761276, 0.08639140722307871, -0.261906480030207, -0.8977420328904264, 0.8441377259989981, -0.019841400002288408, 0.49050542956476917, 0.5454108118661837, 0.24681400527436795, 0.48764306366279975, -0.317982830200609, 0.08378925640310646, 0.11716184066925057, 0.9071097758423264, 0.4730710190709551, 0.13362044460557507, -0.5610237167860171, -0.6843656656527018, -0.771277503039775, -0.06154086689234372, 0.10376076394639348, 0.20127636592485357, 0.30757422692072, 0.049278231153224494, -0.5719527502299007, 0.523812960060414, -0.5537376944900949, 0.6552215764690127, 0.43612047742734916, -0.2431709941264068, -0.4160839161135628, 0.4800968262848802, -0.4251914439834657, -0.09946721509343927, -0.3939656341437987, -0.4020323016857127, -0.6281592079413012, 0.0405284990210678, 1.196989377187235, 0.21064410887675367, -0.4358602623453519, -1.2375829299788024, 1.5467184473915057, -0.3244882072505396, -0.02623293295384525, -0.5589419961300394, 0.3898021928318431, -0.9128345076462654, -0.3140796039706506, 0.2205322819926482, 0.30471186101875053, 0.21949142166465932, 0.3002882046247977, -0.45771832923311884, 0.05575108131790547, -0.8623527817388038, 0.4579785443151161, -0.2935226124928698, 0.4153032708675712, 0.6161893141694289, -0.3442645534823287, -0.06772097508977781, -0.27712906232704465, 0.21558819543470095, 0.13466130493356396, -0.08541560066558912, 0.4644839213650467, -0.28155271872099746, 0.8123914859953366, -0.7999011620594698, 0.05080699475995819, -0.42987531545941576, 0.5344817784223003, 0.6016172695775843, 0.4454882203792493, 0.3112172380686811, -0.20478926953181611, -0.16341507149425732, -0.2593043292102348, 0.2701032551131196, -0.22378497051761354, -0.24252045642141373, -0.7905334191075697, 0.2838946544589725, 0.7842882571396362, 0.36846455610807066, -1.208438840795113, -1.0455441994648502, -0.2244355082226066, 0.7593076092679026, -0.006001210328561002, 0.8987828932184153, 0.16874948067520043, 0.24160970363442344, 0.651058135157057, 0.10649302230736435, -1.0991485063562785, -0.1463709836234391, 0.4473097259532298, -0.5256344656343945, 0.9674796748656826, -2.471002418645649, -0.48347962235084413, -0.5521764039981115, 0.6318022190892624, -0.9773678479815773, 0.526154895798389, 0.0582231245968791, 0.33021293905447857, -0.09738549443746147, -0.4944086557947276, -0.16887958821619906, -1.2459098126027135, -0.22781830428857053, 0.9419785968299547, 0.4855613430068219, 0.2512376616683208, -0.9830925797855162, 0.4072366033256572, 0.45693768398712714, -0.5443699515381948, -0.4155634859495684, -0.06521640492555453, -0.24356131674940262, 0.07617796525468763, -0.7567054584479304, 0.036397584594361855, -0.8040646033714254, 0.7593076092679026, -0.09322205312550587, 0.04804220951373767, -1.1272517352119789, -0.1828010951030506, -0.34348390823633707, -0.04680618787425085, -0.44236563939528256, 0.5651871580979728, 0.33489681053042863, 0.24356131674940262, -0.8873334296105374, 0.10681829115986088, -0.18306131018504782, -0.3976086452917599, -0.6432516826971403, -0.5865247948217452, 0.9086710663343098, 1.0783312997965007, 0.39786886037375707, -0.08040646033714254, -0.4728108039889579, 0.3442645534823287, -0.19255916067794654, -0.10753388263535325, 0.16029249051029063, -0.536563499078278, -0.3450451987283204, -0.7530624472999693, 0.5500946833421337, -0.8436172958350036, 0.3234473469225507, 0.3442645534823287, -0.9013850440383875, -0.051392478694451946, 0.4374215528373353, -0.5771570518698451, -1.0044302165092887, 0.5316194125203307, -0.505337689238611, -0.5391656498982503, -0.2192312065826621, -0.03392554131538821, 0.6500172748290681, 0.2917011069188893, -1.0856173220924228, -0.2927419672468782, 0.1484527042794169, -1.1522323830837125, -0.42441079873747406, 0.40515488266967936, 0.5646667279339783, 0.7462968551680415, 0.29768605380482543, 0.23900755281445119, -1.2365420696508134, -0.048269897710485246, 0.035161562954875034, 0.05464516721941726, 0.40957853906363223, -0.16692797510121987, 1.3208517562179143, 0.012108133034183377, 0.23458389642049837, -1.647681899206429, -0.6916516879486242, 0.5048172590746166, -0.2505871239633277, -0.505337689238611, -0.10454140919238517, 0.13934517640951402, -0.8040646033714254, 0.06271183476133123, 0.4147828407035767, -0.20348819412182997, 0.5334409180943114, -0.3741892879120096, 0.33853982167838975, -0.2888387410169198, -0.1610731357562823, -0.32266670167655903, 0.046578499677503285, 0.09009947214153917, -0.0033766972749796156, -0.3637806846321206, 1.037217316840939, -0.12633442230965275, 0.5802796328538118, -0.13160377772009657, -0.8691183738707317, -0.5035161836646305, 0.0873672137805683, 1.1938667962032685, 0.7015398610645187, 0.13635270296654592, -0.33021293905447857, -0.0800161377141467, 0.7025807213925076, 0.2669806741291529, 0.2792107829830225, 0.2979462688868227, -0.6380473810571958, -1.0054710768372777, 0.06713549115528405, 1.188662494563324, -0.8509033181309259, 0.604739850561551, 0.2037484092038272, -1.2021936788271796, 0.40515488266967936]
    image_embedding_tensor = torch.tensor(image_embedding_list)
    normalized_tensor = torch.nn.functional.normalize(image_embedding_tensor, p=2, dim=0)
    image_embedding_tensor = torch.unsqueeze(image_embedding_tensor, 0)
    negative_image_embedding = None
    prompt_generation_policy = "top-k"

    # Generate img2img generation jobs with Kandinsky using the embeddings
    response = generate_img2img_generation_jobs_with_kandinsky(
        image_embedding=image_embedding_tensor,
        negative_image_embedding = None,  
        dataset_name="test-generations",
        prompt_generation_policy=prompt_generation_policy
    )

    print(response)