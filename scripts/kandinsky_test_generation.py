import io
import sys
import os
import uuid
import torch


base_directory = os.getcwd()
sys.path.insert(0, base_directory)

from utility.http import generation_request
from utility.http import request
from utility.minio.cmd import connect_to_minio_client, upload_data
from worker.generation_task.generation_task import GenerationTask
from kandinsky_worker.dataloaders.image_embedding import ImageEmbedding

def read_msgpack_file(file_path):
    """Reads a msgpack file and returns its bytes."""
    with open(file_path, "rb") as f:
        return f.read()

def generate_img2img_generation_jobs_with_kandinsky(image_embedding,
                                                    negative_image_embedding,
                                                    dataset_name,
                                                    prompt_generation_policy,
                                                    seed = "",
                                                    decoder_guidance_scale = 12,
                                                    self_training= False,
                                                    init_img_path="./test/test_inpainting/white_512x512.jpg"):

    # get sequential ids
    sequential_ids = request.http_get_sequential_id(dataset_name, 1)

    count = 0
    # generate UUID
    task_uuid = str(uuid.uuid4())
    task_type = "img2img_generation_kandinsky"
    model_name = "kandinsky_2_2"
    model_file_name = "kandinsky-2-2-decoder"
    model_file_path = "input/model/kandinsky/kandinsky-2-2-decoder"
    task_input_dict = {
        "strength": 0.75,
        "seed": seed,
        "dataset": dataset_name,
        "file_path": sequential_ids[count]+".jpg",
        "init_img": init_img_path,
        "num_images": 1,
        "image_width": 512,
        "image_height": 512,
        "decoder_steps": 100,
        "decoder_guidance_scale": decoder_guidance_scale,
        "self_training": self_training
    }

    prompt_generation_data={
        "prompt_generation_policy": prompt_generation_policy
    }

    image_embedding= image_embedding.detach().cpu().numpy().tolist()[0]
    negative_image_embedding= image_embedding.detach().cpu().numpy().tolist()[0] if negative_image_embedding is not None else None

    # create the job
    generation_task = GenerationTask(uuid=task_uuid,
                                     task_type=task_type,
                                     model_name=model_name,
                                     model_file_name=model_file_name,
                                     model_file_path=model_file_path,
                                     task_input_dict=task_input_dict,
                                     prompt_generation_data=prompt_generation_data)
    generation_task_json = generation_task.to_dict()

    # add job
    response = generation_request.http_add_kandinsky_job(job=generation_task_json,
                                                         positive_embedding=image_embedding,
                                                         negative_embedding=negative_image_embedding)

    return response


if __name__ == "__main__":
    image_embedding_list = [-12.969873820591143, 3.878283143592521, -15.214803101786044, -6.839203158989119, 4.683772719569429, 6.85039051421102, -3.5780891118048306, 3.6153802958778356, -16.587118675672627, -6.235085977006438, -6.481207791888271, -14.961223050089611, 3.5314751317135746, 2.9348161865454943, 8.084728707027486, 7.905731023477062, -3.736576644115102, 2.2971369388971086, 6.358146884447354, 0.258474519606016, -5.87709060990559, 2.0081302623313197, -8.644096468122562, -5.28788990155211, 4.832937455861449, -0.584073170543441, 7.846065128960254, -8.606805284049557, -11.515517641743948, 1.740566016607509, -4.460025615131399, -17.76552009237959, -6.581893988885384, -9.29296307099285, 7.428403867342598, 0.5882684287516541, 4.571899167350415, -0.8576972336791152, 2.410875050319774, 12.57458726941729, 7.66706744540983, 2.321376208544562, -3.4997776252515203, -1.7955705131151913, 5.910652675571294, 2.882608528843287, -20.823397186365998, -9.732999043054308, -0.8749444063128801, -8.248809916948709, 3.445705408345663, -12.380673112237664, -8.547139389532749, -5.1014339811870855, 1.2324736336128157, 5.8994653203493925, -12.089801876468224, -2.703610845292863, 1.71166534895093, 4.198987326620364, -2.3344281229701136, -0.3146443656159798, 31.41409346309942, -4.135592313696256, 2.3717193070431186, 0.7402300038491495, 3.1063556332813174, -3.460621881974865, -7.297884723087081, 2.882608528843287, 7.338905025567386, 5.694363807947865, 10.829359854800655, 0.19671099598510144, -7.253135302199475, 2.591737293073848, 11.358894668637326, 2.092035426495581, 7.74164981355584, -16.273872729459388, -11.821305351142588, -2.2971369388971086, -7.245677065384873, -0.7248473904190349, -3.2555203695733375, 7.793857471258047, 19.71957813780505, 11.888429482473997, 4.310860878839379, 8.465098784572138, -0.9742321839072559, 1.5904690007136637, -12.082343639653624, 4.702418311605932, -7.447049459379101, 0.3029908705931657, -4.269840576359074, 6.492395147110172, -11.76163945662578, -10.434073303626802, -7.756566287185042, -6.936160237578932, -2.845317344770282, -10.732402776210842, 15.93079383598774, -0.5099569421983435, -6.451374844629867, 2.069660716051778, -14.148275237298101, 5.466887585102534, -7.5104444723032096, -8.9275094670774, 5.686905571133265, -9.031924782481813, -1.8990535489177802, -3.9416781565166294, 13.462117450354809, 2.3791775438577196, 2.1330557289758865, -2.2412001627876013, 3.9789693405896345, -7.734191576741239, -3.930490801294728, 6.91751464554243, -6.936160237578932, -0.5192797382165948, -0.7458236814601003, 9.196005992403036, 9.479418991357873, 1.980161874276566, 0.5589016212941625, -8.659012941751763, 2.711069082107464, -1.9820264334802162, -9.337712491880454, -12.112176586912028, 0.15242771489840798, 1.7023425529326788, -4.832937455861449, -10.34457446185159, 23.090701178004704, 18.272680195772455, -2.711069082107464, -2.4313852015599267, -6.5781648704780835, -11.873513008844796, 14.998514234162615, 9.121423624257025, -2.75581850299507, 5.664530860689461, -5.2356822438499035, -4.832937455861449, -1.6053854743428657, 20.31623708297313, -7.659609208595229, 4.336964707690483, -2.781922331846174, -6.134399780009324, 10.896483986132065, -3.4196015794945596, -0.1928653426275728, -0.6689106143095274, 6.134399780009324, -8.122019891100491, 7.0144717241322425, -8.010146338881476, 3.20144815266748, -7.189740289275366, -7.525360945932412, 0.2215329403836954, -3.2517912511660367, -0.33701907605978276, -0.3654536039154491, 2.9590554561929476, -8.606805284049557, -3.5762245526011807, 8.733595309897774, -6.149316253638526, 5.258056954293706, -1.995078347905768, -7.573839485227317, 11.194813458716105, 0.17095677198468234, -11.776555930254982, -2.5432587537789417, 0.8511712764663394, 6.5483319232196795, -2.7949742462717255, -1.950328927018162, 6.238815095413738, -7.227031473348371, 3.2778950800171405, 9.911996726604732, 12.80579261066992, -1.548516418631533, -2.1535658802160396, -9.218380702846838, -4.329506470875882, -8.673929415380966, 22.494042232836623, -2.0360986503860734, 1.071189262497069, -29.355620102269544, -3.5911410262303827, -2.3418863597847146, 5.545199071655845, -1.4450333828289441, -7.562652130005416, 43.58593594452826, -3.087710041244815, -7.868439839404057, 6.9846387768738385, 0.24752023428457076, -6.943618474393533, 6.839203158989119, -1.5391936226132819, -6.484936910295572, -9.039383019296414, -2.4313852015599267, 0.46334296210708725, 8.301017574650915, -3.3748521586069535, -18.24284724851405, 5.451971111473332, 6.585623107292685, -4.586815640979617, -2.280355906064256, 1.3023946037497, 19.12291919263697, -9.501793701801677, 20.405735924748342, 1.0516113908587412, -1.1513653082540296, 2.651403187590656, -0.9448653764497644, 7.674525682224431, -3.632161328710688, 12.910207926074335, 3.5221523356953233, -5.6421561502456585, -1.756414769838536, -8.62917999449336, -11.672140614850568, 5.120079573223588, 8.621721757678758, -3.7496285585406537, -6.369334239669255, 1.6193696683702425, 9.345170728695056, 12.238966612760244, 1.0040651311656599, 22.70287286364545, -17.303109409874324, 10.083536173340555, -7.831148655331052, -12.664086111192502, -10.441531540441403, 2.75208938458777, -13.081747372810158, 1.2362027520201162, 0.7136600351971334, -12.962415583776542, -10.359490935480792, -1.1392456734303031, -16.482703360268214, -12.94004087333274, -15.18497015452764, 2.537665076167991, 9.248213650105242, -6.604268699329188, -19.346666297075, 1.6855615200998264, -2.724120996533016, 5.310264611995914, -7.051762908205247, -4.53833710168471, -12.067427166024421, 14.081151105966692, 7.868439839404057, 10.508655671772813, -12.925124399703536, 8.233893443319506, -3.7682741505771564, 6.082192122307117, 12.373214875423063, -3.05041885717181, 9.844872595273323, 2.1778051498634925, 10.240159146447176, 13.939444606489273, 3.0187213507097557, -31.62292409390825, -10.284908567334782, -9.017008308852612, -1.7452274146166344, -7.312801196716283, 3.6862335456165454, 0.4251194984322571, -7.89081454984786, 3.6153802958778356, 5.694363807947865, 0.24006199746996976, 2.328834445359163, 8.278642864207113, 9.89708025297553, -5.351284914476219, -4.5420662200920106, 2.7725995358279225, -8.241351680134107, 2.931087068138194, -20.0924899785351, -0.2115109346640753, 11.948095376990805, -5.694363807947865, 15.886044415100134, -8.569514099976551, -7.085324973870952, 9.181089518773833, -4.944811008080465, 8.032521049325279, 1.8244711807717702, -13.954361080118476, 0.5421205884613104, 0.5421205884613104, -24.70168032995852, 1.9708390782583147, 13.119038556883163, 0.9984714535547091, 4.6502106539037245, 1.2231508375945643, 0.4969050277727918, 4.832937455861449, 4.251194984322571, -2.410875050319774, -11.948095376990805, 0.6814963889341665, 24.597265014554104, 2.612247444314001, -19.988074663130686, -2.090170867291931, 35.65037197379279, 0.5258056954293706, -16.557285728414225, 19.77924403232186, 0.49830344717552943, -5.310264611995914, -9.218380702846838, 8.957342414335804, 9.37500367595346, -2.1759405906598426, 10.165576778301165, -2.3045951757117096, -14.28998173677552, -2.0230467359605218, -6.540873686405079, -5.888277965127491, -6.745975198806606, 5.347555796068918, 0.9583834306762288, 1.0889025749317462, -7.544006537968913, -2.845317344770282, 23.269698861555128, 6.555790160034281, -10.03878675245295, 5.440783756251431, -7.860981602589456, 8.084728707027486, -11.068023432867887, 11.47076822085634, -2.08271263047733, -4.583086522572316, -8.077270470212886, 7.476882406637505, 4.348152062912384, -14.461521183511342, -14.767308892909984, -1.7153944673582304, -10.314741514593186, 16.07995857227976, 13.603823949832227, 2.3791775438577196, -10.05370322608215, -4.102030248030551, 3.505371302862471, 6.119483306380122, 14.640518867061767, -0.8040911565741705, 18.39201198480607, -1.0460177132477906, -14.21539936862951, 13.163787977770768, -8.688845889010167, 1.2231508375945643, 2.2337419259730003, 4.340693826097783, -19.152752139895373, 6.432729252593364, 4.631565061867223, -3.5780891118048306, -2.174076031456192, -23.29953180881353, -9.90453848979013, -7.786399234443446, -5.321451967217815, -7.327717670345485, 8.315934048280118, 9.196005992403036, 7.573839485227317, 0.2559107507009969, -5.918110912385895, 3.27230140240619, 8.55459762634735, 4.348152062912384, -5.992693280531905, -16.423037465751406, 16.66170104381864, -15.147678970454635, -8.457640547757537, 3.766409591373506, 18.45167787932288, 0.5188135984156822, 3.3375609745339485, -1.0814443381171452, -18.91408856182814, -3.57249543419388, -1.458085297254496, 3.6974209008384467, -5.5824902557288505, 8.248809916948709, 6.2164403849699355, -6.91751464554243, -1.6641190892578486, 3.264843165591589, 5.679447334318663, -8.599347047234955, 1.6333538623976194, 0.96770622669448, -12.701377295265507, -3.363664803385052, 9.151256571515429, 4.005073169440738, -9.60620901720609, 3.057877093986411, 2.574956260240996, -5.5974067293580525, 7.778940997628845, 4.034906116699142, -2.5096966881132374, -3.6302967695070376, -3.1380531397433717, -1.4403719848198184, -9.106507150627824, -3.7384412033187524, -12.35829840179386, 0.059957231892378365, -6.723600488362804, 2.5712271418336954, -6.656476357031394, -3.0616062123937113, 5.425867282622229, -2.5134258065205377, -1.1690786206887072, -4.172883497769261, -6.757162554028508, 1.6473380564249964, -3.8670957883706194, 12.567129032602688, -16.557285728414225, 7.350092380789287, 4.83666657426875, 1.697681154923553, -6.309668345152448, 8.755970020341577, 12.768501426596915, -10.4191568299976, 4.847853929490651, 3.9715111037750335, 4.888874231970957, -15.080554839123227, -4.594273877794217, -5.940485622829698, 3.915574327665526, -2.686829812460011, -3.1585632909835244, -13.946902843303874, 6.361876002854655, 1.3135819589716016, 6.980909658466538, 13.775363396568052, 8.509848205459743, 5.228224007035302, 0.27269178353384915, -3.451299085956614, -5.88081972831289, -0.7770550481212419, 3.87082490677792, 9.099048913813222, 10.389323882739196, 2.276626787656956, -7.010742605724942, -9.665874911722899, 3.8820122619998214, 8.084728707027486, -0.24985093328913358, -8.815635914858385, -0.700141980970669, 8.755970020341577, 4.728522140457035, 3.6414841247289393, -0.5961928053671676, -2.092035426495581, 10.680195118508635, -6.235085977006438, -6.742246080399306, -1.740566016607509, 3.6452132431362396, -19.555496927883826, 5.87709060990559, 1.688358358905302, 3.242468455147786, 0.2201345209809577, 6.4737495550736694, -10.441531540441403, -12.835625557928324, 4.5420662200920106, -0.41742819171719986, -12.50746313808588, -4.963456600116967, -0.1753851000933517, -12.544754322158886, 6.641559883402192, -16.43795393938061, 13.790279870197253, -0.8838010625302187, 0.12830498020118286, 0.041719512181674356, 6.876494343062124, 6.6974966595117, 11.179896985086902, 13.245828582731379, 8.875301809375193, 17.616355356087567, -11.619932957148361, -3.900657854036324, 8.129478127915093, -0.8646893306928037, -2.625299358739553, 3.8447210779268164, 12.015219508322215, 4.102030248030551, -1.3275661529989784, -4.247465865915271, 0.8656216102946288, -1.294936366935099, -0.34797336138122803, -7.003284368910341, -3.3226445009047465, 11.642307667592164, -10.158118541486566, 4.38917236539269, 1.9447352494072112, -11.731806509367376, -7.793857471258047, -2.5488524313898924, 5.57876113732155, 14.730017708836979, -8.196602259246502, -10.918858696575867, -1.2585774624639192, -9.046841256111016, -2.4463016751891287, -5.500449650768239, 2.15729499862334, -8.360683469167723, -14.282523499960918, 7.544006537968913, -7.409758275306095, 8.949884177521202, -3.4046851058653576, -6.857848751025622, 9.516710175430878, 4.6352941802745224, 6.376792476483857, 2.1386494065868376, -1.123396920199276, 3.6731816311909937, -8.427807600499133, 6.018797109383009, -7.100241447500154, -11.269395826862114, -3.298405231257293, 1.5121575141603532, 15.058180128679423, 4.791917153381144, 0.788708543144056, 3.3506128889595, 10.657820408064833, 13.91706989604547, 3.770138709780807, 2.8900667656578882, 1.6911551977107773, -0.3740771902323315, 14.155733474112703, 8.681387652195566, 17.94451777593001, 10.635445697621028, -16.21420683494258, -1.3564668206555572, -6.9548058296154345, -0.15953634686232457, -3.3077280272755445, -2.895660443268839, 3.037366942746258, 4.959727481709667, 6.9398893559862325, -4.4712129703533, 9.829956121644122, -8.218976969690305, -0.7616724346911273, 7.4209456305279975, 4.31831911565398, 11.060565196053286, 6.279835397894044, -8.659012941751763, -4.583086522572316, -2.6047892074994, 0.8204060496061102, 0.8777412451183554, 6.6079978177364875, 9.046841256111016, 0.461478402903437, -1.2082343639653623, 16.542369254785022, 0.3861968250560581, -3.313321704886495, 2.4388434383745277, -2.882608528843287, 13.10412208325396, 10.04624498926755, -2.4686763856329317, 18.15334840673884, 9.554001359503884, -11.46330998404174, -6.77207902765771, 8.957342414335804, -9.994037331565343, -3.5669017565829293, 13.081747372810158, 3.0933037188557657, 5.5824902557288505, -7.234489710162972, 0.9164308485940982, 2.9888884034513516, 2.3176470901372612, 3.8745540251852204, -1.0842411769226208, -1.370451014682934, -19.316833349816594, -0.4612453330029807, -7.133803513165859, -2.1889925050853942, -2.0081302623313197, -2.418333287134375, 1.0152524863875614, 1.0926316933390468, 3.0392315019499083, -10.337116225036988, -0.8884624605393444, 0.20510151240152755, 5.123808691630888, 1.9083763449360314, 16.751199885593852, -5.560115545285047, 14.163191710927302, -4.195258208213064, 4.616648588238021, -2.696152608478262, -3.1585632909835244, 6.727329606770104, 9.986579094750741, -2.2188254523437982, -0.7789196073248922, -5.306535493588613, -8.964800651150405, 13.999110501006081, -4.0908428928086495, 0.6647153561013143, 18.138431933109636, 6.559519278441582, -6.786995501286912, -15.132762496825434, 1.690222918108952, 1.5802139250935874, 0.4153305626130933, 2.856504699992184, -5.575032018914249, 0.4141652131108119, 5.366201388105421, -10.971066354278074, 3.2667077247952387, 9.382461912768061, 0.136695496617609, 1.4096067579595895, 0.6497988824721123, 2.060337920033527, 8.576972336791153, -3.4923193884369192, -16.43795393938061, 0.7467559610619253, -11.53789235218775, 6.77580814606501, 4.7247930220497345, 4.102030248030551, -8.733595309897774, 2.4724055040402324, -3.7086082560603484, 3.372987599403303, 14.200482895000308, 6.447645726222566, 2.0006720255167187, -16.07995857227976, 2.5022384512986364, -5.045497205077578, -5.35874315129082, -11.97792832424921, 5.202120178184199, -4.780729798159243, 4.292215286802877, 0.5290686740357586, -10.896483986132065, 0.39878259968069735, -11.9033459561032, -10.04624498926755, 3.4046851058653576, 9.650958438093697, -3.9789693405896345, 15.050721891864823, -1.8319294175863712, 3.550120723750077, 1.569958849473511, -0.07970990595604821, -2.619705681128602, 1.8058255887352677, -16.184373887684174, 5.123808691630888, -6.667663712253296, 2.9441389825637456, -0.2594067992078411, 4.691230956384031, 11.866054772030195, -6.92124376394973, 2.1535658802160396, -9.837414358458721, 3.908116090850925, 3.632161328710688, 6.786995501286912, 0.7896408227458811, 10.516113908587412, 2.560039786611794, 18.54117672109809, 5.261786072701007, 2.662590542812558, -7.581297722041919, 2.477999181651183, 1.2082343639653623, -10.352032698666191, 10.180493251930368, -7.469424169822903, -11.776555930254982, -1.1075481669682488, 6.126941543194723, 10.113369120598959, 1.3452794654336557, -1.0926316933390468, 7.532819182747012, -9.89708025297553, -10.19540972555957, -3.7458994401333534, 6.17914920089693, 19.80907697958026, 3.6899626640238457, -4.448838259909498, -1.175604577901483, 0.8488405774617765, -12.224050139131043, -1.3089205609624759, 9.621125490835293, 16.00537620413375, -0.6097108595936319, 6.451374844629867, 12.35829840179386, 1.1914533311325102, 8.994633598408809, 5.739113228835471, -3.074658126819263, -1.9009181081214304, 7.260593539014075, 2.1833988274744436, -1.450627060439895, -10.695111592137836, 4.087113774401349, 0.9010482351639836, 1.9894846702948172, -8.084728707027486, 3.609786618266885, 0.7807841665285424, 2.149836761808739, 1.9857555518875167, -19.64499576965904, -2.129326610568586, 2.569362582630045, 0.6013203431772058, 3.550120723750077, -14.767308892909984, 0.4507571874824481, -6.988367895281139, -3.6489423615435403, -5.925569149200496, 9.82249788482952, 6.876494343062124, -7.547735656376214, -9.501793701801677, 2.097629104106532, 21.255974921612857, 1.6091145927501662, 11.664682378035968, -7.81623218170185, -4.232549392286069, 10.19540972555957, -0.3670850932186431, -9.762831990312712, 18.943921509086547, 0.3575292272999355, -8.427807600499133, 6.313397463559748, -7.570110366820018, -9.88962201616093, 6.824286685359917, 6.712413133140902, -2.3866357806723206, -0.5374591904521847, 7.159907342016962, 4.586815640979617, 2.8434527855666323, 10.918858696575867, -5.489262295546338, -2.2822204652679066, -5.13499604685279, 7.913189260291663, 14.200482895000308, 2.024911295164172, 4.609190351423419, -4.7546259693081385, -5.813695596981481, -19.376499244333402, 2.849046463177583, -5.6123232029872545, 11.38872761589573, -1.1634849430777563, 5.906923557163994, -4.683772719569429, 4.426463549465695, 14.685268287949373, 4.355610299726985, -1.2389995908255915, 11.873513008844796, -7.167365578831563, -2.3176470901372612, -3.878283143592521, 7.525360945932412, 8.509848205459743, -2.039827768793374, 4.143050550510857, 2.591737293073848, -1.027372121211288, -13.812654580641055, 3.602328381452284, 4.519691509648207, 8.122019891100491, 2.962784574600248, 22.195712760252583, 1.1261937590047513, 5.515366124397441, -2.8900667656578882, 2.688694371663661, 1.1168709629865001, -6.2462733322283395, 9.568917833133085, 3.7253892888932008, -9.926913200233933, -1.8720174404648515, 6.5781648704780835, 5.616052321394554, -15.766712626066518, 3.283488757628091, 11.46330998404174, -3.781326065002708, -2.4891865368730843, -6.279835397894044, -6.91751464554243, -4.374255891763488, -5.515366124397441, -5.258056954293706, -5.947943859644299, 18.347262563918466, -4.0759264191794475, -5.0865175075578835, 14.961223050089611, 4.336964707690483, 5.000747784189972, -10.217784436003372, -7.652150971780628, -18.362179037547666, -10.255075620076378, -10.665278644879432, 8.823094151672986, 13.454659213540207, 1.6277601847866687, 4.374255891763488, -4.989560428968071, -1.2921395281296235, 5.1014339811870855, -1.8300648583827208, -3.6582651575617917, -4.791917153381144, 2.8061616014936273, 5.082788389150583, -2.960920015396598, 11.314145247749721, -5.772675294501176, 17.318025883503527, 3.473673796400417, -0.792903801352269, -3.391633191439806, 3.9640528669604325, -6.936160237578932, 10.784610433913048, -13.491950397613213, -17.288192936245125, 1.3219724753880275, 13.260745056360582, -4.959727481709667, -7.174823815646164, 6.9249728823570305, 5.448241993066032, -4.0162605246626395, -8.48747349501594, -0.6488666028702872, -5.58621937413615, 0.9723676247036056, 23.46361301873475, -2.740902029365868, -0.12445932684365422, -13.051914425551754, -13.91706989604547, -0.6008542033762932, -3.9491363933312305, 4.885145113563657, -13.820112817455657, 6.425271015778764, -3.3450192113485495, 6.220169503377236, 6.018797109383009, -3.4792674740113676, 5.1760163493330955, 5.72792587361357, -6.611726936143788, 23.22494944066752, 6.9697223032446365, -7.786399234443446, 4.128134076881655, 11.396185852710332, -8.502389968645142, -5.187203704554997, 5.664530860689461, -6.097108595936319, 3.3189153824974458, 6.682580185882498, -2.985159285044051, -10.381865645924595, -3.7906488610209594, 5.713009399984368, 0.42465335863134457, -1.972703637461965, -0.5262718352302832, -12.05251069239522, 19.361582770704203, -8.435265837313734, 5.492991413953638, 6.9697223032446365, 1.8114192663462183, -1.7163267469600556, 3.324509060108397, -6.857848751025622, -5.43705463784413, 3.5892764670267323, 15.990459730504549, 6.264918924264842, 8.890218283004394, -5.049226323484879, 5.936756504422398, 10.090994410155156, 5.668259979096762, -13.573991002573823, 10.284908567334782, 6.190336556118832, -5.28043166473751, -1.965245400647364, -7.003284368910341, -12.641711400748699, -6.839203158989119, 2.666319661219858, -18.37709551117687, -14.707642998393176, 5.258056954293706, 0.7239151108172097, 1.4394397052179935, -5.757758820871974, 4.568170048943114, 6.10456683275092, -5.064142797114081, 8.122019891100491, 18.83950619368213, 3.2070418302784307, 1.585807602704538, 4.348152062912384, -11.940637140176204, 5.9516729780516, -10.04624498926755, -2.774464095031573, 0.3174412044214552, -1.5354645042059814, -2.2039089787145962, 5.336368440847017, -14.028943448264485, -6.302210108337847, 2.739037470162218, 7.077866737056351, 7.122616157943957, -4.262382339544473, -9.188547755588434, 5.895736201942092, 1.2380673112237663, -3.7533576769479544, -12.865458505186728, 12.097260113282825, -0.2843452785566632, 7.0293881977614445, 7.81623218170185, 3.5370688093245253, 6.988367895281139, -4.556982693721213, 1.2007761271507613, 1.6790355628870506, 12.999706767849547, 6.779537264472311, 1.9149023021488072, -8.03997928613988, -9.807581411200317, -11.053106959238685, -0.8819365033265685, 1.4869859649110748, 2.8844730880469376, 4.4078179574291925, 0.7062017983825324, -8.196602259246502, 7.506715353895909, -7.935563970735466, 9.389920149582661, 6.25000245063564, -3.4848611516223182, -5.962860333273501, 6.880223461469424, -6.093379477529019, -1.4254555111906166, -5.645885268652958, -5.761487939279274, -9.002091835223409, 0.5808101919370531, 17.153944673582306, 3.0187213507097557, -6.2462733322283395, -17.735687145121183, 22.165879812994177, -4.6502106539037245, -0.37594174943598174, -8.010146338881476, 5.58621937413615, -13.081747372810158, -4.501045917611704, 3.1604278501871748, 4.366797654948887, 3.1455113765579727, 4.303402642024778, -6.559519278441582, 0.7989636187641324, -12.35829840179386, 6.5632483968488815, -4.206445563434965, 5.9516729780516, 8.830552388487586, -4.933623652858563, -0.9705030654999554, -3.9715111037750335, 3.089574600448465, 1.9298187757780092, -1.2240831171963895, 6.656476357031394, -4.034906116699142, 11.642307667592164, -11.46330998404174, 0.7281103690254228, -6.160503608860428, 7.659609208595229, 8.621721757678758, 6.384250713298457, 4.460025615131399, -2.9348161865454943, -2.3418863597847146, -3.7160664928749494, 3.87082490677792, -3.2070418302784307, -3.475538355604067, -11.329061721378922, 4.068468182364847, 11.23956287960371, 5.28043166473751, -17.318025883503527, -14.983597760533414, -3.216364626296682, 10.881567512502862, -0.08600279326836781, 12.880374978815931, 2.418333287134375, 3.4624864411785152, 9.330254255065853, 1.52614170818773, -15.751796152437317, -2.097629104106532, 6.410354542149562, -7.532819182747012, 13.864862238343264, -35.41170839572556, -6.928702000764331, -7.913189260291663, 9.054299492925617, -14.006568737820682, 7.540277419561614, 0.8343902436334871, 4.732251258864336, -1.3956225639322126, -7.085324973870952, -2.4201978463380254, -17.8550189341548, -3.264843165591589, 13.499408634427814, 6.958534948022735, 3.6004638222486336, -14.088609342781293, 5.836070307425284, 6.5483319232196795, -7.801315708072648, -5.9554020964589, -0.9346103008296881, -3.490454829233269, 1.0916994137372218, -10.844276328429856, 0.5216104372211576, -11.522975878558547, 10.881567512502862, -1.3359566694154046, 0.6884884859478551, -16.154540940425772, -2.619705681128602, -4.922436297636661, -0.6707751735131776, -6.339501292410852, 8.099645180656688, 4.7993753901957446, 3.490454829233269, -12.716293768894708, 1.5308031061968557, -2.6234347995359024, -5.698092926355166, -9.218380702846838, -8.40543289005533, 13.02208147829335, 15.453466679853276, 5.701822044762467, -1.1522975878558548, -6.77580814606501, 4.933623652858563, -2.759547621402371, -1.541058181816932, 2.2971369388971086, -7.689442155853633, -4.944811008080465, -10.79206867072765, 7.883356313033259, -12.089801876468224, 4.6352941802745224, 4.933623652858563, -12.917666162888935, -0.736500885441849, 6.268648042672142, -8.271184627392511, -14.394397052179935, 7.6185889061149235, -7.241947946977573, -7.726733339926638, -3.141782258150672, -0.4861838123518028, 9.315337781436652, 4.180341734583862, -15.55788199525769, -4.195258208213064, 2.127462051364936, -16.51253630752662, -6.082192122307117, 5.80623736016688, 8.092186943842087, 10.695111592137836, 4.266111457951773, 3.42519525710551, -17.72077067149198, -0.691751464554243, 0.5038971247864802, 0.7831148655331053, 5.8696323730909885, -2.3922294582832713, 18.929005035457344, 0.17352054088970145, 3.361800244181402, -23.612777755026773, -9.911996726604732, 7.234489710162972, -3.5911410262303827, -7.241947946977573, -1.4981733201329763, 1.9969429071094182, -11.522975878558547, 0.8987175361594207, 5.944214741236999, -2.916170594508992, 7.644692734966027, -5.36247226969812, 4.851583047897952, -4.139321432103556, -2.3083242941190103, -4.624106825052621, 0.6675121949067897, 1.2912072485277986, -0.048391138082235406, -5.2133075334061, 14.864265971499798, -1.8104869867443933, 8.315934048280118, -1.8860016344922284, -12.455255480383673, -7.215844118126469, 1.2520515052511432, 17.1091952526947, 10.05370322608215, 1.9540580454254626, -4.732251258864336, -1.1467039102449041, 10.068619699711354, 3.826075485890314, 4.0013440510334375, 4.269840576359074, -9.14379833470083, -14.409313525809136, 0.9621125490835293, 17.03461288454869, -12.194217191872639, 8.666471178566365, 2.9198997129162922, -17.228527041728317, 5.80623736016688]
    image_embedding_tensor = torch.tensor(image_embedding_list)
    normalized_tensor = torch.nn.functional.normalize(image_embedding_tensor, p=2, dim=0)
    image_embedding_tensor = torch.unsqueeze(image_embedding_tensor, 0)
    negative_image_embedding = None
    prompt_generation_policy = "top-k"

    # Generate img2img generation jobs with Kandinsky using the embeddings
    response = generate_img2img_generation_jobs_with_kandinsky(
        image_embedding=image_embedding_tensor,
        negative_image_embedding = None,  
        dataset_name="test-generations",
        prompt_generation_policy=prompt_generation_policy
    )

    print(response)