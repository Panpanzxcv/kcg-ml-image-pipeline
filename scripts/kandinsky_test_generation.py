import io
import sys
import os
import uuid
import torch


base_directory = os.getcwd()
sys.path.insert(0, base_directory)

from utility.http import generation_request
from utility.http import request
from utility.minio.cmd import connect_to_minio_client, upload_data
from worker.generation_task.generation_task import GenerationTask
from kandinsky_worker.dataloaders.image_embedding import ImageEmbedding

def read_msgpack_file(file_path):
    """Reads a msgpack file and returns its bytes."""
    with open(file_path, "rb") as f:
        return f.read()

def generate_img2img_generation_jobs_with_kandinsky(image_embedding,
                                                    negative_image_embedding,
                                                    dataset_name,
                                                    prompt_generation_policy,
                                                    self_training= False,
                                                    init_img_path="./test/test_inpainting/white_512x512.jpg"):

    # get sequential ids
    sequential_ids = request.http_get_sequential_id(dataset_name, 1)

    count = 0
    # generate UUID
    task_uuid = str(uuid.uuid4())
    task_type = "img2img_generation_kandinsky"
    model_name = "kandinsky_2_2"
    model_file_name = "kandinsky-2-2-decoder"
    model_file_path = "input/model/kandinsky/kandinsky-2-2-decoder"
    task_input_dict = {
        "strength": 0.75,
        "seed": "",
        "dataset": dataset_name,
        "file_path": sequential_ids[count]+".jpg",
        "init_img": init_img_path,
        "num_images": 1,
        "image_width": 512,
        "image_height": 512,
        "decoder_steps": 100,
        "decoder_guidance_scale": 12,
        "self_training": self_training
    }

    prompt_generation_data={
        "prompt_generation_policy": prompt_generation_policy
    }

    image_embedding= image_embedding.detach().cpu().numpy().tolist()[0]
    negative_image_embedding= image_embedding.detach().cpu().numpy().tolist()[0] if negative_image_embedding is not None else None

    # create the job
    generation_task = GenerationTask(uuid=task_uuid,
                                     task_type=task_type,
                                     model_name=model_name,
                                     model_file_name=model_file_name,
                                     model_file_path=model_file_path,
                                     task_input_dict=task_input_dict,
                                     prompt_generation_data=prompt_generation_data)
    generation_task_json = generation_task.to_dict()

    # add job
    response = generation_request.http_add_kandinsky_job(job=generation_task_json,
                                                         positive_embedding=image_embedding,
                                                         negative_embedding=negative_image_embedding)

    return response


if __name__ == "__main__":
    image_embedding_list = [-0.1621234227573893, 0.04847853929490652, -0.19018503877232557, -0.085490039487364, 0.05854715899461787, 0.08562988142763776, -0.044726113897560385, 0.04519225369847295, -0.20733898344590784, -0.07793857471258048, -0.0810150973986034, -0.18701528812612014, 0.04414343914641969, 0.03668520233181868, 0.10105910883784358, 0.09882163779346329, -0.04670720805143878, 0.028714211736213857, 0.07947683605559193, 0.0032309314950752, -0.07346363262381987, 0.0251016282791415, -0.10805120585153204, -0.06609862376940139, 0.06041171819826812, -0.007300914631793012, 0.09807581411200318, -0.10758506605061946, -0.14394397052179936, 0.021757075207593863, -0.05575032018914249, -0.22206900115474487, -0.0822736748610673, -0.11616203838741063, 0.09285504834178249, 0.007353355359395676, 0.05714873959188019, -0.01072121542098894, 0.030135938128997175, 0.15718234086771612, 0.09583834306762289, 0.029017202606807027, -0.04374722031564401, -0.022444631413939892, 0.07388315844464118, 0.03603260661054109, -0.26029246482957497, -0.12166248803817886, -0.010936805078911002, -0.10311012396185887, 0.043071317604320786, -0.15475841390297082, -0.10683924236915937, -0.06376792476483857, 0.015405920420160197, 0.07374331650436741, -0.1511225234558528, -0.03379513556616079, 0.021395816861886626, 0.05248734158275456, -0.02918035153712642, -0.003933054570199748, 0.39267616828874274, -0.0516949039212032, 0.029646491338038983, 0.009252875048114369, 0.03882944541601647, -0.043257773524685815, -0.09122355903858852, 0.03603260661054109, 0.09173631281959232, 0.07117954759934832, 0.1353669981850082, 0.002458887449813768, -0.09066419127749344, 0.0323967161634231, 0.1419861833579666, 0.026150442831194765, 0.09677062266944801, -0.20342340911824236, -0.14776631688928235, -0.028714211736213857, -0.09057096331731092, -0.009060592380237936, -0.04069400461966672, 0.0974232183907256, 0.24649472672256315, 0.14860536853092496, 0.05388576098549224, 0.10581373480715173, -0.0121779022988407, 0.019880862508920797, -0.15102929549567032, 0.05878022889507415, -0.09308811824223877, 0.0037873858824145714, -0.053373007204488426, 0.08115493933887716, -0.14702049320782226, -0.13042591629533504, -0.09695707858981303, -0.08670200296973665, -0.03556646680962853, -0.13415503470263554, 0.19913492294984678, -0.006374461777479294, -0.08064218555787334, 0.025870758950647228, -0.17685344046622628, 0.06833609481378168, -0.09388055590379013, -0.1115938683384675, 0.07108631963916581, -0.11289905978102266, -0.023738169361472255, -0.04927097695645787, 0.16827646812943511, 0.029739719298221497, 0.026663196612198584, -0.028015002034845016, 0.049737116757370435, -0.0966773947092655, -0.0491311350161841, 0.08646893306928038, -0.08670200296973665, -0.006490996727707435, -0.009322796018251254, 0.11495007490503795, 0.11849273739197341, 0.024752023428457077, 0.006986270266177032, -0.10823766177189705, 0.0338883635263433, -0.024775330418502703, -0.11672140614850568, -0.15140220733640036, 0.0019053464362300998, 0.021279281911658485, -0.06041171819826812, -0.12930718077314488, 0.2886337647250588, 0.22840850244715571, -0.0338883635263433, -0.030392315019499086, -0.08222706088097605, -0.14841891261055995, 0.1874814279270327, 0.11401779530321282, -0.03444773128743838, 0.07080663575861827, -0.0654460280481238, -0.06041171819826812, -0.020067318429285823, 0.2539529635371642, -0.09574511510744037, 0.05421205884613104, -0.034774029148077173, -0.07667999725011655, 0.13620604982665083, -0.042745019743682, -0.0024108167828446603, -0.008361382678869092, 0.07667999725011655, -0.10152524863875614, 0.08768089655165304, -0.10012682923601846, 0.040018101908343505, -0.08987175361594207, -0.09406701182415515, 0.0027691617547961926, -0.04064739063957546, -0.004212738450747285, -0.004568170048943114, 0.03698819320241185, -0.10758506605061946, -0.04470280690751476, 0.10916994137372218, -0.07686645317048157, 0.06572571192867133, -0.024938479348822103, -0.09467299356534148, 0.13993516823395133, 0.0021369596498085294, -0.1472069491281873, -0.031790734422236774, 0.010639640955829243, 0.081854149040246, -0.03493717807839657, -0.02437911158772703, 0.07798518869267174, -0.09033789341685465, 0.04097368850021426, 0.12389995908255916, 0.16007240763337402, -0.019356455232894164, -0.026919573502700495, -0.11522975878558549, -0.05411883088594852, -0.10842411769226208, 0.2811755279104578, -0.025451233129825918, 0.013389865781213362, -0.3669452512783693, -0.044889262827879785, -0.029273579497308935, 0.06931498839569807, -0.0180629172853618, -0.0945331516250677, 0.5448241993066033, -0.038596375515560194, -0.09835549799255072, 0.08730798471092299, 0.0030940029285571346, -0.08679523092991917, 0.085490039487364, -0.019239920282666023, -0.08106171137869465, -0.11299228774120518, -0.030392315019499086, 0.005791787026338591, 0.10376271968313644, -0.04218565198258692, -0.22803559060642564, 0.06814963889341666, 0.08232028884115856, -0.05733519551224521, -0.028504448825803205, 0.01627993254687125, 0.23903648990796214, -0.11877242127252097, 0.2550716990593543, 0.013145142385734266, -0.014392066353175371, 0.033142539844883204, -0.011810817205622055, 0.09593157102780539, -0.0454020166088836, 0.1613775990759292, 0.04402690419619154, -0.07052695187807073, -0.0219551846229817, -0.107864749931167, -0.1459017576856321, 0.06400099466529485, 0.10777152197098448, -0.04687035698175818, -0.07961667799586569, 0.020242120854628034, 0.1168146341086882, 0.15298708265950306, 0.01255081413957075, 0.28378591079556814, -0.21628886762342905, 0.12604420216675694, -0.09788935819163816, -0.1583010763899063, -0.13051914425551756, 0.03440111730734712, -0.163521842160127, 0.015452534400251454, 0.008920750439964167, -0.1620301947972068, -0.1294936366935099, -0.01424057091787879, -0.2060337920033527, -0.16175051091665926, -0.18981212693159552, 0.03172081345209989, 0.11560267062631553, -0.08255335874161485, -0.24183332871343752, 0.02106951900124783, -0.03405151245666271, 0.06637830764994893, -0.0881470363525656, -0.05672921377105888, -0.15084283957530528, 0.17601438882458365, 0.09835549799255072, 0.13135819589716016, -0.16156405499629423, 0.10292366804149383, -0.04710342688221446, 0.07602740152883897, 0.1546651859427883, -0.03813023571464763, 0.12306090744091654, 0.027222564373293658, 0.1280019893305897, 0.1742430575811159, 0.03773401688387195, -0.39528655117385314, -0.12856135709168479, -0.11271260386065765, -0.021815342682707933, -0.09141001495895354, 0.04607791932020682, 0.005313993730403214, -0.09863518187309826, 0.04519225369847295, 0.07117954759934832, 0.003000774968374622, 0.02911043056698954, 0.10348303580258891, 0.12371350316219412, -0.06689106143095273, -0.056775827751150136, 0.03465749419784903, -0.10301689600167635, 0.036638588351727425, -0.25115612473168875, -0.0026438866833009417, 0.14935119221238508, -0.07117954759934832, 0.1985755551887517, -0.1071189262497069, -0.0885665621733869, 0.11476361898467291, -0.061810137601005816, 0.100406513116566, 0.02280588975964713, -0.17442951350148095, 0.00677650735576638, 0.00677650735576638, -0.30877100412448155, 0.024635488478228936, 0.16398798196103956, 0.012480893169433864, 0.05812763317379656, 0.015289385469932054, 0.006211312847159898, 0.06041171819826812, 0.05313993730403214, -0.030135938128997175, -0.14935119221238508, 0.008518704861677082, 0.3074658126819263, 0.03265309305392502, -0.24985093328913358, -0.026127135841149136, 0.44562964967240987, 0.006572571192867133, -0.20696607160517783, 0.24724055040402326, 0.006228793089694118, -0.06637830764994893, -0.11522975878558549, 0.11196678017919755, 0.11718754594941826, -0.027199257383248035, 0.12706970972876458, -0.028807439696396372, -0.178624771709694, -0.025288084199506525, -0.0817609210800635, -0.07360347456409365, -0.08432468998508258, 0.06684444745086147, 0.01197979288345286, 0.013611282186646829, -0.09430008172461142, -0.03556646680962853, 0.29087123576943913, 0.08194737700042852, -0.12548483440566188, 0.0680097969531429, -0.0982622700323682, 0.10105910883784358, -0.1383502929108486, 0.14338460276070428, -0.026033907880966625, -0.05728858153215395, -0.10096588087766108, 0.09346103008296881, 0.05435190078640481, -0.1807690147938918, -0.1845913611613748, -0.02144243084197788, -0.12893426893241483, 0.20099948215349703, 0.17004779937290285, 0.029739719298221497, -0.1256712903260269, -0.05127537810038189, 0.04381714128578089, 0.07649354132975153, 0.1830064858382721, -0.010051139457177132, 0.2299001498100759, -0.013075221415597383, -0.1776924921078689, 0.1645473497221346, -0.1086105736126271, 0.015289385469932054, 0.027921774074662505, 0.05425867282622229, -0.23940940174869219, 0.08040911565741705, 0.057894563273340284, -0.044726113897560385, -0.027175950393202405, -0.29124414761016915, -0.12380673112237664, -0.09732999043054308, -0.06651814959022269, -0.09159647087931856, 0.10394917560350148, 0.11495007490503795, 0.09467299356534148, 0.0031988843837624614, -0.0739763864048237, 0.04090376753007738, 0.10693247032934189, 0.05435190078640481, -0.07490866600664882, -0.20528796832189258, 0.208271263047733, -0.18934598713068296, -0.10572050684696921, 0.04708011989216883, 0.230645973491536, 0.0064851699801960275, 0.041719512181674356, -0.013518054226464316, -0.23642610702285177, -0.0446561929274235, -0.0182260662156812, 0.046217761260480585, -0.06978112819661063, 0.10311012396185887, 0.0777055048121242, -0.08646893306928038, -0.020801488615723108, 0.04081053956989486, 0.0709930916789833, -0.10749183809043694, 0.020416923279970245, 0.012096327833681001, -0.15876721619081885, -0.04204581004231315, 0.11439070714394287, 0.05006341461800923, -0.12007761271507614, 0.03822346367483014, 0.032186953253012456, -0.06996758411697566, 0.09723676247036056, 0.05043632645873928, -0.03137120860141547, -0.04537870961883797, -0.03922566424679215, -0.01800464981024773, -0.1138313393828478, -0.046730515041484406, -0.15447873002242327, 0.0007494653986547296, -0.08404500610453505, 0.032140339272921196, -0.08320595446289243, -0.038270077654921394, 0.06782334103277786, -0.03141782258150672, -0.01461348275860884, -0.05216104372211577, -0.08446453192535636, 0.020591725705312456, -0.04833869735463275, 0.1570891129075336, -0.20696607160517783, 0.0918761547598661, 0.06045833217835938, 0.021221014436544415, -0.0788708543144056, 0.10944962525426971, 0.15960626783246146, -0.13023946037497, 0.06059817411863314, 0.049643888797187924, 0.06111092789963696, -0.18850693548904035, -0.057428423472427714, -0.07425607028537122, 0.04894467909581908, -0.033585372655750144, -0.03948204113729406, -0.17433628554129843, 0.07952345003568319, 0.01641977448714502, 0.08726137073083173, 0.17219204245710065, 0.1063731025682468, 0.06535280008794128, 0.0034086472941731146, -0.043141238574457674, -0.07351024660391113, -0.009713188101515524, 0.048385311334724006, 0.11373811142266528, 0.12986654853423996, 0.02845783484571195, -0.08763428257156178, -0.12082343639653624, 0.04852515327499777, 0.10105910883784358, -0.0031231366661141698, -0.11019544893572981, -0.008751774762133364, 0.10944962525426971, 0.05910652675571294, 0.04551855155911175, -0.007452410067089595, -0.026150442831194765, 0.13350243898135794, -0.07793857471258048, -0.08427807600499132, -0.021757075207593863, 0.045565165539203, -0.24444371159854783, 0.07346363262381987, 0.021104479486316274, 0.04053085568934733, 0.0027516815122619713, 0.08092186943842088, -0.13051914425551756, -0.16044531947410406, 0.056775827751150136, -0.005217852396464998, -0.15634328922607352, -0.06204320750146208, -0.0021923137511668965, -0.15680942902698608, 0.08301949854252741, -0.20547442424225762, 0.17237849837746566, -0.011047513281627735, 0.0016038122525147858, 0.0005214939022709295, 0.08595617928827655, 0.08371870824389625, 0.1397487123135863, 0.16557285728414226, 0.11094127261718992, 0.2202044419510946, -0.14524916196435453, -0.04875822317545406, 0.10161847659893866, -0.010808616633660048, -0.03281624198424441, 0.048059013474085206, 0.15019024385402768, 0.05127537810038189, -0.01659457691248723, -0.05309332332394089, 0.010820270128682861, -0.01618670458668874, -0.00434966701726535, -0.08754105461137927, -0.041533056261309334, 0.14552884584490205, -0.1269764817685821, 0.054864654567408626, 0.02430919061759014, -0.1466475813670922, -0.0974232183907256, -0.031860655392373656, 0.06973451421651937, 0.18412522136046225, -0.10245752824058128, -0.13648573370719835, -0.01573221828079899, -0.1130855157013877, -0.03057877093986411, -0.06875562063460298, 0.02696618748279175, -0.10450854336459654, -0.1785315437495115, 0.09430008172461142, -0.09262197844132619, 0.11187355221901503, -0.04255856382331697, -0.08572310938782028, 0.11895887719288599, 0.057941177253431536, 0.07970990595604821, 0.026733117582335472, -0.01404246150249095, 0.04591477038988742, -0.10534759500623916, 0.07523496386728762, -0.08875301809375193, -0.14086744783577643, -0.041230065390716164, 0.018901968927004416, 0.1882272516084928, 0.059898964417264305, 0.0098588567893007, 0.041882661111993756, 0.1332227551008104, 0.17396337370056839, 0.04712673387226009, 0.0361258345707236, 0.02113943997138472, -0.004675964877904144, 0.1769466684264088, 0.10851734565244459, 0.22430647219912514, 0.13294307122026286, -0.20267758543678227, -0.016955835258194465, -0.08693507287019293, -0.001994204335779057, -0.04134660034094431, -0.036195755540860484, 0.037967086784328224, 0.06199659352137084, 0.08674861694982791, -0.055890162129416256, 0.12287445152055153, -0.10273721212112881, -0.009520905433639093, 0.09276182038159997, 0.05397898894567476, 0.1382570649506661, 0.07849794247367556, -0.10823766177189705, -0.05728858153215395, -0.0325598650937425, 0.010255075620076378, 0.010971765563979443, 0.0825999727217061, 0.1130855157013877, 0.005768480036292963, -0.01510292954956703, 0.2067796156848128, 0.004827460313200727, -0.04141652131108119, 0.030485542979681597, -0.03603260661054109, 0.16380152604067452, 0.12557806236584437, -0.03085845482041165, 0.2269168550842355, 0.11942501699379855, -0.14329137480052176, -0.08465098784572138, 0.11196678017919755, -0.12492546664456679, -0.04458627195728662, 0.163521842160127, 0.038666296485697076, 0.06978112819661063, -0.09043112137703715, 0.011455385607426228, 0.0373611050431419, 0.028970588626715768, 0.04843192531481526, -0.01355301471153276, -0.017130637683536676, -0.24146041687270745, -0.005765566662537259, -0.08917254391457324, -0.027362406313567428, -0.0251016282791415, -0.03022916608917969, 0.012690656079844518, 0.013657896166738084, 0.037990393774373854, -0.12921395281296236, -0.011105780756741805, 0.0025637689050190945, 0.0640476086453861, 0.023854704311700392, 0.20938999856992316, -0.06950144431606309, 0.1770398963865913, -0.0524407276026633, 0.05770810735297526, -0.03370190760597828, -0.03948204113729406, 0.0840916200846263, 0.12483223868438427, -0.02773531815429748, -0.009736495091561152, -0.06633169366985767, -0.11206000813938007, 0.17498888126257603, -0.051135536160108123, 0.008308941951266429, 0.22673039916387047, 0.08199399098051978, -0.0848374437660864, -0.18915953121031792, 0.021127786476361904, 0.019752674063669845, 0.005191632032663667, 0.0357063087499023, -0.06968790023642811, 0.005177065163885149, 0.06707751735131777, -0.13713832942847592, 0.04083384655994049, 0.11728077390960077, 0.0017086937077201124, 0.017620084474494868, 0.008122486030901403, 0.025754224000419088, 0.10721215420988942, -0.043653992355461496, -0.20547442424225762, 0.009334449513274067, -0.14422365440234688, 0.08469760182581264, 0.059059912775621684, 0.05127537810038189, -0.10916994137372218, 0.030905068800502908, -0.046357603200754355, 0.04216234499254129, 0.17750603618750385, 0.08059557157778208, 0.025008400318958984, -0.20099948215349703, 0.03127798064123296, -0.06306871506346973, -0.06698428939113525, -0.14972410405311512, 0.06502650222730248, -0.059759122476990535, 0.05365269108503597, 0.006613358425446983, -0.13620604982665083, 0.004984782496008717, -0.14879182445129, -0.12557806236584437, 0.04255856382331697, 0.12063698047617122, -0.049737116757370435, 0.1881340236483103, -0.02289911771982964, 0.04437650904687596, 0.01962448561841889, -0.0009963738244506027, -0.03274632101410753, 0.022572819859190848, -0.2023046735960522, 0.0640476086453861, -0.0833457964031662, 0.036801737282046824, -0.0032425849900980137, 0.05864038695480039, 0.14832568465037743, -0.08651554704937163, 0.026919573502700495, -0.12296767948073402, 0.04885145113563657, 0.0454020166088836, 0.0848374437660864, 0.009870510284323515, 0.13145142385734265, 0.032000497332647426, 0.23176470901372614, 0.06577232590876259, 0.033282381785156974, -0.094766221525524, 0.03097498977063979, 0.01510292954956703, -0.1294004087333274, 0.12725616564912962, -0.0933678021227863, -0.1472069491281873, -0.01384435208710311, 0.07658676928993405, 0.12641711400748698, 0.016815993317920698, -0.013657896166738084, 0.09416023978433766, -0.12371350316219412, -0.12744262156949462, -0.04682374300166692, 0.07723936501121163, 0.24761346224475328, 0.04612453330029807, -0.05561047824886872, -0.014695057223768538, 0.010610507218272208, -0.15280062673913805, -0.01636150701203095, 0.12026406863544117, 0.20006720255167187, -0.007621385744920399, 0.08064218555787334, 0.15447873002242327, 0.014893166639156378, 0.11243291998011012, 0.0717389153604434, -0.03843322658524079, -0.02376147635151788, 0.09075741923767594, 0.027292485343430546, -0.018132838255498687, -0.13368889490172295, 0.051088922180016864, 0.011263102939549796, 0.024868558378685218, -0.10105910883784358, 0.045122332728336066, 0.009759802081606782, 0.026872959522609235, 0.024821944398593962, -0.24556244712073802, -0.026616582632107328, 0.03211703228287557, 0.007516504289715073, 0.04437650904687596, -0.1845913611613748, 0.005634464843530602, -0.08735459869101425, -0.04561177951929426, -0.0740696143650062, 0.12278122356036901, 0.08595617928827655, -0.09434669570470268, -0.11877242127252097, 0.02622036380133165, 0.26569968652016074, 0.02011393240937708, 0.1458085297254496, -0.09770290227127314, -0.052906867403575863, 0.12744262156949462, -0.004588563665233038, -0.1220353998789089, 0.23679901886358184, 0.004469115341249194, -0.10534759500623916, 0.07891746829449686, -0.09462637958525022, -0.12362027520201163, 0.08530358356699896, 0.08390516416426128, -0.02983294725840401, -0.006718239880652309, 0.08949884177521203, 0.05733519551224521, 0.035543159819582906, 0.13648573370719835, -0.06861577869432922, -0.028527755815848835, -0.06418745058565987, 0.09891486575364579, 0.17750603618750385, 0.025311391189552154, 0.057614879392792744, -0.059432824616351736, -0.07267119496226852, -0.24220624055416753, 0.03561308078971979, -0.07015404003734069, 0.14235909519869663, -0.014543561788471954, 0.07383654446454993, -0.05854715899461787, 0.055330794368321196, 0.18356585359936717, 0.054445128746587315, -0.015487494885319895, 0.14841891261055995, -0.08959206973539455, -0.028970588626715768, -0.04847853929490652, 0.09406701182415515, 0.1063731025682468, -0.025497847109917177, 0.051788131881385716, 0.0323967161634231, -0.012842151515141101, -0.17265818225801322, 0.045029104768153555, 0.05649614387060259, 0.10152524863875614, 0.0370348071825031, 0.2774464095031573, 0.014077421987559392, 0.06894207655496802, -0.0361258345707236, 0.033608679645795766, 0.013960887037331253, -0.07807841665285425, 0.11961147291416357, 0.046567366111165014, -0.12408641500292417, -0.023400218005810644, 0.08222706088097605, 0.07020065401743193, -0.1970839078258315, 0.04104360947035114, 0.14329137480052176, -0.04726657581253385, -0.031114831710913556, -0.07849794247367556, -0.08646893306928038, -0.0546781986470436, -0.06894207655496802, -0.06572571192867133, -0.07434929824555374, 0.22934078204898084, -0.050949080239743094, -0.06358146884447355, 0.18701528812612014, 0.05421205884613104, 0.06250934730237466, -0.12772230545004215, -0.09565188714725786, -0.22952723796934582, -0.1281884452509547, -0.1333159830609929, 0.11028867689591233, 0.1681832401692526, 0.02034700230983336, 0.0546781986470436, -0.06236950536210089, -0.016151744101620295, 0.06376792476483857, -0.02287581072978401, -0.0457283144695224, -0.059898964417264305, 0.035077020018670343, 0.06353485486438229, -0.037011500192457476, 0.1414268155968715, -0.0721584411812647, 0.2164753235437941, 0.043420922455005215, -0.009911297516903363, -0.04239541489299758, 0.049550660837005406, -0.08670200296973665, 0.1348076304239131, -0.16864937997016516, -0.21610241170306407, 0.016524655942350346, 0.1657593132045073, -0.06199659352137084, -0.08968529769557705, 0.08656216102946289, 0.06810302491332541, -0.050203256558283, -0.10609341868769927, -0.00811083253587859, -0.06982774217670189, 0.01215459530879507, 0.2932951627341844, -0.03426127536707335, -0.001555741585545678, -0.16314893031939692, -0.17396337370056839, -0.007510677542203666, -0.04936420491664038, 0.06106431391954571, -0.17275141021819573, 0.08031588769723455, -0.041812740141856874, 0.07775211879221545, 0.07523496386728762, -0.043490843425142096, 0.0647002043666637, 0.07159907342016962, -0.08264658670179736, 0.290311868008344, 0.08712152879055796, -0.09732999043054308, 0.05160167596102069, 0.14245232315887915, -0.10627987460806428, -0.06484004630693746, 0.07080663575861827, -0.076213857449204, 0.041486442281218075, 0.08353225232353123, -0.03731449106305064, -0.12977332057405744, -0.047383110762762, 0.0714126174998046, 0.0053081669828918075, -0.024658795468274566, -0.00657839794037854, -0.15065638365494027, 0.24201978463380255, -0.10544082296642168, 0.06866239267442048, 0.08712152879055796, 0.02264274082932773, -0.021454084337000696, 0.041556363251354964, -0.08572310938782028, -0.06796318297305164, 0.044865955837834155, 0.19988074663130687, 0.07831148655331054, 0.11112772853755493, -0.06311532904356099, 0.07420945630527997, 0.12613743012693945, 0.07085324973870953, -0.1696748875321728, 0.12856135709168479, 0.07737920695148541, -0.06600539580921887, -0.02456556750809205, -0.08754105461137927, -0.15802139250935876, -0.085490039487364, 0.033328995765248226, -0.22971369388971086, -0.18384553747991472, 0.06572571192867133, 0.009048938885215121, 0.01799299631522492, -0.07197198526089968, 0.05710212561178893, 0.07630708540938651, -0.06330178496392601, 0.10152524863875614, 0.23549382742102665, 0.04008802287848039, 0.019822595033806727, 0.05435190078640481, -0.14925796425220256, 0.074395912225645, -0.12557806236584437, -0.03468080118789466, 0.00396801505526819, -0.019193306302574768, -0.027548862233932454, 0.06670460551058771, -0.17536179310330607, -0.07877762635422308, 0.03423796837702773, 0.0884733342132044, 0.08903270197429947, -0.053279779244305915, -0.11485684694485543, 0.07369670252427615, 0.01547584139029708, -0.046916970961849436, -0.1608182313148341, 0.15121575141603533, -0.00355431598195829, 0.08786735247201806, 0.09770290227127314, 0.04421336011655657, 0.08735459869101425, -0.05696228367151516, 0.015009701589384517, 0.020987944536088134, 0.16249633459811935, 0.0847442158059039, 0.023936278776860092, -0.10049974107674851, -0.12259476764000397, -0.13816383699048357, -0.011024206291582107, 0.018587324561388435, 0.03605591360058672, 0.05509772446786491, 0.008827522479781654, -0.10245752824058128, 0.09383394192369887, -0.09919454963419333, 0.11737400186978326, 0.07812503063294551, -0.04356076439527898, -0.07453575416591877, 0.08600279326836781, -0.07616724346911274, -0.01781819388988271, -0.07057356585816198, -0.07201859924099092, -0.11252614794029261, 0.007260127399213164, 0.21442430841977883, 0.03773401688387195, -0.07807841665285425, -0.2216960893140148, 0.2770734976624272, -0.05812763317379656, -0.0046992718679497725, -0.10012682923601846, 0.06982774217670189, -0.163521842160127, -0.05626307397014631, 0.03950534812733969, 0.05458497068686109, 0.03931889220697466, 0.05379253302530973, -0.08199399098051978, 0.009987045234551656, -0.15447873002242327, 0.08204060496061102, -0.052580569542937064, 0.074395912225645, 0.11038190485609484, -0.06167029566073204, -0.012131288318749442, -0.049643888797187924, 0.03861968250560582, 0.024122734697225118, -0.015301038964954869, 0.08320595446289243, -0.05043632645873928, 0.14552884584490205, -0.14329137480052176, 0.009101379612817786, -0.07700629511075535, 0.09574511510744037, 0.10777152197098448, 0.07980313391623073, 0.05575032018914249, -0.03668520233181868, -0.029273579497308935, -0.04645083116093687, 0.048385311334724006, -0.04008802287848039, -0.04344422944505084, -0.14161327151723654, 0.05085585227956059, 0.14049453599504638, 0.06600539580921887, -0.2164753235437941, -0.18729497200666767, -0.04020455782870853, 0.1360195939062858, -0.0010750349158545976, 0.16100468723519915, 0.03022916608917969, 0.043281080514731445, 0.11662817818832316, 0.019076771352346627, -0.19689745190546648, -0.02622036380133165, 0.08012943177686953, -0.09416023978433766, 0.17331077797929081, -0.44264635494656956, -0.08660877500955415, -0.09891486575364579, 0.11317874366157021, -0.17508210922275855, 0.09425346774452018, 0.010429878045418589, 0.0591531407358042, -0.017445282049152657, -0.0885665621733869, -0.03025247307922532, -0.223187736676935, -0.04081053956989486, 0.16874260793034768, 0.08698168685028419, 0.045005797778107925, -0.17610761678476616, 0.07295087884281605, 0.081854149040246, -0.09751644635090811, -0.07444252620573626, -0.011682628760371102, -0.04363068536541587, 0.013646242671715273, -0.1355534541053732, 0.006520130465264471, -0.14403719848198185, 0.1360195939062858, -0.016699458367692557, 0.008606106074348188, -0.20193176175532215, -0.03274632101410753, -0.06153045372045827, -0.008384689668914721, -0.07924376615513566, 0.10124556475820862, 0.05999219237744681, 0.04363068536541587, -0.15895367211118386, 0.019135038827460697, -0.03279293499419878, -0.07122616157943958, -0.11522975878558549, -0.10506791112569164, 0.16277601847866688, 0.19316833349816598, 0.07127277555953083, -0.014403719848198186, -0.08469760182581264, 0.06167029566073204, -0.03449434526752964, -0.019263227272711653, 0.028714211736213857, -0.09611802694817041, -0.061810137601005816, -0.13490085838409563, 0.09854195391291574, -0.1511225234558528, 0.057941177253431536, 0.06167029566073204, -0.1614708270361117, -0.009206261068023113, 0.07835810053340178, -0.1033898078424064, -0.17992996315224918, 0.09523236132643655, -0.09052434933721967, -0.09658416674908299, -0.0392722782268834, -0.006077297654397535, 0.11644172226795815, 0.05225427168229827, -0.19447352494072112, -0.0524407276026633, 0.0265932756420617, -0.20640670384408277, -0.07602740152883897, 0.072577967002086, 0.1011523367980261, 0.13368889490172295, 0.05332639322439717, 0.04281494071381888, -0.22150963339364976, -0.008646893306928038, 0.0062987140598310025, 0.009788935819163817, 0.07337040466363735, -0.029902868228540894, 0.2366125629432168, 0.0021690067611212682, 0.042022503052267526, -0.2951597219378347, -0.12389995908255916, 0.09043112137703715, -0.044889262827879785, -0.09052434933721967, -0.018727166501662205, 0.02496178633886773, -0.14403719848198185, 0.01123396920199276, 0.07430268426546248, -0.0364521324313624, 0.09555865918707535, -0.06703090337122651, 0.0606447880987244, -0.051741517901294456, -0.02885405367648763, -0.057801335313157766, 0.008343902436334871, 0.016140090606597483, -0.0006048892260279426, -0.06516634416757626, 0.1858033246437475, -0.022631087334304918, 0.10394917560350148, -0.023575020431152855, -0.15569069350479592, -0.09019805147658087, 0.01565064381563929, 0.21386494065868378, 0.1256712903260269, 0.024425725567818284, -0.0591531407358042, -0.014333798878061303, 0.12585774624639193, 0.04782594357362893, 0.05001680063791797, 0.053373007204488426, -0.11429747918376038, -0.18011641907261422, 0.012026406863544116, 0.21293266105685862, -0.152427714898408, 0.10833088973207956, 0.036498746411453654, -0.21535658802160396, 0.072577967002086]
    image_embedding_tensor = torch.tensor(image_embedding_list)
    normalized_tensor = torch.nn.functional.normalize(image_embedding_tensor, p=2, dim=0)
    image_embedding_tensor = torch.unsqueeze(image_embedding_tensor, 0)
    negative_image_embedding = None
    prompt_generation_policy = "top-k"

    # Generate img2img generation jobs with Kandinsky using the embeddings
    response = generate_img2img_generation_jobs_with_kandinsky(
        image_embedding=image_embedding_tensor,
        negative_image_embedding = None,  
        dataset_name="test-generations",
        prompt_generation_policy=prompt_generation_policy
    )

    print(response)