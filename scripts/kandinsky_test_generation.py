import io
import sys
import os
import uuid
import torch


base_directory = os.getcwd()
sys.path.insert(0, base_directory)

from utility.http import generation_request
from utility.http import request
from utility.minio.cmd import connect_to_minio_client, upload_data
from worker.generation_task.generation_task import GenerationTask
from kandinsky_worker.dataloaders.image_embedding import ImageEmbedding

def read_msgpack_file(file_path):
    """Reads a msgpack file and returns its bytes."""
    with open(file_path, "rb") as f:
        return f.read()

def generate_img2img_generation_jobs_with_kandinsky(image_embedding,
                                                    negative_image_embedding,
                                                    dataset_name,
                                                    prompt_generation_policy,
                                                    self_training= False,
                                                    init_img_path="./test/test_inpainting/white_512x512.jpg"):

    # get sequential ids
    sequential_ids = request.http_get_sequential_id(dataset_name, 1)

    count = 0
    # generate UUID
    task_uuid = str(uuid.uuid4())
    task_type = "img2img_generation_kandinsky"
    model_name = "kandinsky_2_2"
    model_file_name = "kandinsky-2-2-decoder"
    model_file_path = "input/model/kandinsky/kandinsky-2-2-decoder"
    task_input_dict = {
        "strength": 0.75,
        "seed": "",
        "dataset": dataset_name,
        "file_path": sequential_ids[count]+".jpg",
        "init_img": init_img_path,
        "num_images": 1,
        "image_width": 512,
        "image_height": 512,
        "decoder_steps": 100,
        "decoder_guidance_scale": 12,
        "self_training": self_training
    }

    prompt_generation_data={
        "prompt_generation_policy": prompt_generation_policy
    }

    image_embedding= image_embedding.detach().cpu().numpy().tolist()[0]
    negative_image_embedding= image_embedding.detach().cpu().numpy().tolist()[0] if negative_image_embedding is not None else None

    # create the job
    generation_task = GenerationTask(uuid=task_uuid,
                                     task_type=task_type,
                                     model_name=model_name,
                                     model_file_name=model_file_name,
                                     model_file_path=model_file_path,
                                     task_input_dict=task_input_dict,
                                     prompt_generation_data=prompt_generation_data)
    generation_task_json = generation_task.to_dict()

    # add job
    response = generation_request.http_add_kandinsky_job(job=generation_task_json,
                                                         positive_embedding=image_embedding,
                                                         negative_embedding=negative_image_embedding)

    return response


if __name__ == "__main__":
    image_embedding_list = [-0.1486480254781752, 0.04444909329997188, -0.1743772121768128, -0.07838426645398888, 0.053680828062273735, 0.07851248499235419, -0.0410085625205029, 0.04143595764838725, -0.19010535288295666, -0.07146046538226249, -0.07428127322629917, -0.1714709253071992, 0.04047431861064747, 0.03363599656449795, 0.092659263725326, 0.09060776711148115, -0.04282499181401137, 0.026327539877675655, 0.07287086930428081, 0.0029623824801483668, -0.06735747215457277, 0.02301522763657198, -0.09907019064359118, -0.060604629134000124, 0.05539040857381111, -0.006694076190488553, 0.08992393490686619, -0.09864279551570683, -0.13197961549068574, 0.019948667594001806, -0.051116457294967665, -0.20361103892410198, -0.0754352400715869, -0.10650686586877878, 0.08513710947456153, 0.0067421581423755435, 0.052398642678620704, -0.009830087941339936, 0.027631095017722908, 0.14411763712260114, 0.08787243829302133, 0.026605346710800476, -0.04011103275194578, -0.020579075407631212, 0.06774212776966869, 0.03303764338545987, -0.23865743941061823, -0.11155012837781404, -0.010027758187986445, -0.09453980228801712, 0.03949130981651348, -0.14189518245760255, -0.09795896331109188, -0.0584676534945784, 0.014125408976577603, 0.06761390923130338, -0.13856150046010465, -0.030986146771615014, 0.01961743636989144, 0.04812469139977725, -0.02675493500556, -0.003606146391524161, 0.36003765572977225, -0.04739811968237387, 0.027182330133444343, 0.00848379328850425, 0.03560201415276594, -0.03966226786766722, -0.08364122652696632, 0.03303764338545987, 0.0841113611676391, 0.06526323602793949, 0.12411554513761379, 0.00225450929958992, -0.0831283523735051, 0.029703961387961976, 0.13018455595357148, 0.023976866674311755, 0.08872722854879002, -0.18651523380872817, -0.13548425553933738, -0.026327539877675655, -0.08304287334792824, -0.008307492798251956, -0.03731159466430332, 0.08932558172782812, 0.22600654362524164, 0.13625356676952918, 0.04940687678343028, 0.09701869402974632, -0.011165697715978515, 0.018228402204267313, -0.13847602143452778, 0.05389452562621591, -0.0853508070385037, 0.0034725854140603032, -0.048936742142757506, 0.07440949176466446, -0.13480042333472242, -0.11958515678203974, -0.08889818659994377, -0.07949549378648818, -0.032610248257575525, -0.1230043178051145, 0.1825831986321922, -0.005844628373818418, -0.07393935712399169, 0.02372042959758115, -0.1621537115193205, 0.06265612574784499, -0.0860773787559071, -0.10231839361551219, 0.06517775700236261, -0.10351509997358838, -0.02176509688751027, -0.04517566501737527, 0.15428964116624855, 0.027267809159021213, 0.024447001314984534, -0.025686447185849132, 0.04560306014525961, -0.08864174952321316, -0.04504744647900996, 0.079281796222546, -0.07949549378648818, -0.005951477155789505, -0.0085479025576869, 0.10539563853627948, 0.1086438415082005, 0.02269468129065872, 0.006405584479166621, -0.09924114869474492, 0.031071625797191884, -0.02271605104705294, -0.10701974002224, -0.13881793753683525, 0.0017469775852272604, 0.01951058758792035, -0.05539040857381111, -0.11855940847511731, 0.2646430631859864, 0.20942361266332907, -0.031071625797191884, -0.027866162338059292, -0.07539250055879847, -0.13608260871837546, 0.17189832043508357, 0.10454084828051079, -0.03158449995065309, 0.064921319925632, -0.060006275954962045, -0.05539040857381111, -0.018399360255421052, 0.23284486567139118, -0.08778695926744447, 0.049706053372949324, -0.031883676540172136, -0.07030649853697475, 0.12488485636780562, -0.03919213322699444, -0.0022104341770268466, -0.007666400106425439, 0.07030649853697475, -0.09308665885321034, 0.0803930235550453, -0.09180447346955731, 0.03669187172887102, -0.08240178065610172, -0.08624833680706083, 0.002538994181587937, -0.03726885515151489, -0.0038625834682547676, -0.004188472253266581, 0.03391380339762278, -0.09864279551570683, -0.04098719276410869, 0.10009593895051361, -0.0704774565881285, 0.06026271303169265, -0.02286563934181246, -0.08680395047331046, 0.12830401739088038, 0.001959339539394794, -0.13497138138587614, -0.029148347721712334, 0.009755293793960175, 0.07505058445649099, -0.03203326483493166, -0.022352765188351244, 0.07150320489505092, -0.08282917578398608, 0.03756803174103393, 0.11360162499165889, 0.14676748691548408, -0.017747582685397428, -0.024682068635320922, -0.1056520756130101, -0.04962057434737246, -0.09941210674589865, 0.2578047411398369, -0.023335773982485236, 0.012276925048477811, -0.3364454446705564, -0.041158150815262425, -0.026840414031136867, 0.0635536555164021, -0.01656156120551837, -0.08667573193494517, 0.4995394254712225, -0.035388316588823764, -0.0901803719835968, 0.08005110745273782, 0.00283683516133234, -0.07958097281206505, 0.07838426645398888, -0.01764073390342634, -0.0743240127390876, -0.10360057899916525, -0.027866162338059292, 0.005310384463962987, 0.0951381554670552, -0.03867925907353323, -0.20908169656102157, 0.06248516769669124, 0.07547797958437533, -0.052569600729774436, -0.026135212070127697, 0.014926774841360749, 0.21916822157909213, -0.1089002785849311, 0.2338706139783136, 0.01205254260633853, -0.013195824573429153, 0.030387793592576928, -0.010829124052769592, 0.0879579173185982, -0.04162828545593521, 0.14796419327356022, 0.04036746982867639, -0.0646648828489014, -0.02013031052335265, -0.09889923259243744, -0.1337746750278, 0.05868135105852057, 0.09881375356686056, -0.04297458010877089, -0.07299908784264612, 0.018559633428377683, 0.10710521904781685, 0.14027108097164204, 0.01150761381828599, 0.26019815385598927, -0.19831133933833608, 0.1155676425799269, -0.08975297685571246, -0.14514338542952357, -0.11967063580761661, 0.03154176043786466, -0.14993021086182823, 0.014168148489366037, 0.008179274259886652, -0.14856254645259834, -0.11873036652627106, -0.013056921156866741, -0.18890864652488049, -0.14830610937586772, -0.1740352960745053, 0.02908423845252968, 0.10599399171531756, -0.07569167714831751, -0.2217325923463982, 0.019318259780372396, -0.031221214091951405, 0.06086106621073073, -0.08082041868292965, -0.052013987063524794, -0.13830506338337406, 0.16138440028912868, 0.0901803719835968, 0.12043994703780843, -0.14813515132471397, 0.09436884423686338, -0.04318827767271306, 0.06970814535793667, 0.14180970343202567, -0.034960921460939424, 0.11283231376146707, 0.024959875468445747, 0.11736270211704114, 0.15976029880316817, 0.03459763560223773, -0.3624310684459246, -0.11787557627050237, -0.10334414192243463, -0.020002091984987348, -0.08381218457812006, 0.042248008391367504, 0.004872304457881533, -0.09043680906032742, 0.04143595764838725, 0.06526323602793949, 0.002751356135755471, 0.026690825736377346, 0.0948817183903246, 0.11343066694050517, -0.06133120085140351, -0.05205672657631322, 0.03177682775820105, -0.09445432326244024, 0.03359325705170952, -0.2302804949040851, -0.0024241317409690196, 0.13693739897414414, -0.06526323602793949, 0.18207032447873098, -0.09821540038782249, -0.08120507429802555, 0.10522468048512575, -0.05667259395746415, 0.09206091054628791, 0.02091030663174158, -0.1599312568543219, 0.0062132566716186655, 0.0062132566716186655, -0.2831065327105901, 0.022587832508687636, 0.1503576059897126, 0.01144350454910334, 0.053296172447177825, 0.014018560194606518, 0.005695040079058897, 0.05539040857381111, 0.04872304457881533, -0.027631095017722908, -0.13693739897414414, 0.007810645962086405, 0.281909826352514, 0.029939028708298367, -0.22908378854600892, -0.02395549691791754, 0.40858974225743383, 0.006026271303169265, -0.1897634367806492, 0.2266903758298566, 0.0057110673963545605, -0.06086106621073073, -0.1056520756130101, 0.10266030971781968, 0.10744713515012434, -0.024938505712051532, 0.11650791186127246, -0.026413018903252525, -0.16377781300528102, -0.023186185687725718, -0.07496510543091411, -0.06748569069293807, -0.07731577863427802, 0.061288461338615076, 0.010984054786627666, 0.012479937734222873, -0.086462034371003, -0.032610248257575525, 0.2666945597998313, 0.07513606348206786, -0.11505476842646567, 0.06235694915832594, -0.09009489295801992, 0.092659263725326, -0.1268508739560736, 0.13146674133722452, -0.023870017892340667, -0.052526861216986, -0.09257378469974914, 0.08569272314081117, 0.04983427191131463, -0.165743830593549, -0.1692484706422006, -0.019660175882679872, -0.11821749237280983, 0.18429277914372957, 0.15591374265220906, 0.027267809159021213, -0.11522572647761942, -0.04701346406727795, 0.04017514202112843, 0.07013554048582102, 0.16779532720739387, -0.00921570744500619, 0.21079127707255896, -0.011988433337155878, -0.16292302274951231, 0.1508704801431738, -0.0995830647970524, 0.014018560194606518, 0.025600968160272266, 0.04974879288573776, -0.2195101376813996, 0.07372565956004952, 0.053082474883235656, -0.0410085625205029, -0.024917135955657314, -0.2670364759021388, -0.11351614596608205, -0.08924010270225124, -0.06098928474909603, -0.0839831426292738, 0.09530911351820893, 0.10539563853627948, 0.08680395047331046, 0.002932999065106318, -0.06782760679524556, 0.037503922471851275, 0.09804444233666876, 0.04983427191131463, -0.06868239705101424, -0.18822481432026555, 0.19096014313872534, -0.17360790094662093, -0.09693321500416946, 0.04316690791631885, 0.21147510927717394, 0.00594613471669095, 0.03825186394564888, -0.012394458708646005, -0.21677480886293976, -0.040944453251320255, -0.01671114950027789, 0.04237622692973281, -0.06398105064428644, 0.09453980228801712, 0.07124676781832032, -0.079281796222546, -0.0190725075818389, 0.0374184434462744, 0.06509227797678574, -0.09855731649012996, 0.01871990660133431, 0.011090903568598752, -0.1455707805574079, -0.03855104053516792, 0.10488276438281828, 0.045902236734778654, -0.11009698494300729, 0.03504640048651629, 0.02951163358041402, -0.06415200869544019, 0.08915462367667437, 0.04624415283708613, -0.028763692106616418, -0.04160691569954099, -0.03596530001146763, -0.016508136814532826, -0.10436989022935705, -0.04284636157040558, -0.14163874538087193, 0.0006871712290515484, -0.0770593415575474, 0.02946889406762559, -0.0762900303273556, -0.03508913999930473, 0.062185991107172205, -0.028806431619404854, -0.013398837259174215, -0.04782551481025821, -0.07744399717264332, 0.01888017977429094, -0.04432087476160658, 0.14403215809702427, -0.1897634367806492, 0.0842395797060044, 0.05543314808659955, 0.01945716319693481, -0.07231525563803118, 0.10035237602724421, 0.14634009178759974, -0.11941419873088599, 0.05556136662496485, 0.045517581119682744, 0.056031501265637634, -0.17283858971642913, -0.05265507975535131, -0.06808404387197617, 0.04487648842785623, -0.030793818964067056, -0.036200367331804026, -0.15984577782874504, 0.07291360881706925, 0.015054993379726054, 0.08000836793994939, 0.15787976024047706, 0.09753156818320753, 0.05992079692938517, 0.003125326872654273, -0.03955541908569613, -0.06740021166736121, -0.00890584597729004, 0.04436361427439501, 0.10428441120378018, 0.11907228262857852, 0.026092472557339264, -0.08035028404225686, -0.11078081714762222, 0.04449183281276031, 0.092659263725326, -0.0028635473568251117, -0.10103620823185916, -0.008024343526028576, 0.10035237602724421, 0.05419370221573494, 0.04173513423790629, -0.006832979607050965, -0.023976866674311755, 0.1224059646260764, -0.07146046538226249, -0.07727303912148958, -0.019948667594001806, 0.04177787375069472, -0.22412600506255054, 0.06735747215457277, 0.019350314414963724, 0.0371620063695438, 0.0025229668642922742, 0.0741957942007223, -0.11967063580761661, -0.14710940301779155, 0.05205672657631322, -0.004784154212755388, -0.1433483258924093, -0.05688629152140632, -0.00201009271083106, -0.14377572102029365, 0.07611907227620185, -0.18839577237141927, 0.15805071829163078, -0.010129264530858977, 0.0014705063618770746, 0.00047814829932061096, 0.07881166158187322, 0.07676016496802837, 0.12813305933972663, 0.15181074942451936, 0.10172004043647412, 0.2019014584125646, -0.1331763218487619, -0.04470553037670249, 0.09317213787878721, -0.00991022452781825, -0.03008861700305789, 0.04406443768487597, 0.13770671020433597, 0.04701346406727795, -0.015215266552682682, -0.0486803050660269, 0.009920909406015359, -0.014841295815783882, -0.003988130787070794, -0.08026480501667999, -0.03808090589449514, 0.13343275892549253, -0.11642243283569559, 0.0503044065519874, 0.022288655919168593, -0.13445850723241493, -0.08932558172782812, -0.029212456990894982, 0.06393831113149802, 0.16882107551431627, -0.09394144910897903, -0.12514129344453623, -0.014424585566096644, -0.1036860580247421, -0.028037120389213036, -0.06304078136294089, 0.02472480814810936, -0.09582198767167016, -0.16369233397970415, 0.086462034371003, -0.08492341191061936, 0.10257483069224281, -0.0390211751758407, -0.07859796401793105, 0.10907123663608485, 0.05312521439602408, 0.073084566868223, 0.02451111058416719, -0.012875278227515894, 0.04209842009660798, -0.09659129890186197, 0.06898157364053328, -0.08137603234917928, -0.12915880764664908, -0.03780309906137032, 0.01733087243571019, 0.17258215263969853, 0.054920273933138336, 0.009039406954753897, 0.0384014522404084, 0.12214952754934581, 0.15950386172643757, 0.04320964742910728, 0.03312312241103674, 0.019382369049555048, -0.0042873073765898355, 0.16223919054489738, 0.09949758577147552, 0.2056625355379468, 0.12189309047261519, -0.1858314016041132, -0.015546497776793051, -0.07970919135043035, -0.0018284497814802137, -0.0379099478433414, -0.033187231680219385, 0.034811333166179896, 0.05684355200861788, 0.07953823329927662, -0.05124467583333297, 0.11266135571031335, -0.09419788618570964, -0.008729545487037747, 0.08505163044898466, 0.049492355809007155, 0.12676539493049674, 0.0719733395357237, -0.09924114869474492, -0.052526861216986, -0.029853549682721497, 0.009402692813455592, 0.010059812822577771, 0.07573441666110593, 0.1036860580247421, 0.005289014707568769, -0.013847602143452778, 0.18959247872949547, 0.004426210793152248, -0.03797405711252405, 0.027951641363636166, -0.03303764338545987, 0.15018664793855885, 0.11514024745204254, -0.02829355746594364, 0.20805594825409918, 0.10949863176396919, -0.13138126231164768, -0.07761495522379706, 0.10266030971781968, -0.11454189427300446, -0.04088034398213761, 0.14993021086182823, 0.03545242585800642, 0.06398105064428644, -0.08291465480956293, 0.01050323526775778, 0.034255719499930254, 0.02656260719801204, 0.044406353787183446, -0.012426513343237331, -0.01570677094974968, -0.2213906762440907, -0.005286343488019493, -0.08176068796427521, -0.025088094006811053, -0.02301522763657198, -0.027716574043299774, 0.011635832356651292, 0.012522677247011308, 0.034832702922574114, -0.11847392944954044, -0.01018268892184452, 0.002350673203363898, 0.05872409057130901, 0.021871945669481356, 0.1919858914456478, -0.06372461356755585, 0.16232466957047423, -0.048081951886988814, 0.05291151683208191, -0.03090066774603814, -0.036200367331804026, 0.07710208107033584, 0.11445641524742761, -0.02543001010911853, -0.008927215733684256, -0.06081832669794229, -0.10274578874339653, 0.16044413100778313, -0.04688524552891265, 0.0076183181545384495, 0.20788499020294543, 0.0751788029948563, -0.0777859132749508, -0.1734369428954672, 0.01937168417135794, 0.01811086854409912, 0.004760113236811893, 0.03273846679594083, -0.06389557161870958, 0.004746757139065506, 0.06150215890255725, -0.1257396466235743, 0.03743981320266862, 0.1075326141757012, 0.0015666702656510522, 0.01615553583402824, 0.007447360103384712, 0.02361358081561006, 0.09830087941339935, -0.04002555372636891, -0.18839577237141927, 0.008558587435884009, -0.13223605256741636, 0.07765769473658549, 0.05415096270294652, 0.04701346406727795, -0.10009593895051361, 0.028336296978732075, -0.04250444546809812, 0.03865788931713901, 0.16275206469835857, 0.07389661761120325, 0.022929748610995112, -0.18429277914372957, 0.02867821308103955, -0.057826560802751885, -0.06141667987698038, -0.1372793150764516, 0.05962162033986612, -0.05479205539477303, 0.04919317921948811, 0.006063668376859145, -0.12488485636780562, 0.004570456648813215, -0.13642452482068293, -0.11514024745204254, 0.0390211751758407, 0.11060985909646848, -0.04560306014525961, 0.17249667361412166, -0.02099578565731845, 0.04068801617458964, 0.017993334883930925, -0.0009135570858527875, -0.03002450773387524, 0.02069660906779941, -0.18548948550180575, 0.05872409057130901, -0.07641824886572089, 0.033742845346469034, -0.002973067358345475, 0.0537663070878506, 0.1359971296927986, -0.07932453573533443, 0.024682068635320922, -0.1127468347358902, 0.04479100940227936, 0.04162828545593521, 0.0777859132749508, 0.009050091832951006, 0.1205254260633853, 0.029340675529260285, 0.21250085758409631, 0.06030545254448108, 0.030516012130942235, -0.08688942949888734, 0.028400406247914723, 0.013847602143452778, -0.11864488750069418, 0.11667886991242618, -0.08560724411523431, -0.13497138138587614, -0.012693635298165046, 0.07022101951139789, 0.11590955868223436, 0.015418279238427746, -0.012522677247011308, 0.0863338158326377, -0.11343066694050517, -0.11684982796357993, -0.04293184059598246, 0.07081937269043596, 0.2270322919321641, 0.04229074790415594, -0.050988238756602355, -0.013473631406553978, 0.009728581598467404, -0.1401001229204883, -0.015001568988740511, 0.11026794299416101, 0.1834379888879609, -0.006987910340909041, 0.07393935712399169, 0.14163874538087193, 0.013655274335904825, 0.10308770484570402, 0.0657761101814007, -0.03523872829406425, -0.02178646664390449, 0.08321383139908198, 0.025023984737628402, -0.01662567047470102, -0.12257692267723015, 0.04684250601612422, 0.010326934777505486, 0.022801530072629805, -0.092659263725326, 0.0413718483792046, 0.008948585490078473, 0.02463932912253249, 0.022758790559841372, -0.22515175336947296, -0.0244042618021961, 0.029447524311231373, 0.006891746437135063, 0.04068801617458964, -0.1692484706422006, 0.0051661386083020205, -0.08009384696552625, -0.04182061326348316, -0.06791308582082242, 0.11257587668473648, 0.07881166158187322, -0.08650477388379144, -0.1089002785849311, 0.024040975943494407, 0.24361522289407667, 0.018442099768209486, 0.13368919600222312, -0.08958201880455872, -0.04850934701487316, 0.11684982796357993, -0.004207170790111521, -0.11189204448012152, 0.21711672496524725, 0.004097650788591158, -0.09659129890186197, 0.07235799515081962, -0.08676121096052204, -0.1133451879149283, 0.07821330840283514, 0.0769311230191821, -0.02735328818459808, -0.006159832280633122, 0.08205986455379424, 0.052569600729774436, 0.032588878501181306, 0.12514129344453623, -0.06291256282457558, -0.026156581826521915, -0.05885230910967431, 0.09069324613705801, 0.16275206469835857, 0.023207555444119937, 0.05282603780650505, -0.05449287880525399, -0.06663090043716939, -0.22207450844870566, 0.032652987770363955, -0.06432296674659392, 0.13052647205587897, -0.013334727989991564, 0.06769938825688025, -0.053680828062273735, 0.05073180167987175, 0.1683082013608551, 0.049919750936891494, -0.014200203123957362, 0.13608260871837546, -0.08214534357937112, -0.02656260719801204, -0.04444909329997188, 0.08624833680706083, 0.09753156818320753, -0.023378513495273673, 0.047483598707950735, 0.029703961387961976, -0.011774735773213705, -0.1583071553683614, 0.04128636935362773, 0.051800289499582625, 0.09308665885321034, 0.03395654291041121, 0.25438558011676216, 0.01290733286210722, 0.06321173941409462, -0.03312312241103674, 0.030815188720461274, 0.012800484080136133, -0.07158868392062778, 0.10966958981512294, 0.04269677327564607, -0.11377258304281264, -0.02145523541979412, 0.07539250055879847, 0.06436570625938236, -0.1807026600695011, 0.03763214101021658, 0.13138126231164768, -0.043337865967472584, -0.02852862478628003, -0.0719733395357237, -0.079281796222546, -0.05013344850083367, -0.06321173941409462, -0.06026271303169265, -0.06816952289755303, 0.21027840291909775, -0.04671428747775891, -0.05829669544342467, 0.1714709253071992, 0.049706053372949324, 0.057313686649290665, -0.11710626504031052, -0.0877014802418676, -0.2104493609702515, -0.11753366016819487, -0.12223500657492269, 0.10112168725743603, 0.15420416214067167, 0.01865579733215166, 0.05013344850083367, -0.05718546811092537, -0.014809241181192555, 0.0584676534945784, -0.020974415900924234, -0.04192746204545425, -0.054920273933138336, 0.03216148337329696, 0.05825395593063623, -0.033935173154017, 0.12967168180011027, -0.0661607657964966, 0.19848229738948983, 0.03981185616242674, -0.009087488906640885, -0.03887158688108118, 0.04543210209410588, -0.07949549378648818, 0.12360267098415256, -0.15463155726855604, -0.19814038128718237, 0.015151157283500031, 0.15198170747567308, -0.05684355200861788, -0.08223082260494798, 0.07936727524812287, 0.06244242818390281, -0.04603045527314396, -0.09727513110647693, -0.007436675225187603, -0.06402379015707488, 0.011144327959584296, 0.26891701446482985, -0.03141354189949936, -0.0014264312393140015, -0.14958829475952076, -0.15950386172643757, -0.006886403998036509, -0.04526114404295214, 0.0559887617528492, -0.15839263439393825, 0.07364018053447265, -0.03833734297122575, 0.07128950733110875, 0.06898157364053328, -0.03987596543160939, 0.05932244375034709, 0.0656478916430354, -0.07577715617389437, 0.26618168564637007, 0.07988014940158408, -0.08924010270225124, 0.047312640656796995, 0.13061195108145582, -0.09744608915763066, -0.05945066228871239, 0.064921319925632, -0.06987910340909041, 0.038038166381706706, 0.07658920691687462, -0.03421297998714182, -0.11898680360300165, -0.04344471474944367, 0.06547693359188166, 0.0048669620187829785, -0.022609202265081854, -0.006031613742267819, -0.1381341053322203, 0.22190355039755194, -0.09667677792743884, 0.06295530233736402, 0.07988014940158408, 0.02076071833698206, -0.01967086076087698, 0.03810227565088936, -0.07859796401793105, -0.0623142096455375, 0.041136781058868206, 0.18326703083680715, 0.07180238148456995, 0.10189099848762784, -0.05786930031554032, 0.06804130435918773, 0.11565312160550377, 0.06496405943842044, -0.1555718265499016, 0.11787557627050237, 0.07094759122880127, -0.06051915010842325, -0.02252372323950498, -0.08026480501667999, -0.14488694835279295, -0.07838426645398888, 0.03055875164373067, -0.21062031902140524, -0.16856463843758568, 0.06026271303169265, 0.008296807920054846, 0.016497451936335717, -0.06598980774534287, 0.05235590316583227, 0.06996458243466729, -0.058040258366694054, 0.09308665885321034, 0.21592001860717108, 0.036755980998053675, 0.01817497781328177, 0.04983427191131463, -0.13685191994856727, 0.06821226241034146, -0.11514024745204254, -0.03179819751459527, 0.003638201026115487, -0.017597994390637906, -0.02525905205796479, 0.061160242800249766, -0.1607860471100906, -0.0722297766124543, 0.03139217214310514, 0.08111959527244869, 0.0816324694259099, -0.04885126311718063, -0.10531015951070262, 0.06757116971851494, 0.014189518245760256, -0.04301731962155933, -0.14745131912009904, 0.13864697948568153, -0.0032588878501181306, 0.08056398160619904, 0.08958201880455872, 0.04053842787983013, 0.08009384696552625, -0.052227684627466964, 0.013762123117875912, 0.019243465632992635, 0.14898994158048268, 0.07770043424937392, 0.021946739816861117, -0.09214638957186479, -0.11240491863358273, -0.12667991590491987, -0.01010789477446476, 0.017042380724388257, 0.03305901314185409, 0.05051810411592958, 0.008093795234309784, -0.09394144910897903, 0.08603463924311866, -0.09094968321378862, 0.10761809320127808, 0.07163142343341622, -0.03994007470079204, -0.06834048094870676, 0.07885440109466166, -0.06983636389630198, -0.016337178763379086, -0.06470762236168984, -0.0660325472581313, -0.10317318387128088, 0.006656679116798674, 0.1966017588267987, 0.03459763560223773, -0.07158868392062778, -0.2032691228217945, 0.2540436640144547, -0.053296172447177825, -0.004308677132984054, -0.09180447346955731, 0.06402379015707488, -0.14993021086182823, -0.05158659193564044, 0.03622173708819824, 0.050047969475256804, 0.036050779037044504, 0.049321397757853415, -0.0751788029948563, 0.009156940614922093, -0.14163874538087193, 0.07522154250764473, -0.04821017042535412, 0.06821226241034146, 0.1012071662830129, -0.05654437541909885, -0.011122958203190078, -0.045517581119682744, 0.03540968634521798, 0.022117697868014857, -0.014029245072803627, 0.0762900303273556, -0.04624415283708613, 0.13343275892549253, -0.13138126231164768, 0.008344889871941838, -0.0706056751264938, 0.08778695926744447, 0.09881375356686056, 0.07317004589379987, 0.051116457294967665, -0.03363599656449795, -0.026840414031136867, -0.042589924493674984, 0.04436361427439501, -0.036755980998053675, -0.03983322591882096, -0.129842639851264, 0.04662880845218204, 0.1288168915443416, 0.06051915010842325, -0.19848229738948983, -0.17172736238392983, -0.03686282978002476, 0.12471389831665187, -0.0009856800136832707, 0.14762227717125276, 0.027716574043299774, 0.039683637624061435, 0.10693426099666313, 0.01749114560866682, -0.18053170201834734, -0.024040975943494407, 0.07346922248331891, -0.0863338158326377, 0.1589055085473995, -0.405854413438974, -0.07941001476091131, -0.09069324613705801, 0.10377153705031897, -0.16052961003335997, 0.08641929485821456, 0.00956296598641222, 0.05423644172852338, -0.01599526266107161, -0.08120507429802555, -0.027737943799693993, -0.20463678723102438, -0.0374184434462744, 0.15471703629413291, 0.07975193086321879, 0.04126499959723351, -0.16146987931470555, 0.0668873375139, 0.07505058445649099, -0.08941106075340498, -0.0682550019231299, -0.010711590392601396, -0.040004183969974696, 0.012511992368814201, -0.12428650318876754, 0.005978189351282276, -0.1320650945162626, 0.12471389831665187, -0.01531143045645666, 0.007890782548564719, -0.18514756939949828, -0.03002450773387524, -0.05641615688073354, -0.0076877698628196565, -0.07265717174033864, 0.09283022177647975, 0.05500575295871521, 0.040004183969974696, -0.14574173860856163, 0.017544569999652364, -0.03006724724666367, -0.06530597554072791, -0.1056520756130101, -0.09633486182513136, 0.14924637865721327, 0.17711254099527257, 0.06534871505351635, -0.013206509451626262, -0.07765769473658549, 0.05654437541909885, -0.03162723946344153, -0.017662103659820558, 0.026327539877675655, -0.08812887536975195, -0.05667259395746415, -0.12368815000972944, 0.09035133003475054, -0.13856150046010465, 0.05312521439602408, 0.05654437541909885, -0.1480496722991371, -0.008441053775715813, 0.07184512099735839, -0.09479623936474774, -0.16497451936335716, 0.08731682462677169, -0.08300013383513981, -0.08855627049763629, -0.03600803952425607, -0.005572163979792148, 0.10676330294550938, 0.04791099383583508, -0.17830924735334874, -0.048081951886988814, 0.024382892045801883, -0.18925056262718798, -0.06970814535793667, 0.06654542141159252, 0.09274474275090287, 0.12257692267723015, 0.04889400262996907, 0.039256242496177096, -0.20309816477064074, -0.0079281796222546, 0.005775176665537212, 0.008975297685571244, 0.0672719931289959, -0.027417397453780735, 0.2169457669140935, 0.001988722954436843, 0.0385296707787737, -0.27062659497636726, -0.11360162499165889, 0.08291465480956293, -0.041158150815262425, -0.08300013383513981, -0.01717059926275356, 0.02288700909820668, -0.1320650945162626, 0.010300222582012715, 0.06812678338476459, -0.03342229900055578, 0.08761600121629073, -0.061459419389768816, 0.05560410613775329, -0.0474408591951623, -0.026455758416040955, -0.05299699585765878, 0.007650372789129775, 0.014798556302995446, -0.0005546119589186696, -0.05974983887823143, 0.17035969797469994, -0.020750033458784952, 0.09530911351820893, -0.02161550859275075, -0.14274997271337123, -0.08270095724562077, 0.014349791418716885, 0.19608888467333752, 0.11522572647761942, 0.02239550470113968, -0.05423644172852338, -0.013142400182443609, 0.11539668452877315, 0.0438507401209338, 0.045859497221990224, 0.048936742142757506, -0.10479728535724141, -0.1651454774145109, 0.011026794299416103, 0.1952340944175688, -0.13975820681818082, 0.09932662772032179, 0.03346503851334422, -0.19745654908256738, 0.06654542141159252]
    image_embedding_tensor = torch.tensor(image_embedding_list)
    normalized_tensor = torch.nn.functional.normalize(image_embedding_tensor, p=2, dim=0)
    image_embedding_tensor = torch.unsqueeze(image_embedding_tensor, 0)
    negative_image_embedding = None
    prompt_generation_policy = "top-k"

    # Generate img2img generation jobs with Kandinsky using the embeddings
    response = generate_img2img_generation_jobs_with_kandinsky(
        image_embedding=image_embedding_tensor,
        negative_image_embedding = None,  
        dataset_name="test-generations",
        prompt_generation_policy=prompt_generation_policy
    )

    print(response)