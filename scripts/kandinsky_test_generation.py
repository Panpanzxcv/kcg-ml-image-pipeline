import io
import sys
import os
import uuid
import torch


base_directory = os.getcwd()
sys.path.insert(0, base_directory)

from utility.http import generation_request
from utility.http import request
from utility.minio.cmd import connect_to_minio_client, upload_data
from worker.generation_task.generation_task import GenerationTask
from kandinsky_worker.dataloaders.image_embedding import ImageEmbedding

def read_msgpack_file(file_path):
    """Reads a msgpack file and returns its bytes."""
    with open(file_path, "rb") as f:
        return f.read()

def generate_img2img_generation_jobs_with_kandinsky(image_embedding,
                                                    negative_image_embedding,
                                                    dataset_name,
                                                    prompt_generation_policy,
                                                    self_training= False,
                                                    init_img_path="./test/test_inpainting/white_512x512.jpg"):

    # get sequential ids
    sequential_ids = request.http_get_sequential_id(dataset_name, 1)

    count = 0
    # generate UUID
    task_uuid = str(uuid.uuid4())
    task_type = "img2img_generation_kandinsky"
    model_name = "kandinsky_2_2"
    model_file_name = "kandinsky-2-2-decoder"
    model_file_path = "input/model/kandinsky/kandinsky-2-2-decoder"
    task_input_dict = {
        "strength": 0.75,
        "seed": "",
        "dataset": dataset_name,
        "file_path": sequential_ids[count]+".jpg",
        "init_img": init_img_path,
        "num_images": 1,
        "image_width": 512,
        "image_height": 512,
        "decoder_steps": 100,
        "decoder_guidance_scale": 12,
        "self_training": self_training
    }

    prompt_generation_data={
        "prompt_generation_policy": prompt_generation_policy
    }

    image_embedding= image_embedding.detach().cpu().numpy().tolist()[0]
    negative_image_embedding= image_embedding.detach().cpu().numpy().tolist()[0] if negative_image_embedding is not None else None

    # create the job
    generation_task = GenerationTask(uuid=task_uuid,
                                     task_type=task_type,
                                     model_name=model_name,
                                     model_file_name=model_file_name,
                                     model_file_path=model_file_path,
                                     task_input_dict=task_input_dict,
                                     prompt_generation_data=prompt_generation_data)
    generation_task_json = generation_task.to_dict()

    # add job
    response = generation_request.http_add_kandinsky_job(job=generation_task_json,
                                                         positive_embedding=image_embedding,
                                                         negative_embedding=negative_image_embedding)

    return response


if __name__ == "__main__":
    image_embedding_list = [-0.09050280551863488, 0.027062368527711406, -0.10616775345486783, -0.047723446038291074, 0.03268301429885147, 0.04780151056289024, -0.024967637117633744, 0.02522785219963097, -0.11574366847236571, -0.04350796170993603, -0.04522538125111772, -0.1043982908972867, 0.024642368265137212, 0.02047892695318161, 0.0564146297769984, 0.055165597383411716, -0.02607355121612195, 0.016029249051029062, 0.04436667148052687, 0.0018036157870932662, -0.04100989692276267, 0.014012582165550569, -0.060317856006956765, -0.03689849862720651, 0.033723874626840365, -0.004075618721781537, 0.05474925325221615, -0.06005764092495955, -0.0803544173207431, 0.01214553895222048, -0.031121723806868114, -0.12396646506347803, -0.04592796197251022, -0.06484559843370849, 0.05183484433384723, 0.004104892918506225, 0.03190236905285979, -0.0059849468859361765, 0.0168229050511206, 0.08774452564946428, 0.05350022085862947, 0.01619838885432726, -0.024421185445439572, -0.012529356198166386, 0.04124409049656017, 0.020114625838385497, -0.14530410178725048, -0.06791613640127574, -0.006105296361359893, -0.057559576137786186, 0.024043873576543594, -0.08639140722307871, -0.05964129679376398, -0.03559742321722039, 0.008600108460008289, 0.04116602597196101, -0.08436172958350036, -0.018865593444798816, 0.01194387226367263, 0.02930021823288754, -0.016289464133026288, -0.0021955647543515865, 0.2192051850744624, -0.02885785259349226, 0.016549679215023514, 0.005165269377644917, 0.021675916330368847, -0.024147959609342486, -0.050924091546856946, 0.020114625838385497, 0.05121032813705389, 0.03973484302097627, 0.07556645981199415, 0.0013726345575353622, -0.05061183344846028, 0.01808494819880714, 0.07926151397635475, 0.014598066100044325, 0.054020651022623926, -0.11355786178358901, -0.08248818099312034, -0.016029249051029062, -0.050559790432060825, -0.005057930656321062, -0.022716776658357748, 0.054384952137420034, 0.13760173536013262, 0.08295656814071534, 0.030080863478879217, 0.05906882361337008, -0.006798119017177504, 0.011098173247181648, -0.08430968656710092, 0.03281312183985008, -0.051964951874845844, 0.0021142475412274536, -0.02979462688868227, 0.04530344577571688, -0.08207183686192478, -0.07280817994282357, -0.05412473705542281, -0.04840000525148386, -0.019854410756388274, -0.07488990059880136, 0.11116388302921454, -0.0035584412463120526, -0.045017209185519935, 0.01444193705084599, -0.09872560210974718, 0.03814753102079319, -0.05240731751424113, -0.062295490630135675, 0.03968280000457682, -0.06302409285972792, -0.013251453050708687, -0.02750473416710669, 0.09393764460099824, 0.01660172223142296, 0.014884302690241272, -0.015638926428033228, 0.02776494924910391, -0.053968608006224474, -0.02742666964250752, 0.048269897710485246, -0.04840000525148386, -0.0036234950168113587, -0.005204301639944502, 0.06416903922051569, 0.0661466738436946, 0.013817420854052652, 0.0038999735414334104, -0.06042194203975565, 0.01891763646119826, -0.013830431608152512, -0.06515785653210515, -0.0845178586326987, 0.0010636291476636573, 0.011878818493173323, -0.033723874626840365, -0.07218366374603023, 0.16112517877268176, 0.12750539017864027, -0.01891763646119826, -0.016966023346219074, -0.0459019404643105, -0.08285248210791646, 0.1046585059792839, 0.06364860905652124, -0.019229894559594934, 0.039526670955378485, -0.036534197512410396, -0.033723874626840365, -0.011202259279980538, 0.1417651766720882, -0.05344817784223003, 0.03026301403627727, -0.019412045116992988, -0.04280538098854352, 0.07603484695958916, -0.023861723019145537, -0.0013457998772043985, -0.004667608033325224, 0.04280538098854352, -0.05667484485899561, 0.04894645692367803, -0.05589419961300394, 0.02233946478946177, -0.050169467809064984, -0.052511403547040016, 0.001545840221489765, -0.022690755150158025, -0.0023516938035499212, -0.0025501078035728053, 0.02064806675647981, -0.06005764092495955, -0.02495462636353388, 0.06094237220375011, -0.04290946702134241, 0.036690326561608734, -0.01392150688685154, -0.05284968315363641, 0.07811656761556696, 0.0011929235165310287, -0.08217592289472367, -0.01774666859221075, 0.005939409246586661, 0.04569376839871272, -0.01950312039569202, -0.01360924878845487, 0.04353398321813575, -0.050429682891062214, 0.022872905707556082, 0.06916516879486242, 0.08935785915784708, -0.01080543127993477, -0.015027420985339747, -0.06432516826971403, -0.030210971019877825, -0.06052602807255454, 0.15696173746072617, -0.014207743477048488, 0.00747467823037029, -0.20484131254821555, -0.025058712396332773, -0.016341507149425734, 0.038693982692987364, -0.010083334427392471, -0.052771618629037245, 0.30413938783835665, -0.021545808789370235, -0.054905382301414486, 0.04873828485808025, 0.0017271776067565815, -0.0484520482678833, 0.047723446038291074, -0.010740377509435463, -0.04525140275931744, -0.06307613587612736, -0.016966023346219074, 0.0032331723938155213, 0.057923877252582294, -0.02354946492074887, -0.12729721811304248, 0.03804344498799431, 0.04595398348070995, -0.032006455085658685, -0.01591215226413031, 0.009088011738753085, 0.133438294048177, -0.06630280289289295, 0.14238969286888156, 0.007338065312321746, -0.008034140656664324, 0.0185012923300027, -0.00659319964010469, 0.05355226387502892, -0.02534494898652972, 0.09008646138743931, 0.024577314494637906, -0.039370541906180154, -0.0122561303620693, -0.06021376997415787, -0.08144732066513144, 0.035727530758218995, 0.060161726957758434, -0.026164626494820976, -0.04444473600512604, 0.011299839935729498, 0.06520989954850459, 0.08540258991148926, 0.0070062910827752845, 0.1584189419199106, -0.12073979804671242, 0.07036215817204965, -0.05464516721941726, -0.08836904184625763, -0.07286022295922301, 0.019203873051395207, -0.09128345076462654, 0.00862612996820801, 0.004979866131721894, -0.09045076250223544, -0.07228774977882911, -0.007949570755015225, -0.11501506624277347, -0.0902946334530371, -0.10595958138927004, 0.017707636329911163, 0.06453334033531181, -0.04608409102170856, -0.13499958454016034, 0.011761721706274573, -0.01900871173989729, 0.03705462767640485, -0.04920667200567526, -0.03166817547906229, -0.08420560053430204, 0.09825721496215217, 0.054905382301414486, 0.07332861010681802, -0.0901905474202382, 0.05745549010498729, -0.02629473403581959, 0.04244107987374741, 0.08633936420667927, -0.02128559370737301, 0.06869678164726742, 0.015196560788637943, 0.07145506151643799, 0.09726839765056272, 0.02106441088767537, -0.22066238953364686, -0.07176731961483467, -0.06292000682692901, -0.012178065837470132, -0.05102817757965583, 0.025722260855425696, 0.0029664519347683653, -0.05506151135061282, 0.02522785219963097, 0.03973484302097627, 0.0016751345903571362, 0.016250431870726705, 0.05776774820338396, 0.06906108276206353, -0.03734086426660179, -0.03169419698726201, 0.019346991346493682, -0.057507533121386734, 0.020452905444981892, -0.14020388618010485, -0.0014759074182030107, 0.0833729122719109, -0.03973484302097627, 0.11085162493081786, -0.05979742584296232, -0.04944086557947276, 0.06406495318771681, -0.03450451987283204, 0.056050328662202276, 0.012731022886714237, -0.09737248368336161, 0.003782876754534659, 0.003782876754534659, -0.17236647031496188, 0.013752367083553345, 0.09154366584662377, 0.006967258820475702, 0.032448820725053965, 0.008535054689508981, 0.003467365967613024, 0.033723874626840365, 0.029664519347683656, -0.0168229050511206, -0.0833729122719109, 0.004755430623499288, 0.17163786808536963, 0.018228066493905615, -0.13947528395051265, -0.014585055345944465, 0.24876561838934716, 0.003669032656160873, -0.11553549640676793, 0.13801807949132816, 0.0034771240331879193, -0.03705462767640485, -0.06432516826971403, 0.06250366269573346, 0.06541807161410239, -0.015183550034538083, 0.07093463135244354, -0.016081292067428508, -0.09971441942133663, -0.014116668198349459, -0.04564172538231327, -0.041087961447361834, -0.04707290833329801, 0.03731484275840207, 0.006687527607328683, 0.007598280394318971, -0.052641511088038634, -0.019854410756388274, 0.16237421116626843, 0.045745811415112164, -0.07004990007365298, 0.037965380463395135, -0.05485333928501504, 0.0564146297769984, -0.0772318363367764, 0.08004215922234642, -0.014533012329545018, -0.03198043357745896, -0.056362586760598944, 0.05217312394044363, 0.03034107856087644, -0.10091140879852388, -0.10304517247090113, -0.011969893771872353, -0.07197549168043245, 0.11220474335720343, 0.09492646191258769, 0.01660172223142296, -0.07015398610645188, -0.028623659019694755, 0.024460217707739155, 0.04270129495574463, 0.10216044119211054, -0.0056108877055651655, 0.12833807844103137, -0.0072990330500221625, -0.09919398925734219, 0.09185592394502044, -0.06063011410535344, 0.008535054689508981, 0.015586883411633778, 0.030289035544476997, -0.1336464661137748, 0.044887101644521324, 0.032318713184055346, -0.024967637117633744, -0.01517053928043822, -0.16258238323186622, -0.06911312577846297, -0.054332909121020595, -0.037132692201004014, -0.05113226361245472, 0.05802796328538118, 0.06416903922051569, 0.05284968315363641, 0.0017857260002059568, -0.04129613351295962, 0.0228338734452565, 0.05969333981016343, 0.03034107856087644, -0.04181656367695407, -0.11459872211157791, 0.11626409863636014, -0.10569936630727282, -0.059016780596970644, 0.026281723281719727, 0.12875442257222697, 0.0036202423282863934, 0.023289249838751643, -0.007546237377919526, -0.13198108958899255, -0.024928604855334158, -0.0101744097060915, 0.025800325380024865, -0.03895419777498459, 0.057559576137786186, 0.04337785416893741, -0.048269897710485246, -0.011612098034126168, 0.022781830428857053, 0.039630756988177376, -0.060005597908560096, 0.011397420591478457, 0.006752581377827991, -0.08862925692825485, -0.0234714003961497, 0.06385678112211902, 0.02794709980650197, -0.06703140512248516, 0.021337636723772452, 0.01796785141190839, -0.03905828380778348, 0.05428086610462114, 0.02815527187209975, -0.017512475018413246, -0.02533193823242986, -0.02189709915006649, -0.010050807542142819, -0.06354452302372236, -0.026086561970221814, -0.08623527817388038, 0.00041837706152366344, -0.04691677928409968, 0.017941829903708666, -0.046448392136504674, -0.021363658231972178, 0.03786129443059624, -0.01753849652661297, -0.008157742820613005, -0.029118067675489485, -0.04715097285789718, 0.011495001247227417, -0.026984304003112237, 0.08769248263306484, -0.11553549640676793, 0.05128839266165306, 0.033749896135040085, 0.011846291607923672, -0.044028391873930484, 0.06109850125294844, 0.08909764407584986, -0.07270409391002468, 0.03382796065963926, 0.027712906232704466, 0.034114197249836206, -0.10523097915967781, -0.032058498102058124, -0.04145226256215795, 0.02732258360970863, -0.018748496657900064, -0.02204021744516496, -0.09732044066696216, 0.04439269298872659, 0.009166076263352252, 0.048712263349880526, 0.09612345128977494, 0.05938108171176676, 0.03648215449601095, 0.001902822787104708, -0.024082905838843177, -0.04103591843096239, -0.005422231771117177, 0.027010325511311963, 0.06349248000732291, 0.0724959218444269, 0.01588613075593059, -0.04892043541547831, -0.06744774925368073, 0.027088390035911125, 0.0564146297769984, -0.001743441049381408, -0.06151484538414401, -0.004885538164497901, 0.06109850125294844, 0.032995272397248136, 0.025410002757029027, -0.004160188623430635, -0.014598066100044325, 0.07452559948400526, -0.04350796170993603, -0.04704688682509829, -0.01214553895222048, 0.025436024265228747, -0.13645678899934482, 0.04100989692276267, 0.011781237837424364, 0.02262570137965872, 0.0015360821559148692, 0.04517333823471827, -0.07286022295922301, -0.08956603122344486, 0.03169419698726201, -0.0029127825741064378, -0.08727613850186929, -0.03463462741383066, -0.001223824057518199, -0.08753635358386651, 0.04634430610370578, -0.11470280814437679, 0.09622753732257383, -0.006167097443334234, 0.0008953025164967025, 0.00029111562298439556, 0.0479836611202883, 0.046734628726701616, 0.07801248158276808, 0.09242839712541434, 0.06193118951533956, 0.12292560473548911, -0.08108301955033533, -0.02721849757690974, 0.056726887875395066, -0.006033737213810656, -0.01831914177260464, 0.026828174953913903, 0.08384129941950591, 0.028623659019694755, -0.009263656919101212, -0.02963849783948393, 0.0060402425908605865, -0.009035968722353639, -0.0024281319838866063, -0.048868392399078864, -0.023185163805952754, 0.08123914859953367, -0.0708825883360441, 0.03062731515107339, 0.013570216526155286, -0.08186366479632701, -0.054384952137420034, -0.017785700854510332, 0.03892817626678487, 0.1027849573889039, -0.05719527502299007, -0.07619097600878749, -0.008782259017406346, -0.0631281788925268, -0.017070109379017963, -0.038381724594590695, 0.015053442493539468, -0.05834022138377786, -0.09966237640493719, 0.052641511088038634, -0.05170473679284862, 0.06245161967933402, -0.023757636986346645, -0.04785355357928969, 0.06640688892569184, 0.03234473469225507, 0.04449677902152548, 0.014923334952540857, -0.007838979345166404, 0.025631185576726667, -0.05880860853137287, 0.04199871423435212, -0.049544951612271654, -0.0786369977795614, -0.023016024002654557, 0.010551721574987476, 0.10507485011047948, 0.03343763803664342, 0.0055035489842413104, 0.02338032511745067, 0.07436947043480692, 0.09711226860136439, 0.026307744789919454, 0.020166668854784943, 0.011800753968574156, -0.0026102825412846636, 0.09877764512614663, 0.060578071088953994, 0.1252154974570647, 0.07421334138560857, -0.11314151765239344, -0.00946532360764906, -0.048530112792482476, -0.0011132326476693784, -0.023081077773153862, -0.020205701117084526, 0.02119451842867398, 0.03460860590563093, 0.04842602675968358, -0.031199788331467283, 0.06859269561446853, -0.057351404072188396, -0.005314893049793322, 0.05178280131744778, 0.030132906495278663, 0.07717979332037694, 0.0438202198083327, -0.06042194203975565, -0.03198043357745896, -0.01817602347750617, 0.005724731803938951, 0.006124812492509684, 0.04611011252990828, 0.0631281788925268, 0.0032201616397156602, -0.008430968656710091, 0.11543141037396903, 0.002694852442933762, -0.023120110035453445, 0.017018066362618517, -0.020114625838385497, 0.09143957981382489, 0.07010194309005242, -0.017226238428216297, 0.12667270191624916, 0.06666710400768906, -0.07999011620594698, -0.04725505889069607, 0.06250366269573346, -0.06973764197525632, -0.02488957259303458, 0.09128345076462654, 0.021584841051669818, 0.03895419777498459, -0.050481725907461666, 0.006394785640081806, 0.020856238822077586, 0.016172367346127536, 0.027036347019511683, -0.007565753509069318, -0.009562904263398021, -0.13479141247456258, -0.0032185352954531773, -0.04977914518606916, -0.01527462531323711, -0.014012582165550569, -0.016874948067520042, 0.007084355607374452, 0.0076243019025186935, 0.02120752918277384, -0.0721316207296308, -0.006199624328583887, 0.0014311829509847378, 0.03575355226641872, 0.013316506821207991, 0.11688861483315349, -0.038798068725786256, 0.09882968814254607, -0.02927419672468782, 0.03221462715125646, -0.01881355042839937, -0.02204021744516496, 0.0469428007922994, 0.06968559895885687, -0.01548279737883489, -0.005435242525217038, -0.03702860616820513, -0.06255570571213291, 0.09768474178175829, -0.02854559449509559, 0.004638333836600536, 0.12656861588345025, 0.045771832923311884, -0.04735914492349496, -0.10559528027447392, 0.011794248591524226, 0.01102661409963241, 0.0028981454757440943, 0.01993247528098744, -0.03890215475858515, 0.0028900137544316806, 0.03744495029940068, -0.07655527712358362, 0.022794841182956913, 0.06547011463050183, 0.0009538509099460781, 0.009836130099495107, 0.004534247803801647, 0.014376883280346683, 0.05984946885936176, -0.024369142429040126, -0.11470280814437679, 0.0052108070169944315, -0.08051054636994143, 0.047281080398895795, 0.03296925088904842, 0.028623659019694755, -0.06094237220375011, 0.01725225993641602, -0.02587838990462403, 0.023536454166649005, 0.09908990322454331, 0.044991187677320216, 0.013960539149151125, -0.11220474335720343, 0.0174604320020138, -0.03520710059422455, -0.03739290728300124, -0.08358108433750869, 0.03630000393861289, -0.03335957351204425, 0.029950755937880602, 0.00369180147583563, -0.07603484695958916, 0.0027826750331078256, -0.08306065417351424, -0.07010194309005242, 0.023757636986346645, 0.06734366322088185, -0.02776494924910391, 0.10502280709408003, -0.01278306590311368, 0.024772475806135827, 0.010955054952083175, -0.0005562097377690686, -0.01828010951030506, 0.012600915345715622, -0.11293334558679567, 0.03575355226641872, -0.04652645666110384, 0.020543980723680917, -0.0018101211641431967, 0.032735057315250914, 0.08280043909151702, -0.04829591921868497, 0.015027420985339747, -0.06864473863086797, 0.027270540593309186, 0.02534494898652972, 0.04735914492349496, 0.00551005436129124, 0.07338065312321747, 0.017863765379109497, 0.1293789387690203, 0.036716348069808454, 0.018579356854601867, -0.05290172617003585, 0.017291292198715606, 0.008430968656710091, -0.07223570676242967, 0.07103871738524244, -0.052121080924044175, -0.08217592289472367, -0.0077283879353175836, 0.042753337972144076, 0.07057033023764743, 0.009387259083049895, -0.0076243019025186935, 0.052563446563439455, -0.06906108276206353, -0.07114280341804133, -0.026138604986621256, 0.04311763908694019, 0.13822625155692594, 0.02574828236362542, -0.03104365928226895, -0.00820328045996252, 0.005923145803961836, -0.08529850387869037, -0.009133549378102599, 0.06713549115528405, 0.111684313193209, -0.004254516590654629, 0.045017209185519935, 0.08623527817388038, 0.00831387186981134, 0.06276387777773068, 0.04004710111937294, -0.021454733510671203, -0.013264463804808547, 0.05066387646485972, 0.015235593050937527, -0.010122366689692054, -0.07462968551680414, 0.028519572986895864, 0.00628744691875795, 0.013882474624551956, -0.0564146297769984, 0.025188819937331387, 0.0054482532793169, 0.015001399477140024, 0.013856453116352233, -0.13708130519613815, -0.01485828118204155, 0.017928819149608807, 0.0041959681972052534, 0.024772475806135827, -0.10304517247090113, 0.0031453498036414576, -0.04876430636627998, -0.025462045773428473, -0.041348176529359064, 0.06854065259806907, 0.0479836611202883, -0.052667532596238346, -0.06630280289289295, 0.01463709836234391, 0.14832259673841827, 0.01122828078818026, 0.081395277648732, -0.05454108118661837, -0.02953441180668504, 0.07114280341804133, -0.002561492213410184, -0.06812430846687352, 0.13218926165459033, 0.0024948120986483953, -0.05880860853137287, 0.0440544133821302, -0.052823661645436684, -0.06900903974566408, 0.04761936000549219, 0.04683871475950051, -0.016653765247822402, -0.003750349869285006, 0.04996129574346721, 0.032006455085658685, 0.01984140000228841, 0.07619097600878749, -0.03830366006999153, -0.015925163018230173, -0.035831616791017894, 0.055217640399811155, 0.09908990322454331, 0.01412967895244932, 0.032162584134857015, -0.033177422954646194, -0.04056753128336738, -0.13520775660575812, 0.019880432264587994, -0.03916236984058237, 0.07946968604195254, -0.008118710558313423, 0.041218068988360446, -0.03268301429885147, 0.030887530233070615, 0.10247269929050723, 0.030393121577275885, -0.008645646099357803, 0.08285248210791646, -0.05001333875986666, -0.016172367346127536, -0.027062368527711406, 0.052511403547040016, 0.05938108171176676, -0.01423376498524821, 0.0289098956098917, 0.01808494819880714, -0.0071689255090235495, -0.09638366637177216, 0.02513677692093194, 0.03153806793806368, 0.05667484485899561, 0.020674088264679532, 0.15488001680474836, 0.007858495476316197, 0.03848581062738959, -0.020166668854784943, 0.018761507411999927, 0.007793441705816889, -0.0435860262345352, 0.06677119004048795, 0.02599548669152278, -0.06926925482766132, -0.013062797116260697, 0.0459019404643105, 0.039188391348782096, -0.11001893666842676, 0.022911937969855665, 0.07999011620594698, -0.026385809314518623, -0.01736935672331477, -0.0438202198083327, -0.048269897710485246, -0.0305232291182745, -0.03848581062738959, -0.036690326561608734, -0.041504305578557395, 0.12802582034263474, -0.028441508462296695, -0.0354933371844215, 0.1043982908972867, 0.03026301403627727, 0.03489484249582788, -0.07129893246723966, -0.05339613482583058, -0.12812990637543362, -0.0715591475492369, -0.07442151345120636, 0.061566888400543446, 0.0938856015845988, 0.011358388329178874, 0.0305232291182745, -0.03481677797122871, -0.00901645259120385, 0.03559742321722039, -0.012770055149013818, -0.02552709954392778, -0.03343763803664342, 0.019581184920291185, 0.03546731567622177, -0.02066107751057967, 0.07894925587795809, -0.04028129469317044, 0.1208438840795113, 0.024239034888041515, -0.005532823180965998, -0.02366656170764762, 0.027660863216305023, -0.04840000525148386, 0.07525420171359748, -0.09414581666659602, -0.12063571201391353, 0.009224624656801628, 0.09253248315821322, -0.03460860590563093, -0.0500653817762661, 0.04832194072688469, 0.03801742347979458, -0.028025164331101138, -0.05922495266256842, -0.004527742426751716, -0.03898021928318431, 0.006785108263077643, 0.16372732959265401, -0.019125808526796042, -0.0008684678361657386, -0.09107527869902876, -0.09711226860136439, -0.0041927155086802885, -0.02755677718350613, 0.03408817574163648, -0.0964357093881716, 0.04483505862812188, -0.02334129285515109, 0.04340387567713714, 0.04199871423435212, -0.024278067150341098, 0.036117853381214836, 0.03996903659477377, -0.046136134038108005, 0.16206195306787174, 0.04863419882528136, -0.054332909121020595, 0.028805809577092813, 0.07952172905835198, -0.05932903869536731, -0.036195917905814, 0.039526670955378485, -0.0425451659065463, 0.023159142297753028, 0.04663054269390273, -0.020830217313877866, -0.07244387882802746, -0.026450863085017925, 0.03986495056197488, 0.0029631992462434004, -0.013765377837653204, -0.0036722853446858384, -0.08410151450150313, 0.13510367057295924, -0.05886065154777231, 0.03832968157819125, 0.04863419882528136, 0.012639947608015206, -0.011976399148922283, 0.023198174560052614, -0.04785355357928969, -0.037939358955195415, 0.02504570164223291, 0.1115802271604101, 0.04371613377553381, 0.06203527554813845, -0.03523312210242427, 0.04142624105395823, 0.0704142011884491, 0.039552692463578204, -0.09471828984698992, 0.07176731961483467, 0.043195703611539356, -0.036846455610807065, -0.01371333482125376, -0.048868392399078864, -0.08821291279705928, -0.047723446038291074, 0.01860537836280159, -0.1282339924082325, -0.10262882833970555, 0.036690326561608734, 0.005051425279271131, 0.010044302165092887, -0.04017720866037155, 0.031876347544660066, 0.042597208922945745, -0.03533720813522316, 0.05667484485899561, 0.1314606594249981, 0.022378497051761356, 0.011065646361931997, 0.03034107856087644, -0.08332086925551146, 0.04153032708675712, -0.07010194309005242, -0.019360002100593545, 0.0022150808855013783, -0.010714356001235742, -0.015378711346036002, 0.037236778233802906, -0.09789291384735606, -0.04397634885753104, 0.019112797772696182, 0.049388822563073316, 0.049701080661469985, -0.029742583872282825, -0.06411699620411625, 0.04114000446376128, 0.008639140722307872, -0.026190648003020702, -0.08977420328904265, 0.08441377259989981, -0.001984140000228841, 0.04905054295647692, 0.05454108118661837, 0.024681400527436795, 0.04876430636627998, -0.0317982830200609, 0.008378925640310645, 0.011716184066925059, 0.09071097758423265, 0.047307101907095514, 0.013362044460557507, -0.056102371678601715, -0.06843656656527018, -0.0771277503039775, -0.006154086689234372, 0.010376076394639349, 0.020127636592485357, 0.030757422692072003, 0.00492782311532245, -0.05719527502299007, 0.052381296006041404, -0.05537376944900949, 0.06552215764690127, 0.043612047742734916, -0.02431709941264068, -0.04160839161135629, 0.048009682628488023, -0.04251914439834657, -0.009946721509343927, -0.03939656341437987, -0.040203230168571275, -0.06281592079413012, 0.004052849902106781, 0.11969893771872352, 0.02106441088767537, -0.0435860262345352, -0.12375829299788024, 0.15467184473915058, -0.032448820725053965, -0.002623293295384525, -0.05589419961300394, 0.03898021928318431, -0.09128345076462654, -0.03140796039706506, 0.02205322819926482, 0.030471186101875054, 0.021949142166465933, 0.030028820462479774, -0.045771832923311884, 0.005575108131790547, -0.08623527817388038, 0.04579785443151161, -0.029352261249286984, 0.04153032708675712, 0.06161893141694289, -0.034426455348232875, -0.006772097508977781, -0.027712906232704466, 0.021558819543470095, 0.013466130493356397, -0.008541560066558913, 0.046448392136504674, -0.02815527187209975, 0.08123914859953367, -0.07999011620594698, 0.005080699475995819, -0.04298753154594158, 0.05344817784223003, 0.060161726957758434, 0.04454882203792493, 0.031121723806868114, -0.02047892695318161, -0.016341507149425734, -0.02593043292102348, 0.027010325511311963, -0.022378497051761356, -0.024252045642141375, -0.07905334191075697, 0.028389465445897252, 0.07842882571396363, 0.036846455610807065, -0.1208438840795113, -0.10455441994648502, -0.022443550822260662, 0.07593076092679027, -0.0006001210328561002, 0.08987828932184154, 0.016874948067520042, 0.024160970363442346, 0.0651058135157057, 0.010649302230736436, -0.10991485063562785, -0.01463709836234391, 0.044730972595322986, -0.052563446563439455, 0.09674796748656828, -0.24710024186456492, -0.04834796223508442, -0.055217640399811155, 0.06318022190892623, -0.09773678479815773, 0.05261548957983891, 0.005822312459687911, 0.033021293905447856, -0.009738549443746148, -0.04944086557947276, -0.016887958821619906, -0.12459098126027135, -0.022781830428857053, 0.09419785968299547, 0.048556134300682195, 0.02512376616683208, -0.09830925797855163, 0.04072366033256572, 0.04569376839871272, -0.05443699515381948, -0.04155634859495684, -0.0065216404925554534, -0.024356131674940263, 0.007617796525468764, -0.07567054584479305, 0.0036397584594361856, -0.08040646033714255, 0.07593076092679027, -0.009322205312550588, 0.004804220951373768, -0.11272517352119789, -0.01828010951030506, -0.03434839082363371, -0.004680618787425085, -0.04423656393952826, 0.05651871580979728, 0.03348968105304286, 0.024356131674940263, -0.08873334296105374, 0.010681829115986089, -0.01830613101850478, -0.03976086452917599, -0.06432516826971403, -0.05865247948217453, 0.09086710663343099, 0.10783312997965007, 0.03978688603737571, -0.008040646033714254, -0.047281080398895795, 0.034426455348232875, -0.019255916067794657, -0.010753388263535326, 0.016029249051029062, -0.053656349907827805, -0.03450451987283204, -0.07530624472999693, 0.05500946833421338, -0.08436172958350036, 0.03234473469225507, 0.034426455348232875, -0.09013850440383875, -0.005139247869445195, 0.043742155283733535, -0.05771570518698452, -0.10044302165092887, 0.05316194125203308, -0.050533768923861105, -0.053916564989825035, -0.02192312065826621, -0.0033925541315388214, 0.06500172748290682, 0.02917011069188893, -0.10856173220924228, -0.02927419672468782, 0.01484527042794169, -0.11522323830837125, -0.04244107987374741, 0.040515488266967936, 0.056466672793397836, 0.07462968551680414, 0.029768605380482545, 0.02390075528144512, -0.12365420696508134, -0.004826989771048525, 0.0035161562954875037, 0.005464516721941726, 0.04095785390636322, -0.01669279751012199, 0.13208517562179142, 0.0012108133034183378, 0.02345838964204984, -0.1647681899206429, -0.06916516879486242, 0.050481725907461666, -0.025058712396332773, -0.050533768923861105, -0.010454140919238518, 0.013934517640951403, -0.08040646033714255, 0.006271183476133123, 0.04147828407035767, -0.020348819412183, 0.05334409180943114, -0.03741892879120096, 0.03385398216783898, -0.02888387410169198, -0.01610731357562823, -0.03226667016765591, 0.004657849967750329, 0.009009947214153918, -0.0003376697274979616, -0.03637806846321206, 0.10372173168409392, -0.012633442230965276, 0.05802796328538118, -0.013160377772009658, -0.08691183738707317, -0.05035161836646305, 0.00873672137805683, 0.11938667962032685, 0.07015398610645188, 0.013635270296654593, -0.033021293905447856, -0.008001613771414671, 0.07025807213925077, 0.02669806741291529, 0.02792107829830225, 0.02979462688868227, -0.06380473810571959, -0.10054710768372777, 0.0067135491155284055, 0.1188662494563324, -0.0850903318130926, 0.0604739850561551, 0.02037484092038272, -0.12021936788271798, 0.040515488266967936]
    
    image_embedding_tensor = torch.tensor(image_embedding_list)
    normalized_tensor = torch.nn.functional.normalize(image_embedding_tensor, p=2, dim=0)
    image_embedding_tensor = torch.unsqueeze(image_embedding_tensor, 0)
    negative_image_embedding = None
    prompt_generation_policy = "top-k"

    # Generate img2img generation jobs with Kandinsky using the embeddings
    response = generate_img2img_generation_jobs_with_kandinsky(
        image_embedding=image_embedding_tensor,
        negative_image_embedding = None,  
        dataset_name="test-generations",
        prompt_generation_policy=prompt_generation_policy
    )

    print(response)