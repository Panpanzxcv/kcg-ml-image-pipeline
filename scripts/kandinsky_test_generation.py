import io
import sys
import os
import uuid
import torch


base_directory = os.getcwd()
sys.path.insert(0, base_directory)

from utility.http import generation_request
from utility.http import request
from utility.minio.cmd import connect_to_minio_client, upload_data
from worker.generation_task.generation_task import GenerationTask
from kandinsky_worker.dataloaders.image_embedding import ImageEmbedding

def read_msgpack_file(file_path):
    """Reads a msgpack file and returns its bytes."""
    with open(file_path, "rb") as f:
        return f.read()

def generate_img2img_generation_jobs_with_kandinsky(image_embedding,
                                                    negative_image_embedding,
                                                    dataset_name,
                                                    prompt_generation_policy,
                                                    self_training= False,
                                                    init_img_path="./test/test_inpainting/white_512x512.jpg"):

    # get sequential ids
    sequential_ids = request.http_get_sequential_id(dataset_name, 1)

    count = 0
    # generate UUID
    task_uuid = str(uuid.uuid4())
    task_type = "img2img_generation_kandinsky"
    model_name = "kandinsky_2_2"
    model_file_name = "kandinsky-2-2-decoder"
    model_file_path = "input/model/kandinsky/kandinsky-2-2-decoder"
    task_input_dict = {
        "strength": 0.75,
        "seed": "",
        "dataset": dataset_name,
        "file_path": sequential_ids[count]+".jpg",
        "init_img": init_img_path,
        "num_images": 1,
        "image_width": 512,
        "image_height": 512,
        "decoder_steps": 100,
        "decoder_guidance_scale": 12,
        "self_training": self_training
    }

    prompt_generation_data={
        "prompt_generation_policy": prompt_generation_policy
    }

    image_embedding= image_embedding.detach().cpu().numpy().tolist()[0]
    negative_image_embedding= image_embedding.detach().cpu().numpy().tolist()[0] if negative_image_embedding is not None else None

    # create the job
    generation_task = GenerationTask(uuid=task_uuid,
                                     task_type=task_type,
                                     model_name=model_name,
                                     model_file_name=model_file_name,
                                     model_file_path=model_file_path,
                                     task_input_dict=task_input_dict,
                                     prompt_generation_data=prompt_generation_data)
    generation_task_json = generation_task.to_dict()

    # add job
    response = generation_request.http_add_kandinsky_job(job=generation_task_json,
                                                         positive_embedding=image_embedding,
                                                         negative_embedding=negative_image_embedding)

    return response


if __name__ == "__main__":
    image_embedding_list = [-9.727405365443357, 2.908712357694391, -11.411102326339533, -5.12940236924184, 3.512829539677072, 5.137792885658265, -2.683566833853623, 2.7115352219083766, -12.44033900675447, -4.676314482754829, -4.860905843916203, -11.220917287567207, 2.648606348785181, 2.201112139909121, 6.063546530270614, 5.9292982676077965, -2.8024324830863265, 1.7228527041728314, 4.768610163335516, 0.19385588970451198, -4.4078179574291925, 1.5060976967484898, -6.483072351091922, -3.965917426164083, 3.624703091896087, -0.43805487790758074, 5.8845488467201905, -6.455103963037168, -8.63663823130796, 1.3054245124556316, -3.345019211348549, -13.324140069284692, -4.936420491664038, -6.969722303244637, 5.571302900506948, 0.4412013215637406, 3.428924375512811, -0.6432729252593364, 1.8081562877398305, 9.430940452062966, 5.750300584057372, 1.7410321564084215, -2.6248332189386403, -1.3466778848363936, 4.432989506678471, 2.1619563966324655, -15.6175478897745, -7.2997492822907315, -0.6562083047346601, -6.186607437711531, 2.584279056259247, -9.285504834178248, -6.410354542149562, -3.826075485890314, 0.9243552252096118, 4.424598990262044, -9.067351407351168, -2.0277081339696474, 1.2837490117131973, 3.149240494965273, -1.7508210922275853, -0.23598327421198484, 23.560570097324565, -3.1016942352721917, 1.778789480282339, 0.5551725028868622, 2.329766724960988, -2.5954664114811488, -5.473413542315311, 2.1619563966324655, 5.50417876917554, 4.270772855960899, 8.122019891100491, 0.14753324698882608, -5.439851476649606, 1.943802969805386, 8.519171001477995, 1.5690265698716859, 5.806237360166881, -12.205404547094542, -8.865979013356942, -1.7228527041728314, -5.4342577990386545, -0.5436355428142762, -2.441640277180003, 5.845393103443535, 14.789683603353788, 8.916322111855498, 3.2331456591295344, 6.348824088429104, -0.7306741379304419, 1.1928517505352478, -9.061757729740219, 3.526813733704449, -5.585287094534325, 0.2272431529448743, -3.2023804322693055, 4.869296360332629, -8.821229592469335, -7.825554977720101, -5.817424715388782, -5.202120178184199, -2.1339880085777114, -8.049302082158132, 11.948095376990805, -0.3824677066487576, -4.8385311334724, 1.5522455370388335, -10.611206427973576, 4.100165688826901, -5.632833354227407, -6.69563210030805, 4.265179178349948, -6.77394358686136, -1.4242901616883352, -2.956258617387472, 10.096588087766106, 1.7843831578932896, 1.5997917967319149, -1.680900122090701, 2.984227005442226, -5.800643682555929, -2.9478681009710463, 5.188135984156823, -5.202120178184199, -0.3894598036624461, -0.5593677610950751, 6.897004494302276, 7.109564243518404, 1.4851214057074245, 0.41917621597062193, -6.494259706313823, 2.033301811580598, -1.4865198251101621, -7.003284368910341, -9.084132440184021, 0.11432078617380598, 1.276756914699509, -3.624703091896087, -7.758430846388692, 17.318025883503527, 13.704510146829342, -2.033301811580598, -1.823538901169945, -4.933623652858563, -8.905134756633597, 11.248885675621962, 6.841067718192768, -2.066863877246303, 4.248398145517096, -3.9267616828874274, -3.624703091896087, -1.2040391057571493, 15.237177812229849, -5.744706906446422, 3.252723530767862, -2.0864417488846305, -4.600799835006993, 8.172362989599048, -2.56470118462092, -0.1446490069706796, -0.5016829607321456, 4.600799835006993, -6.091514918325368, 5.260853793099182, -6.007609754161107, 2.40108611450061, -5.392305216956524, -5.6440207094493084, 0.16614970528777154, -2.4388434383745277, -0.2527643070448371, -0.2740902029365868, 2.2192915921447107, -6.455103963037168, -2.6821684144508855, 6.550196482423331, -4.611987190228895, 3.9435427157202794, -1.4963087609293262, -5.680379613920488, 8.396110094037079, 0.12821757898851177, -8.832416947691236, -1.9074440653342064, 0.6383784573497545, 4.91124894241476, -2.0962306847037944, -1.4627466952636214, 4.6791113215603035, -5.420273605011278, 2.4584213100128554, 7.433997544953549, 9.60434445800244, -1.1613873139736497, -1.6151744101620298, -6.913785527135129, -3.2471298531569115, -6.505447061535724, 16.87053167462747, -1.5270739877895552, 0.8033919468728017, -22.01671507670216, -2.6933557696727872, -1.756414769838536, 4.158899303741884, -1.083775037121708, -5.671989097504062, 32.68945195839619, -2.3157825309336113, -5.9013298795530424, 5.238479082655379, 0.18564017571342806, -5.20771385579515, 5.12940236924184, -1.1543952169599614, -4.863702682721678, -6.77953726447231, -1.823538901169945, 0.34750722158031544, 6.225763180988187, -2.531139118955215, -13.682135436385536, 4.088978333604999, 4.939217330469514, -3.4401117307347127, -1.710266929548192, 0.976795952812275, 14.342189394477728, -7.126345276351258, 15.304301943561256, 0.7887085431440559, -0.8635239811905222, 1.988552390692992, -0.7086490323373233, 5.755894261668323, -2.724120996533016, 9.682655944555751, 2.6416142517714922, -4.231617112684244, -1.317311077378902, -6.4718849958700195, -8.754105461137925, 3.840059679917691, 6.466291318259069, -2.8122214189054904, -4.777000679751941, 1.214527251277682, 7.008878046521292, 9.179224959570183, 0.7530488483742449, 17.027154647734086, -12.977332057405743, 7.562652130005416, -5.873361491498289, -9.498064583394376, -7.831148655331052, 2.0640670384408275, -9.811310529607619, 0.9271520640150872, 0.5352450263978501, -9.721811687832407, -7.769618201610594, -0.8544342550727273, -12.36202752020116, -9.705030654999554, -11.38872761589573, 1.9032488071259932, 6.936160237578932, -4.95320152449689, -14.50999972280625, 1.2641711400748699, -2.043090747399762, 3.982698458996935, -5.288822181153935, -3.403752826263532, -9.050570374518315, 10.56086332947502, 5.9013298795530424, 7.881491753829609, -9.693843299777653, 6.175420082489629, -2.8262056129328674, 4.561644091730338, 9.279911156567298, -2.2878141428788576, 7.383654446454992, 1.6333538623976194, 7.680119359835382, 10.454583454866954, 2.2640410130323168, -23.717193070431186, -7.713681425501086, -6.762756231639459, -1.3089205609624759, -5.484600897537212, 2.764675159212409, 0.31883962382419284, -5.918110912385895, 2.7115352219083766, 4.270772855960899, 0.1800464981024773, 1.746625834019372, 6.208982148155334, 7.422810189731647, -4.013463685857165, -3.406549665069008, 2.079449651870942, -6.18101376010058, 2.1983153011036456, -15.069367483901324, -0.15863320099805647, 8.961071532743103, -4.270772855960899, 11.914533311325101, -6.4271355749824135, -5.313993730403213, 6.885817139080375, -3.708608256060349, 6.024390786993959, 1.3683533855788277, -10.465770810088857, 0.40659044134598277, 0.40659044134598277, -18.52626024746889, 1.478129308693736, 9.839278917662373, 0.7488535901660318, 3.4876579904277936, 0.9173631281959232, 0.37267877082959383, 3.624703091896087, 3.1883962382419284, -1.8081562877398305, -8.961071532743103, 0.5111222917006248, 18.44794876091558, 1.959185583235501, -14.991055997348013, -1.567628150468948, 26.73777898034459, 0.39435427157202796, -12.417964296310668, 14.834433024241395, 0.3737275853816471, -3.982698458996935, -6.913785527135129, 6.718006810751852, 7.031252756965095, -1.631955442994882, 7.624182583725874, -1.7284463817837823, -10.71748630258164, -1.5172850519703913, -4.905655264803809, -4.416208473845618, -5.059481399104955, 4.010666847051689, 0.7187875730071716, 0.8166769311988097, -5.6580049034766855, -2.1339880085777114, 17.452274146166346, 4.916842620025711, -7.529090064339712, 4.080587817188573, -5.895736201942093, 6.063546530270614, -8.301017574650915, 8.603076165642255, -1.5620344728579973, -3.437314891929237, -6.057952852659664, 5.607661804978129, 3.2611140471842885, -10.846140887633506, -11.075481669682489, -1.2865458505186729, -7.736056135944889, 12.05996892920982, 10.202867962374171, 1.7843831578932896, -7.540277419561614, -3.076522686022913, 2.629028477146853, 4.5896124797850915, 10.980389150296325, -0.6030683674306279, 13.794008988604553, -0.7845132849358429, -10.661549526472132, 9.872840983328077, -6.516634416757626, 0.9173631281959232, 1.6753064444797503, 3.255520369573337, -14.36456410492153, 4.824546939445023, 3.473673796400417, -2.683566833853623, -1.6305570235921443, -17.47464885661015, -7.428403867342598, -5.8397994258325845, -3.991088975413361, -5.495788252759113, 6.236950536210088, 6.897004494302276, 5.680379613920488, 0.19193306302574767, -4.4385831842894214, 2.4542260518046426, 6.415948219760512, 3.2611140471842885, -4.494519960398929, -12.317278099313555, 12.496275782863979, -11.360759227840976, -6.343230410818153, 2.8248071935301295, 13.83875840949216, 0.3891101988117617, 2.5031707309004614, -0.8110832535878589, -14.185566421371107, -2.67937157564541, -1.093563972940872, 2.773065675628835, -4.186867691796638, 6.186607437711531, 4.662330288727452, -5.188135984156823, -1.2480893169433864, 2.4486323741936915, 4.259585500738997, -6.449510285426216, 1.2250153967982145, 0.7257796700208601, -9.52603297144913, -2.5227486025387886, 6.863442428636572, 3.0038048770805537, -7.204656762904568, 2.2934078204898083, 1.931217195180747, -4.198055047018539, 5.834205748221634, 3.0261795875243567, -1.882272516084928, -2.7227225771302783, -2.353539854807529, -1.0802789886148638, -6.829880362970868, -2.8038309024890644, -9.268723801345395, 0.044967923919283774, -5.042700366272102, 1.9284203563752715, -4.992357267773546, -2.2962046592952836, 4.069400461966672, -1.8850693548904034, -0.8768089655165303, -3.129662623326946, -5.067871915521381, 1.2355035423187473, -2.9003218412779646, 9.425346774452017, -12.417964296310668, 5.512569285591965, 3.6274999307015623, 1.2732608661926648, -4.732251258864336, 6.566977515256182, 9.576376069947687, -7.8143676224982, 3.6358904471179887, 2.9786333278312753, 3.6666556739782177, -11.310416129342421, -3.445705408345663, -4.455364217122273, 2.9366807457491446, -2.0151223593450083, -2.3689224682376433, -10.460177132477906, 4.771407002140991, 0.9851864692287011, 5.2356822438499035, 10.331522547426038, 6.3823861540948075, 3.921168005276477, 0.20451883765038686, -2.5884743144674607, -4.410614796234667, -0.5827912860909314, 2.9031186800834403, 6.824286685359917, 7.791992912054397, 1.707470090742717, -5.258056954293706, -7.249406183792174, 2.911509196499866, 6.063546530270614, -0.1873881999668502, -6.611726936143789, -0.5251064857280018, 6.566977515256182, 3.5463916053427766, 2.7311130935467043, -0.4471446040253757, -1.5690265698716859, 8.010146338881476, -4.676314482754829, -5.056684560299479, -1.3054245124556316, 2.7339099323521796, -14.66662269591287, 4.4078179574291925, 1.2662687691789765, 2.431851341360839, 0.16510089073571826, 4.855312166305252, -7.831148655331052, -9.626719168446243, 3.406549665069008, -0.3130711437878999, -9.38059735356441, -3.722592450087725, -0.13153882507001377, -9.408565741619164, 4.981169912551644, -12.328465454535458, 10.34270990264794, -0.662850796897664, 0.09622873515088715, 0.03128963413625577, 5.157370757296593, 5.023122494633775, 8.384922738815177, 9.934371437048535, 6.656476357031394, 13.212266517065675, -8.71494971786127, -2.925493390527243, 6.097108595936319, -0.6485169980196028, -1.9689745190546646, 2.883540808445112, 9.01141463124166, 3.076522686022913, -0.9956746147492338, -3.1855993994364535, 0.6492162077209715, -0.9712022752013243, -0.260980021035921, -5.2524632766827555, -2.4919833756785597, 8.731730750694123, -7.618588906114924, 3.2918792740445175, 1.4585514370554085, -8.798854882025532, -5.845393103443535, -1.9116393235424192, 4.184070852991162, 11.047513281627733, -6.147451694434876, -8.1891440224319, -0.9439330968479394, -6.785130942083262, -1.8347262563918465, -4.125337238076179, 1.6179712489675049, -6.270512601875792, -10.71189262497069, 5.6580049034766855, -5.557318706479571, 6.712413133140902, -2.553513829399018, -5.143386563269217, 7.137532631573158, 3.476470635205892, 4.782594357362893, 1.603987054940128, -0.842547690149457, 2.754886223393245, -6.3208557003743495, 4.5140978320372565, -5.325181085625116, -8.452046870146585, -2.47380392344297, 1.1341181356202648, 11.293635096509567, 3.593937865035858, 0.591531407358042, 2.5129596667196252, 7.9933653060486245, 10.437802422034103, 2.8276040323356053, 2.167550074243416, 1.2683663982830828, -0.28055789267424863, 10.616800105584527, 6.511040739146674, 13.458388331947507, 7.976584273215771, -12.160655126206935, -1.017350115491668, -5.216104372211576, -0.11965226014674343, -2.4807960204566584, -2.1717453324516294, 2.2780252070596934, 3.71979561128225, 5.204917016989675, -3.3534097277649755, 7.372467091233091, -6.164232727267729, -0.5712543260183455, 5.565709222895999, 3.238739336740485, 8.295423897039964, 4.709876548420533, -6.494259706313823, -3.437314891929237, -1.95359190562455, 0.6153045372045827, 0.6583059338387666, 4.955998363302365, 6.785130942083262, 0.3461088021775778, -0.9061757729740217, 12.406776941088767, 0.2896476187920436, -2.4849912786648716, 1.8291325787808956, -2.1619563966324655, 9.82809156244047, 7.534683741950662, -1.8515072892246986, 13.615011305054129, 7.1655010196279125, -8.597482488031304, -5.079059270743282, 6.718006810751852, -7.495527998674007, -2.675176317437197, 9.811310529607619, 2.3199777891418245, 4.186867691796638, -5.425867282622229, 0.6873231364455736, 2.2416663025885137, 1.738235317602946, 2.905915518888915, -0.8131808826919655, -1.0278382610122005, -14.487625012362447, -0.34593399975223554, -5.350352634874394, -1.6417443788140456, -1.5060976967484898, -1.8137499653507811, 0.761439364790671, 0.8194737700042851, 2.2794236264624312, -7.7528371687777415, -0.6663468454045083, 0.15382613430114567, 3.842856518723166, 1.4312822587020235, 12.56339991419539, -4.170086658963785, 10.622393783195477, -3.1464436561597977, 3.4624864411785152, -2.022114456358697, -2.3689224682376433, 5.045497205077577, 7.489934321063056, -1.6641190892578486, -0.5841897054936691, -3.97990162019146, -6.723600488362804, 10.499332875754561, -3.0681321696064874, 0.4985365170759857, 13.603823949832227, 4.9196394588311865, -5.090246625965184, -11.349571872619075, 1.2676671885817141, 1.1851604438201906, 0.31149792195981996, 2.142378524994138, -4.181274014185687, 0.31062390983310895, 4.024651041079066, -8.228299765708556, 2.450030793596429, 7.036846434576046, 0.10252162246320674, 1.057205068469692, 0.48734916185408417, 1.545253440025145, 6.432729252593365, -2.6192395413276897, -12.328465454535458, 0.560066970796444, -8.653419264140812, 5.081856109548758, 3.543594766537301, 3.076522686022913, -6.550196482423331, 1.8543041280301744, -2.7814561920452614, 2.5297406995524776, 10.650362171250231, 4.835734294666924, 1.500504019137539, -12.05996892920982, 1.8766788384739774, -3.784122903808184, -4.019057363468115, -8.983446243186908, 3.901590133638149, -3.585547348619432, 3.219161465102158, 0.396801505526819, -8.172362989599048, 0.299086949760523, -8.9275094670774, -7.534683741950662, 2.553513829399018, 7.2382188285702735, -2.984227005442226, 11.288041418898617, -1.3739470631897783, 2.662590542812558, 1.1774691371051333, -0.05978242946703616, -1.9647792608464516, 1.3543691915514509, -12.13828041576313, 3.842856518723166, -5.000747784189972, 2.208104236922809, -0.19455509940588084, 3.518423217288023, 8.899541079022645, -5.1909328229622975, 1.6151744101620298, -7.3780607688440405, 2.931087068138194, 2.724120996533016, 5.090246625965184, 0.5922306170594108, 7.887085431440559, 1.9200298399588456, 13.905882540823567, 3.946339554525755, 1.9969429071094185, -5.68597329153144, 1.8584993862383872, 0.9061757729740217, -7.764024523999643, 7.635369938947776, -5.602068127367177, -8.832416947691236, -0.8306611252261866, 4.595206157396042, 7.585026840449219, 1.0089595990752418, -0.8194737700042851, 5.649614387060259, -7.422810189731647, -7.646557294169677, -2.809424580100015, 4.6343619006726975, 14.856807734685196, 2.7674719980178843, -3.3366286949321236, -0.8817034334261122, 0.6366304330963324, -9.168037604348282, -0.9816904207218569, 7.21584411812647, 12.004032153100312, -0.4572831446952239, 4.8385311334724, 9.268723801345395, 0.8935899983493827, 6.745975198806606, 4.304334921626603, -2.3059935951144475, -1.4256885810910727, 5.445445154260557, 1.6375491206058328, -1.0879702953299213, -8.021333694103378, 3.0653353308010116, 0.6757861763729877, 1.492113502721113, -6.063546530270614, 2.707339963700164, 0.5855881248964068, 1.612377571356554, 1.4893166639156377, -14.73374682724428, -1.5969949579264395, 1.9270219369725337, 0.4509902573829044, 2.662590542812558, -11.075481669682489, 0.33806789061183606, -5.241275921460854, -2.7367067711576554, -4.444176861900372, 7.36687341362214, 5.157370757296593, -5.66080174228216, -7.126345276351258, 1.5732218280798989, 15.941981191209642, 1.2068359445626247, 8.748511783526975, -5.862174136276388, -3.174412044214552, 7.646557294169677, -0.2753138199139823, -7.322123992734534, 14.20794113181491, 0.26814692047495164, -6.3208557003743495, 4.735048097669811, -5.677582775115013, -7.417216512120698, 5.118215014019938, 5.034309849855676, -1.7899768355042405, -0.4030943928391385, 5.369930506512722, 3.4401117307347127, 2.132589589174974, 8.1891440224319, -4.116946721659753, -1.71166534895093, -3.8512470351395924, 5.934891945218747, 10.650362171250231, 1.5186834713731292, 3.4568927635675646, -3.565969476981104, -4.360271697736111, -14.532374433250052, 2.136784847383187, -4.209242402240441, 8.541545711921797, -0.8726137073083172, 4.430192667872996, -3.512829539677072, 3.3198476620992716, 11.013951215962031, 3.2667077247952387, -0.9292496931191936, 8.905134756633597, -5.375524184123672, -1.738235317602946, -2.908712357694391, 5.6440207094493084, 6.3823861540948075, -1.5298708265950305, 3.1072879128831428, 1.943802969805386, -0.7705290909084661, -10.359490935480792, 2.7017462860892127, 3.389768632236155, 6.091514918325368, 2.222088430950186, 16.64678457018944, 0.8446453192535635, 4.1365245932980805, -2.167550074243416, 2.0165207787477457, 0.8376532222398752, -4.684704999171254, 7.176688374849814, 2.7940419666699006, -7.44518490017545, -1.4040130803486386, 4.933623652858563, 4.2120392410459155, -11.825034469549887, 2.462616568221068, 8.597482488031304, -2.835994548752031, -1.8668899026548131, -4.709876548420533, -5.188135984156823, -3.280691918822616, -4.1365245932980805, -3.9435427157202794, -4.460957894733225, 13.76044692293885, -3.0569448143845857, -3.814888130668413, 11.220917287567207, 3.252723530767862, 3.750560838142479, -7.6633383270025295, -5.739113228835471, -13.77163427816075, -7.691306715057284, -7.998958983659574, 6.61732061375474, 10.090994410155155, 1.2208201385900015, 3.280691918822616, -3.742170321726053, -0.9691046460972177, 3.826075485890314, -1.3725486437870407, -2.743698868171344, -3.593937865035858, 2.1046212011202203, 3.812091291862937, -2.2206900115474486, 8.48560893581229, -4.329506470875882, 12.988519412627646, 2.6052553473003126, -0.5946778510142018, -2.5437248935798547, 2.9730396502203242, -5.202120178184199, 8.088457825434787, -10.11896279820991, -12.966144702183843, 0.9914793565410207, 9.945558792270436, -3.71979561128225, -5.381117861734623, 5.193729661767772, 4.086181494799524, -3.0121953934969796, -6.3656051212619555, -0.4866499521527154, -4.189664530602113, 0.7292757185277042, 17.597709764051064, -2.055676522024401, -0.09334449513274067, -9.788935819163815, -10.437802422034103, -0.45064065253221997, -2.961852294998423, 3.663858835172743, -10.365084613091742, 4.818953261834073, -2.508764408511412, 4.665127127532927, 4.5140978320372565, -2.609450605508526, 3.8820122619998214, 4.295944405210177, -4.958795202107841, 17.41871208050064, 5.227291727433477, -5.8397994258325845, 3.0961005576612415, 8.547139389532749, -6.376792476483857, -3.890402778416248, 4.248398145517096, -4.5728314469522395, 2.4891865368730843, 5.011935139411873, -2.238869463783038, -7.786399234443446, -2.84298664576572, 4.284757049988276, 0.3184900189735084, -1.4795277280964738, -0.39470387642271243, -9.039383019296416, 14.521187078028152, -6.3264493779853, 4.119743560465229, 5.227291727433477, 1.3585644497596636, -1.2872450602200418, 2.4933817950812975, -5.143386563269217, -4.0777909783830975, 2.6919573502700493, 11.992844797878412, 4.698689193198632, 6.667663712253296, -3.786919742613659, 4.4525673783167985, 7.568245807616368, 4.251194984322572, -10.180493251930368, 7.713681425501086, 4.642752417089124, -3.960323748553132, -1.4739340504855232, -5.2524632766827555, -9.481283550561525, -5.12940236924184, 1.9997397459148936, -13.782821633382651, -11.030732248794882, 3.9435427157202794, 0.5429363331129073, 1.079579778913495, -4.31831911565398, 3.4261275367073356, 4.57842512456319, -3.798107097835561, 6.091514918325368, 14.129629645261598, 2.405281372708823, 1.1893557020284036, 3.2611140471842885, -8.955477855132152, 4.4637547335387, -7.534683741950662, -2.08084807127368, 0.23808090331609139, -1.151598378154486, -1.6529317340359473, 4.0022763306352624, -10.521707586198364, -4.726657581253385, 2.0542781026216637, 5.308400052792264, 5.3419621184579675, -3.196786754658355, -6.891410816691326, 4.421802151456569, 0.9285504834178248, -2.8150182577109657, -9.649093878890046, 9.072945084962118, -0.2132589589174974, 5.272041148321083, 5.862174136276388, 2.652801606993394, 5.241275921460854, -3.417737020290909, 0.900582095363071, 1.259276672165288, 9.749780075887161, 5.0846529483542335, 1.4361767266116054, -6.02998446460491, -7.355686058400238, -8.289830219429014, -0.6614523774949264, 1.1152394736833062, 2.163354816035203, 3.3058634680718946, 0.5296513487868992, -6.147451694434876, 5.630036515421931, -5.9516729780516, 7.042440112186996, 4.68750183797673, -2.6136458637167386, -4.472145249955126, 5.1601675961020685, -4.570034608146764, -1.0690916333929625, -4.234413951489719, -4.321115954459455, -6.751568876417556, 0.43560764395278984, 12.86545850518673, 2.2640410130323168, -4.684704999171254, -13.301765358840887, 16.624409859745633, -3.4876579904277936, -0.2819563120769863, -6.007609754161107, 4.189664530602113, -9.811310529607619, -3.375784438208778, 2.370320887640381, 3.2750982412116656, 2.3591335324184795, 3.227551981518584, -4.9196394588311865, 0.5992227140730992, -9.268723801345395, 4.922436297636661, -3.1548341725762237, 4.4637547335387, 6.6229142913656895, -3.700217739643922, -0.7278772991249665, -2.9786333278312753, 2.3171809503363487, 1.447364081833507, -0.9180623378972921, 4.992357267773546, -3.0261795875243567, 8.731730750694123, -8.597482488031304, 0.5460827767690671, -4.620377706645321, 5.744706906446422, 6.466291318259069, 4.788188034973843, 3.345019211348549, -2.201112139909121, -1.756414769838536, -2.787049869656212, 2.9031186800834403, -2.405281372708823, -2.60665376670305, -8.496796291034192, 3.0513511367736355, 8.429672159702783, 3.960323748553132, -12.988519412627646, -11.23769832040006, -2.4122734697225114, 8.161175634377146, -0.06450209495127586, 9.660281234111949, 1.8137499653507811, 2.596864830883886, 6.99769069129939, 1.1446062811407975, -11.813847114327988, -1.5732218280798989, 4.807765906612171, -5.649614387060259, 10.398646678757448, -26.558781296794173, -5.196526500573248, -5.934891945218747, 6.790724619694213, -10.504926553365511, 5.655208064671211, 0.6257926827251153, 3.549188444148252, -1.0467169229491595, -5.313993730403213, -1.815148384753519, -13.3912642006161, -2.4486323741936915, 10.12455647582086, 5.218901211017052, 2.7003478666864753, -10.566457007085969, 4.377052730568963, 4.91124894241476, -5.850986781054486, -4.466551572344175, -0.7009577256222661, -2.6178411219249518, 0.8187745603029164, -8.133207246322392, 0.3912078279158682, -8.64223190891891, 8.161175634377146, -1.0019675020615535, 0.5163663644608913, -12.115905705319328, -1.9647792608464516, -3.691827223227496, -0.5030813801348832, -4.754625969308139, 6.074733885492517, 3.599531542646808, 2.6178411219249518, -9.537220326671031, 1.1481023296476418, -1.967576099651927, -4.273569694766374, -6.913785527135129, -6.304074667541498, 9.766561108720012, 11.590100009889957, 4.27636653357185, -0.8642231908918911, -5.081856109548758, 3.700217739643922, -2.069660716051778, -1.155793636362699, 1.7228527041728314, -5.767081616890224, -3.708608256060349, -8.094051503045737, 5.912517234774944, -9.067351407351168, 3.476470635205892, 3.700217739643922, -9.688249622166701, -0.5523756640813867, 4.701486032004107, -6.203388470544383, -10.795797789134951, 5.713941679586193, -5.43146096023318, -5.7950500049449785, -2.356336693613004, -0.3646378592638521, 6.986503336077488, 3.135256300937896, -11.668411496443268, -3.1464436561597977, 1.5955965385237019, -12.384402230644966, -4.561644091730338, 4.35467802012516, 6.069140207881565, 8.021333694103378, 3.1995835934638297, 2.5688964428291325, -13.290578003618986, -0.5188135984156822, 0.37792284358986017, 0.587336149149829, 4.402224279818242, -1.7941720937124535, 14.196753776593008, 0.13014040566727608, 2.521350183136051, -17.70958331627008, -7.433997544953549, 5.425867282622229, -2.6933557696727872, -5.43146096023318, -1.1236299900997322, 1.4977071803320636, -8.64223190891891, 0.6740381521195655, 4.458161055927749, -2.187127945881744, 5.73351955122452, -4.02185420227359, 3.638687285923464, -3.104491074077667, -1.7312432205892576, -3.468080118789466, 0.5006341461800923, 0.968405436395849, -0.03629335356167655, -3.909980650054575, 11.148199478624848, -1.357865240058295, 6.236950536210088, -1.4145012258691714, -9.341441610287756, -5.411883088594852, 0.9390386289383574, 12.831896439521024, 7.540277419561614, 1.465543534069097, -3.549188444148252, -0.8600279326836782, 7.551464774783515, 2.8695566144177356, 3.001008038275078, 3.2023804322693055, -6.857848751025622, -10.806985144356851, 0.721584411812647, 12.775959663411516, -9.145662893904479, 6.499853383924774, 2.189924784687219, -12.921395281296238, 4.35467802012516]
    image_embedding_tensor = torch.tensor(image_embedding_list)
    normalized_tensor = torch.nn.functional.normalize(image_embedding_tensor, p=2, dim=0)
    image_embedding_tensor = torch.unsqueeze(image_embedding_tensor, 0)
    negative_image_embedding = None
    prompt_generation_policy = "top-k"

    # Generate img2img generation jobs with Kandinsky using the embeddings
    response = generate_img2img_generation_jobs_with_kandinsky(
        image_embedding=image_embedding_tensor,
        negative_image_embedding = None,  
        dataset_name="test-generations",
        prompt_generation_policy=prompt_generation_policy
    )

    print(response)