import io
import sys
import os
import uuid
import torch


base_directory = os.getcwd()
sys.path.insert(0, base_directory)

from utility.http import generation_request
from utility.http import request
from utility.minio.cmd import connect_to_minio_client, upload_data
from worker.generation_task.generation_task import GenerationTask
from kandinsky_worker.dataloaders.image_embedding import ImageEmbedding

def read_msgpack_file(file_path):
    """Reads a msgpack file and returns its bytes."""
    with open(file_path, "rb") as f:
        return f.read()

def generate_img2img_generation_jobs_with_kandinsky(image_embedding,
                                                    negative_image_embedding,
                                                    dataset_name,
                                                    prompt_generation_policy,
                                                    self_training= False,
                                                    init_img_path="./test/test_inpainting/white_512x512.jpg"):

    # get sequential ids
    sequential_ids = request.http_get_sequential_id(dataset_name, 1)

    count = 0
    # generate UUID
    task_uuid = str(uuid.uuid4())
    task_type = "img2img_generation_kandinsky"
    model_name = "kandinsky_2_2"
    model_file_name = "kandinsky-2-2-decoder"
    model_file_path = "input/model/kandinsky/kandinsky-2-2-decoder"
    task_input_dict = {
        "strength": 0.75,
        "seed": "",
        "dataset": dataset_name,
        "file_path": sequential_ids[count]+".jpg",
        "init_img": init_img_path,
        "num_images": 1,
        "image_width": 512,
        "image_height": 512,
        "decoder_steps": 100,
        "decoder_guidance_scale": 12,
        "self_training": self_training
    }

    prompt_generation_data={
        "prompt_generation_policy": prompt_generation_policy
    }

    image_embedding= image_embedding.detach().cpu().numpy().tolist()[0]
    negative_image_embedding= image_embedding.detach().cpu().numpy().tolist()[0] if negative_image_embedding is not None else None

    # create the job
    generation_task = GenerationTask(uuid=task_uuid,
                                     task_type=task_type,
                                     model_name=model_name,
                                     model_file_name=model_file_name,
                                     model_file_path=model_file_path,
                                     task_input_dict=task_input_dict,
                                     prompt_generation_data=prompt_generation_data)
    generation_task_json = generation_task.to_dict()

    # add job
    response = generation_request.http_add_kandinsky_job(job=generation_task_json,
                                                         positive_embedding=image_embedding,
                                                         negative_embedding=negative_image_embedding)

    return response


if __name__ == "__main__":
    image_embedding_list = [-11.34863959301725, 3.393497750643456, -13.312952714062789, -5.984302764115479, 4.09830112962325, 5.994091699934643, -3.130827972829227, 3.1634577588931063, -14.513728841213549, -5.455700229880634, -5.671056817902237, -13.09107016882841, 3.090040740249378, 2.5679641632273076, 7.07413761864905, 6.91751464554243, -3.269504563600714, 2.00999482153497, 5.563378523891435, 0.22616520465526396, -5.142454283667391, 1.7571139795399047, -7.563584409607242, -4.626903663858096, 4.228820273878768, -0.5110640242255109, 6.865306987840222, -7.530954623543362, -10.076077936525955, 1.5229952645315703, -3.902522413239974, -15.54483008083214, -5.759157240274711, -8.131342687118742, 6.499853383924774, 0.5147348751576973, 4.0004117714316125, -0.7504850794692258, 2.1095156690298023, 11.002763860740128, 6.708684014733602, 2.0312041824764915, -3.06230542209508, -1.5711241989757925, 5.171821091124882, 2.522282462737876, -18.220472538070247, -8.51637416267252, -0.76557635552377, -7.21770867733012, 3.014992232302455, -10.833088973207957, -7.478746965841156, -4.4637547335387, 1.0784144294112137, 5.1620321553057185, -10.578576641909695, -2.365659489631255, 1.4977071803320636, 3.6741139107928187, -2.0426246075988495, -0.27531381991398235, 27.487331780211992, -3.6186432744842234, 2.075254393662729, 0.6477012533680058, 2.7180611791211526, -3.0280441467280066, -6.385649132701196, 2.522282462737876, 6.421541897371463, 4.982568331954382, 9.475689872950573, 0.17212212148696376, -6.34649338942454, 2.267770131439617, 9.93903283505766, 1.8305309981836335, 6.7739435868613604, -14.239638638276965, -10.343642182249765, -2.00999482153497, -6.339967432211764, -0.6342414666166556, -2.8485803233766704, 6.8196252873507905, 17.25463087057942, 10.402375797164748, 3.7720032689844567, 7.406961436500621, -0.8524531609188488, 1.3916603756244557, -10.57205068469692, 4.11461602265519, -6.516168276956713, 0.26511701176902, -3.7361105043141896, 5.6808457537214005, -10.291434524547558, -9.129814140673451, -6.786995501286912, -6.069140207881565, -2.489652676673997, -9.390852429184486, 13.939444606489273, -0.4462123244235506, -5.644952989051133, 1.8109531265453058, -12.37974083263584, 4.783526636964718, -6.571638913265309, -7.811570783692725, 4.976042374741606, -7.902934184671587, -1.6616718553030576, -3.4489683869520507, 11.779352769060457, 2.081780350875505, 1.8664237628539007, -1.961050142439151, 3.48159817301593, -6.767417629648584, -3.4391794511328873, 6.052825314849626, -6.069140207881565, -0.45436977093952047, -0.6525957212775877, 8.046505243352657, 8.294491617438139, 1.7326416399919953, 0.48903891863239224, -7.576636324032793, 2.372185446844031, -1.7342731292951892, -8.170498430395398, -10.598154513548025, 0.133374250536107, 1.489549733816094, -4.228820273878768, -9.05150265412014, 20.204363530754115, 15.988595171300899, -2.372185446844031, -2.127462051364936, -5.755894261668323, -10.389323882739196, 13.123699954892288, 7.9812456712248965, -2.4113411901206865, 4.956464503103279, -4.581221963368666, -4.228820273878768, -1.4047122900500075, 17.77670744760149, -6.702158057520825, 3.7948441192291726, -2.434182040365402, -5.367599807508158, 9.534423487865556, -2.9921513820577395, -0.1687571747991262, -0.5852967875208365, 5.367599807508158, -7.1067674047129294, 6.137662758615712, -7.008878046521292, 2.801267133584045, -6.2910227531159455, -6.58469082769086, 0.19384132283573347, -2.845317344770282, -0.29489169155230993, -0.31977190342601797, 2.589173524168829, -7.530954623543362, -3.129196483526033, 7.641895896160553, -5.38065172193371, 4.600799835006993, -1.7456935544175471, -6.627109549573903, 9.795461776376591, 0.14958717548659706, -10.30448643897311, -2.225351409556574, 0.744774866908047, 5.72979043281722, -2.44560246548776, -1.7065378111408918, 5.45896320848702, -6.323652539179825, 2.868158195014998, 8.672997135779141, 11.20506853433618, -1.3549518663025915, -1.8843701451890347, -8.066083114990983, -3.7883181620163966, -7.589688238458345, 19.682286953732046, -1.7815863190878143, 0.9372906046849353, -25.68616758948585, -3.142248397951585, -2.049150564811625, 4.8520491876988645, -1.264404209975326, -6.617320613754739, 38.137693951462225, -2.701746286089213, -6.88488485947855, 6.111558929764609, 0.2165802049989994, -6.075666165094342, 5.984302764115479, -1.3467944197866215, -5.674319796508625, -7.909460141884362, -2.127462051364936, 0.40542509184370135, 7.263390377819551, -2.9529956387810845, -15.962491342449793, 4.7704747225391655, 5.7624202188811, -4.013463685857165, -1.9953114178062241, 1.1395952782809875, 16.73255429355735, -8.314069489076468, 17.8550189341548, 0.9201599670013986, -1.007444644722276, 2.319977789141824, -0.8267572043935438, 6.715209971946377, -3.178141162621852, 11.296431935315043, 3.0818832937334077, -4.936886631464951, -1.536862923608719, -7.55053249518169, -10.213123037994247, 4.480069626570639, 7.544006537968913, -3.280924988723072, -5.573167459710598, 1.4169484598239621, 8.177024387608174, 10.709095786165214, 0.8785569897699523, 19.86501375568977, -15.140220733640033, 8.823094151672986, -6.852255073414671, -11.081075347293439, -9.136340097886228, 2.4080782115142987, -11.446528951208888, 1.0816774080176017, 0.6244525307974917, -11.342113635804473, -9.064554568545693, -0.9968399642515152, -14.422365440234687, -11.322535764166147, -13.286848885211686, 2.2204569416469924, 8.092186943842087, -5.778735111913039, -16.928333009940626, 1.4748663300873481, -2.383605871966389, 4.646481535496425, -6.170292544679591, -3.971044963974121, -10.55899877027137, 12.321007217720854, 6.88488485947855, 9.19507371280121, -11.309483849740595, 7.204656762904568, -3.297239881755012, 5.321918107018727, 10.82656301599518, -2.669116500025334, 8.614263520864156, 1.905579506130556, 8.960139253141278, 12.197014030678114, 2.6413811818710364, -27.67005858216972, -8.999294996417934, -7.889882270246035, -1.5270739877895552, -6.398701047126748, 3.225454352414477, 0.37197956112822494, -6.904462731116878, 3.1634577588931063, 4.982568331954382, 0.21005424778622353, 2.0377301396892675, 7.243812506181223, 8.659945221353588, -4.682374300166692, -3.9743079425805092, 2.4260245938494323, -7.2111827201173435, 2.56470118462092, -17.58092873121821, -0.1850720678310659, 10.454583454866954, -4.982568331954382, 13.900288863212618, -7.498324837479482, -6.199659352137083, 8.033453328927104, -4.326709632070407, 7.028455918159619, 1.596412283175299, -12.210065945103667, 0.4743555149036466, 0.4743555149036466, -21.613970288713706, 1.7244841934760253, 11.479158737272767, 0.8736625218603705, 4.068934322165759, 1.0702569828952437, 0.4347918993011928, 4.228820273878768, 3.7197956112822497, -2.1095156690298023, -10.454583454866954, 0.5963093403173957, 21.52260688773484, 2.285716513774751, -17.48956533023935, -1.8288995088804394, 31.194075477068687, 0.4600799835006993, -14.487625012362447, 17.306838528281627, 0.43601551627858826, -4.646481535496425, -8.066083114990983, 7.837674612543828, 8.203128216459277, -1.9039480168273624, 8.89487968101352, -2.0165207787477457, -12.50373401967858, -1.7701658939654565, -5.723264475604444, -5.152243219486555, -5.902728298955781, 4.6791113215603035, 0.8385855018417002, 0.952789753065278, -6.6010057207227995, -2.489652676673997, 20.360986503860737, 5.736316390029996, -8.783938408396331, 4.760685786720002, -6.8783589022657745, 7.07413761864905, -9.684520503759401, 10.036922193249298, -1.8223735516676636, -4.010200707250776, -7.067611661436275, 6.542272105807816, 3.8046330550483365, -12.653831035572425, -12.921395281296236, -1.5009701589384516, -9.025398825269038, 14.06996375074479, 11.903345956103198, 2.081780350875505, -8.796990322821882, -3.589276467026732, 3.067199890004662, 5.354547893082607, 12.810454008679045, -0.7035797620023992, 16.093010486705314, -0.9152654990918168, -12.438474447550822, 11.518314480549423, -7.6027401528838965, 1.0702569828952437, 1.9545241852263753, 3.79810709783556, -16.758658122408452, 5.628638096019194, 4.05261942913382, -3.130827972829227, -1.9023165275241682, -20.38709033271184, -8.666471178566365, -6.813099330138016, -4.6562704713155885, -6.411752961552299, 7.276442292245103, 8.046505243352657, 6.627109549573903, 0.22392190686337227, -5.178347048337658, 2.863263727105416, 7.485272923053931, 3.8046330550483365, -5.2436066204654175, -14.37015778253248, 14.578988413341309, -13.254219099147805, -7.400435479287845, 3.295608392451818, 16.14521814440752, 0.45396189861372194, 2.9203658527172047, -0.9462637958525021, -16.549827491599622, -3.125933504919645, -1.275824635097684, 3.235243288233641, -4.884678973762744, 7.21770867733012, 5.4393853368486935, -6.052825314849626, -1.4561042031006175, 2.85673776989264, 4.96951641752883, -7.524428666330586, 1.429184629597917, 0.8467429483576701, -11.11370513335732, -2.94320670296192, 8.007349500076, 3.504439023260646, -8.40543289005533, 2.6756424572381095, 2.2530867277108717, -4.8977308881882955, 6.806573372925239, 3.5305428521117497, -2.1959846020990827, -3.176509673318658, -2.7457964972754505, -1.260325486717341, -7.968193756799346, -3.271136052903908, -10.813511101569627, 0.05246257790583107, -5.883150427317453, 2.2498237491044835, -5.82441681240247, -2.6789054358444973, 4.74763387229445, -2.1992475807054706, -1.0229437931026188, -3.651273060548103, -5.912517234774944, 1.441420799371872, -3.383708814824292, 10.996237903527351, -14.487625012362447, 6.431330833190627, 4.232083252485157, 1.485471010558109, -5.5209598020083925, 7.66147376779888, 11.1724387482723, -9.1167622262479, 4.24187218830432, 3.4750722158031544, 4.277764952974587, -13.195485484232824, -4.01998964306994, -5.197924919975986, 3.4261275367073356, -2.3509760859025097, -2.763742879610584, -12.20353998789089, 5.566641502497823, 1.1493842141001513, 6.108295951158221, 12.053442971997045, 7.446117179777275, 4.5746960061558894, 0.238605310592118, -3.0198867002120373, -5.145717262273779, -0.6799231671060867, 3.3869717934306802, 7.96166779958657, 9.090658397396798, 1.9920484391998365, -6.134399780009324, -8.457640547757537, 3.3967607292498436, 7.07413761864905, -0.21861956662799187, -7.713681425501087, -0.6126242333493355, 7.66147376779888, 4.1374568728999055, 3.186298609137822, -0.5216687046962716, -1.8305309981836335, 9.345170728695056, -5.455700229880634, -5.8994653203493925, -1.5229952645315703, 3.1895615877442096, -17.111059811898347, 5.142454283667391, 1.4773135640421393, 2.8371598982543125, 0.19261770585833798, 5.664530860689461, -9.136340097886228, -11.231172363187284, 3.9743079425805092, -0.36524966775254986, -10.944030245825145, -4.343024525102345, -0.15346196258168274, -10.976660031889026, 5.811364897976918, -14.383209696958033, 12.066494886422596, -0.7733259297139414, 0.112266857676035, 0.03650457315896506, 6.016932550179359, 5.860309577072737, 9.78240986195104, 11.590100009889957, 7.765889083203294, 15.414310936576621, -10.167441337504815, -3.4130756222817835, 7.113293361925706, -0.7566031643562032, -2.2971369388971086, 3.3641309431859643, 10.513317069781937, 3.589276467026732, -1.1616203838741062, -3.7165326326758623, 0.7574189090078002, -1.1330693210682117, -0.3044766912085745, -6.127873822796548, -2.907313938291653, 10.187019209143143, -8.888353723800744, 3.8405258197186036, 1.7016433432313098, -10.265330695696454, -6.8196252873507905, -2.2302458774661558, 4.881415995156356, 12.888765495232356, -7.172026976840689, -9.554001359503884, -1.1012552796559294, -7.915986099097139, -2.1405139657904875, -4.812893444422209, 1.8876331237954225, -7.315598035521758, -12.497208062465804, 6.6010057207227995, -6.483538490892833, 7.831148655331052, -2.979099467632188, -6.000617657147419, 8.32712140350202, 4.055882407740207, 5.579693416923375, 1.8713182307634828, -0.9829723051743664, 3.2140339272921197, -7.374331650436741, 5.2664474707101325, -6.212711266562635, -9.86072134850435, -2.8861045773501317, 1.323137824890309, 13.175907612594495, 4.192927509208501, 0.6901199752510491, 2.9317862778395627, 9.325592857056728, 12.177436159039786, 3.298871371058206, 2.528808419950652, 1.47976079799693, -0.32731754145329006, 12.386266789848614, 7.59621419567112, 15.701453053938758, 9.3060149854184, -14.187430980574756, -1.1869084680736126, -6.085455100913505, -0.139594303504534, -2.8942620238661014, -2.533702887860234, 2.657696074902976, 4.339761546495959, 6.0724031864879535, -3.912311349059138, 8.601211606438607, -7.191604848479017, -0.6664633803547364, 6.493327426711998, 3.7785292261972327, 9.677994546546625, 5.494855973157288, -7.576636324032793, -4.010200707250776, -2.279190556561975, 0.7178552934053464, 0.768023589478561, 5.781998090519426, 7.915986099097139, 0.4037936025405074, -1.057205068469692, 14.474573097936894, 0.33792222192405086, -2.8991564917756834, 2.133988008577712, -2.522282462737876, 11.466106822847216, 8.790464365609106, -2.160091837428815, 15.884179855896484, 8.359751189565898, -10.030396236036522, -5.925569149200496, 7.837674612543828, -8.744782665119676, -3.121039037010063, 11.446528951208888, 2.706640753998795, 4.884678973762744, -6.3301784963926, 0.8018769925198359, 2.6152773530199327, 2.0279412038701037, 3.390234772037068, -0.9487110298072932, -1.1991446378475672, -16.90222918108952, -0.4035896663776081, -6.242078074020126, -1.91536844194972, -1.7571139795399047, -2.1160416262425783, 0.8883459255891162, 0.9560527316716659, 2.65932756420617, -9.044976696907364, -0.7774046529719264, 0.1794638233513366, 4.4833326051770275, 1.6698293018190276, 14.657299899894621, -4.865101102124417, 12.392792747061389, -3.670850932186431, 4.039567514708268, -2.3591335324184795, -2.763742879610584, 5.88641340592384, 8.7382567079069, -1.9414722708008234, -0.6815546564092807, -4.643218556890036, -7.844200569756604, 12.24922168838032, -3.5794875312075685, 0.58162593658865, 15.871127941470931, 5.739579368636384, -5.938621063626048, -13.241167184722254, 1.478945053345333, 1.3826871844568889, 0.36341424228645663, 2.499441612493161, -4.878153016549968, 0.3623945614719604, 4.695426214592243, -9.599683059993314, 2.858369259195834, 8.209654173672053, 0.11960855954040786, 1.2334059132146407, 0.5685740221630983, 1.8027956800293359, 7.504850794692259, -3.0557794648823045, -14.383209696958033, 0.6534114659291846, -10.095655808164281, 5.928832127806884, 4.134193894293517, 3.589276467026732, -7.641895896160553, 2.1633548160352034, -3.245032224052805, 2.9513641494778904, 12.42542253312527, 5.641690010444745, 1.7505880223271288, -14.06996375074479, 2.1894586448863067, -4.4148100544428805, -4.688900257379467, -10.480687283718058, 4.5518551559111735, -4.183138573389337, 3.7556883759525173, 0.46293508978128883, -9.534423487865556, 0.3489347747206102, -10.4154277115903, -8.790464365609106, 2.979099467632188, 8.444588633331986, -3.48159817301593, 13.16938165538172, -1.6029382403880748, 3.1063556332813174, 1.373713993289322, -0.06974616771154218, -2.292242470987527, 1.5800973901433593, -14.161327151723652, 4.4833326051770275, -5.834205748221634, 2.5761216097432773, -0.22698094930686097, 4.104827086836027, 10.38279792552642, -6.056088293456013, 1.8843701451890347, -8.607737563651382, 3.4196015794945596, 3.178141162621852, 5.938621063626048, 0.690935719902646, 9.201599670013985, 2.2400348132853196, 16.22352963096083, 4.604062813613381, 2.329766724960988, -6.633635506786679, 2.1682492839447853, 1.057205068469692, -9.058028611332917, 8.907931595439072, -6.535746148595041, -10.30448643897311, -0.9691046460972177, 5.361073850295383, 8.849197980524089, 1.1771195322544488, -0.9560527316716659, 6.591216784903636, -8.659945221353588, -8.920983509864623, -3.2776620101166842, 5.406755550784814, 17.33294235713273, 3.228717331020865, -3.8927334774208107, -1.0286540056637976, 0.7427355052790545, -10.696043871739663, -1.1453054908421665, 8.418484804480881, 14.00470417861703, -0.533497002144428, 5.644952989051133, 10.813511101569627, 1.0425216647409463, 7.870304398607708, 5.021724075231037, -2.690325860966855, -1.6633033446062515, 6.353019346637316, 1.9104739740401382, -1.269298677884908, -9.358222643120607, 3.57622455260118, 0.7884172057684856, 1.740799086507965, -7.07413761864905, 3.1585632909835244, 0.6831861457124746, 1.8811071665826464, 1.7375361079015772, -17.18937129845166, -1.8631607842475129, 2.2481922598012893, 0.5261553002800551, 3.1063556332813174, -12.921395281296236, 0.3944125390471421, -6.114821908370997, -3.192824566350598, -5.1848730055504335, 8.59468564922583, 6.016932550179359, -6.604268699329188, -8.314069489076468, 1.8354254660932154, 18.59897805641125, 1.4079752686563953, 10.206597080781473, -6.839203158989119, -3.7034807182503107, 8.920983509864623, -0.3211994565663127, -8.542477991523622, 16.575931320450728, 0.31283807388744356, -7.374331650436741, 5.52422278061478, -6.623846570967515, -8.653419264140814, 5.971250849689928, 5.873361491498289, -2.0883063080882804, -0.4702767916456616, 6.264918924264841, 4.013463685857165, 2.488021187370803, 9.554001359503884, -4.803104508603045, -1.9969429071094182, -4.493121540996191, 6.9240406027552055, 12.42542253312527, 1.7717973832686507, 4.033041557495491, -4.160297723144621, -5.086983647358796, -16.95443683879173, 2.492915655280385, -4.910782802613848, 9.965136663908764, -1.0180493251930367, 5.168558112518495, -4.09830112962325, 3.8731556057824834, 12.849609751955702, 3.811159012261112, -1.0841246419723927, 10.389323882739196, -6.271444881477618, -2.0279412038701037, -3.393497750643456, 6.58469082769086, 7.446117179777275, -1.7848492976942023, 3.625169231697, 2.267770131439617, -0.8989506060598771, -12.086072758060924, 3.1520373337707484, 3.954730070942181, 7.1067674047129294, 2.5924365027752168, 19.42124866522101, 0.9854195391291574, 4.825945358847761, -2.528808419950652, 2.3526075752057034, 0.9772620926131876, -5.465489165699797, 8.37280310399145, 3.2597156277815507, -8.68604905020469, -1.638015260406745, 5.755894261668323, 4.914045781220235, -13.795873547808203, 2.8730526629245796, 10.030396236036522, -3.3086603068773695, -2.1780382197639487, -5.494855973157288, -6.052825314849626, -3.8274739052930515, -4.825945358847761, -4.600799835006993, -5.204450877188762, 16.05385474342866, -3.566435616782017, -4.450702819113148, 13.09107016882841, 3.7948441192291726, 4.375654311166226, -8.94056138150295, -6.69563210030805, -16.066906657854208, -8.97319116756683, -9.332118814269503, 7.720207382713863, 11.77282681184768, 1.4242901616883352, 3.8274739052930515, -4.365865375347062, -1.1306220871134205, 4.4637547335387, -1.6013067510848806, -3.2009820128665676, -4.192927509208501, 2.455391401306924, 4.44743984050676, -2.590805013472023, 9.899877091781006, -5.051090882688529, 15.153272648065586, 3.039464571850365, -0.6937908261832354, -2.9676790425098303, 3.4685462585903784, -6.069140207881565, 9.436534129673918, -11.805456597911562, -15.127168819214484, 1.156725915964524, 11.60315192431551, -4.339761546495959, -6.277970838690393, 6.059351272062401, 4.767211743932778, -3.5142279590798093, -7.426539308138948, -0.5677582775115013, -4.887941952369132, 0.8508216716156549, 20.530661391392908, -2.3982892756951344, -0.10890191098819745, -11.420425122357784, -12.177436159039786, -0.5257474279542566, -3.4554943441648267, 4.274501974368199, -12.0925987152737, 5.622112138806418, -2.9268918099299808, 5.442648315455082, 5.2664474707101325, -3.0443590397599465, 4.5290143056664585, 5.011935139411873, -5.785261069125815, 20.321830760584078, 6.098507015339057, -6.813099330138016, 3.6121173172714482, 9.97166262112154, -7.439591222564499, -4.538803241485622, 4.956464503103279, -5.3349700214442795, 2.9040509596852653, 5.847257662647185, -2.6120143744135444, -9.084132440184021, -3.3168177533933396, 4.998883224986322, 0.3715716888024265, -1.7261156827792195, -0.4604878558264978, -10.545946855845818, 16.941384924366176, -7.380857607649517, 4.8063674872094335, 6.098507015339057, 1.584991858052941, -1.5017859035900487, 2.908945427594847, -6.000617657147419, -4.757422808113614, 3.140616908648391, 13.99165226419148, 5.481804058731737, 7.778940997628845, -4.418073033049269, 5.194661941369598, 8.829620108885761, 4.959727481709667, -11.877242127252096, 8.999294996417934, 5.4165444866039785, -4.620377706645321, -1.7195897255664436, -6.127873822796548, -11.061497475655111, -5.984302764115479, 2.3330297035673757, -16.07995857227976, -12.86918762359403, 4.600799835006993, 0.6334257219650585, 1.2595097420657444, -5.038038968262978, 3.9971487928252247, 5.341495978657055, -4.431124947474821, 7.1067674047129294, 16.484567919471864, 2.806161601493627, 1.3875816523664708, 3.8046330550483365, -10.448057497654178, 5.20771385579515, -8.790464365609106, -2.4276560831526264, 0.27776105386877326, -1.3435314411802337, -1.9284203563752718, 4.66932238574114, -12.275325517231424, -5.514433844795616, 2.396657786391941, 6.193133394924307, 6.232289138200962, -3.729584547101414, -8.03997928613988, 5.15876917669933, 1.0833088973207956, -3.2841879673294603, -11.257276192038388, 10.585102599122472, -0.2488021187370803, 6.150714673041264, 6.839203158989119, 3.09493520815896, 6.114821908370997, -3.987359857006061, 1.0506791112569163, 1.4691561175261691, 11.374743421868354, 5.932095106413272, 1.6755395143802063, -7.034981875372395, -8.581633734800278, -9.671468589333848, -0.7716944404107474, 1.3011127192971905, 2.5239139520410703, 3.8568407127505435, 0.6179265735847158, -7.172026976840689, 6.568375934658921, -6.943618474393533, 8.216180130884828, 5.468752144306185, -3.0492535076695284, -5.217502791614313, 6.020195528785746, -5.331707042837891, -1.2472735722917896, -4.940149610071338, -5.041301946869364, -7.876830355820482, 0.5082089179449214, 15.009701589384518, 2.6413811818710364, -5.465489165699797, -15.518726251981036, 19.395144836369905, -4.068934322165759, -0.328949030756484, -7.008878046521292, 4.887941952369132, -11.446528951208888, -3.938415177910241, 2.7653743689137777, 3.8209479480802764, 2.752322454488226, 3.765477311771681, -5.739579368636384, 0.6990931664186159, -10.813511101569627, 5.742842347242771, -3.6806398680055943, 5.20771385579515, 7.726733339926637, -4.316920696251242, -0.8491901823124609, -3.4750722158031544, 2.703377775392407, 1.688591428805758, -1.0710727275468408, 5.82441681240247, -3.5305428521117497, 10.187019209143143, -10.030396236036522, 0.637096572897245, -5.390440657752874, 6.702158057520825, 7.544006537968913, 5.58621937413615, 3.902522413239974, -2.5679641632273076, -2.049150564811625, -3.2515581812655805, 3.3869717934306802, -2.806161601493627, -3.0410960611535587, -9.912929006206557, 3.559909659569241, 9.834617519653246, 4.620377706645321, -15.153272648065586, -13.110648040466737, -2.814319048009597, 9.521371573440003, -0.07525244410982183, 11.27032810646394, 2.1160416262425783, 3.0296756360312007, 8.163972473182621, 1.3353739946642638, -13.782821633382651, -1.8354254660932154, 5.609060224380866, -6.591216784903636, 12.131754458550356, -30.985244846259867, -6.06261425066879, -6.9240406027552055, 7.922512056309915, -12.255747645593097, 6.597742742116412, 0.7300914631793012, 4.140719851506294, -1.221169743440686, -6.199659352137083, -2.117673115545772, -15.62314156738545, -2.85673776989264, 11.811982555124338, 6.088718079519893, 3.1504058444675542, -12.327533174933631, 5.106561518997124, 5.72979043281722, -6.826151244563567, -5.210976834401538, -0.817784013225977, -3.0541479755791103, 0.9552369870200691, -9.488741787376124, 0.4564091325685129, -10.082603893738728, 9.521371573440003, -1.168962085738479, 0.6024274252043732, -14.13522332287255, -2.292242470987527, -4.307131760432078, -0.5869282768240304, -5.547063630859496, 7.087189533074603, 4.199453466421277, 3.0541479755791103, -11.12675704778287, 1.3394527179222486, -2.2955054495939144, -4.98583131056077, -8.066083114990983, -7.354753778798414, 11.394321293506682, 13.521783344871617, 4.989094289167158, -1.0082603893738729, -5.928832127806884, 4.316920696251242, -2.4146041687270747, -1.3484259090898154, 2.00999482153497, -6.728261886371929, -4.326709632070407, -9.443060086886694, 6.897936773904101, -10.578576641909695, 4.055882407740207, 4.316920696251242, -11.302957892527818, -0.6444382747616179, 5.4850670373381245, -7.237286548968447, -12.595097420657442, 6.666265292850558, -6.3367044536053765, -6.760891672435808, -2.749059475881838, -0.42541083580782746, 8.15092055875707, 3.657799017760879, -13.613146745850479, -3.670850932186431, 1.8615292949443187, -14.448469269085793, -5.321918107018727, 5.0804576901460194, 7.080663575861826, 9.358222643120607, 3.7328475257078013, 2.9970458499673214, -15.505674337555483, -0.6052825314849626, 0.4409099841881702, 0.6852255073414671, 5.135928326454615, -2.0932007759978624, 16.562879406025175, 0.15183047327848878, 2.9415752136587265, -20.661180535648427, -8.672997135779141, 6.3301784963926, -3.142248397951585, -6.3367044536053765, -1.3109016551163544, 1.747325043720741, -10.082603893738728, 0.7863778441394932, 5.201187898582374, -2.551649270195368, 6.689106143095273, -4.692163235985856, 4.245135166910708, -3.6219062530906116, -2.019783757354134, -4.0460934719210435, 0.584073170543441, 1.1298063424618237, -0.04234224582195598, -4.561644091730337, 13.006232725062322, -1.5841761134013441, 7.276442292245103, -1.6502514301806999, -10.898348545335715, -6.3138636033606605, 1.0955450670947502, 14.970545846107862, 8.796990322821882, 1.7098007897472798, -4.140719851506294, -1.0033659214642912, 8.810042237247435, 3.347816050154025, 3.5011760446542577, 3.7361105043141896, -8.000823542863225, -12.608149335082993, 0.8418484804480881, 14.905286273980103, -10.669940042888559, 7.583162281245569, 2.554912248801756, -15.074961161512277, 5.0804576901460194]
    image_embedding_tensor = torch.tensor(image_embedding_list)
    normalized_tensor = torch.nn.functional.normalize(image_embedding_tensor, p=2, dim=0)
    image_embedding_tensor = torch.unsqueeze(image_embedding_tensor, 0)
    negative_image_embedding = None
    prompt_generation_policy = "top-k"

    # Generate img2img generation jobs with Kandinsky using the embeddings
    response = generate_img2img_generation_jobs_with_kandinsky(
        image_embedding=image_embedding_tensor,
        negative_image_embedding = None,  
        dataset_name="test-generations",
        prompt_generation_policy=prompt_generation_policy
    )

    print(response)