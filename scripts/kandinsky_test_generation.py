import io
import sys
import os
import uuid
import torch


base_directory = os.getcwd()
sys.path.insert(0, base_directory)

from utility.http import generation_request
from utility.http import request
from utility.minio.cmd import connect_to_minio_client, upload_data
from worker.generation_task.generation_task import GenerationTask
from kandinsky_worker.dataloaders.image_embedding import ImageEmbedding

def read_msgpack_file(file_path):
    """Reads a msgpack file and returns its bytes."""
    with open(file_path, "rb") as f:
        return f.read()

def generate_img2img_generation_jobs_with_kandinsky(image_embedding,
                                                    negative_image_embedding,
                                                    dataset_name,
                                                    prompt_generation_policy,
                                                    self_training= False,
                                                    init_img_path="./test/test_inpainting/white_512x512.jpg"):

    # get sequential ids
    sequential_ids = request.http_get_sequential_id(dataset_name, 1)

    count = 0
    # generate UUID
    task_uuid = str(uuid.uuid4())
    task_type = "img2img_generation_kandinsky"
    model_name = "kandinsky_2_2"
    model_file_name = "kandinsky-2-2-decoder"
    model_file_path = "input/model/kandinsky/kandinsky-2-2-decoder"
    task_input_dict = {
        "strength": 0.75,
        "seed": "",
        "dataset": dataset_name,
        "file_path": sequential_ids[count]+".jpg",
        "init_img": init_img_path,
        "num_images": 1,
        "image_width": 512,
        "image_height": 512,
        "decoder_steps": 100,
        "decoder_guidance_scale": 12,
        "self_training": self_training
    }

    prompt_generation_data={
        "prompt_generation_policy": prompt_generation_policy
    }

    image_embedding= image_embedding.detach().cpu().numpy().tolist()[0]
    negative_image_embedding= image_embedding.detach().cpu().numpy().tolist()[0] if negative_image_embedding is not None else None

    # create the job
    generation_task = GenerationTask(uuid=task_uuid,
                                     task_type=task_type,
                                     model_name=model_name,
                                     model_file_name=model_file_name,
                                     model_file_path=model_file_path,
                                     task_input_dict=task_input_dict,
                                     prompt_generation_data=prompt_generation_data)
    generation_task_json = generation_task.to_dict()

    # add job
    response = generation_request.http_add_kandinsky_job(job=generation_task_json,
                                                         positive_embedding=image_embedding,
                                                         negative_embedding=negative_image_embedding)

    return response


if __name__ == "__main__":
    image_embedding_list = [-0.45251402759317433, 0.13531184263855703, -0.5308387672743391, -0.23861723019145537, 0.16341507149425732, 0.23900755281445119, -0.12483818558816871, 0.12613926099815484, -0.5787183423618285, -0.21753980854968014, -0.22612690625558857, -0.5219914544864335, 0.12321184132568605, 0.10239463476590806, 0.28207314888499196, 0.27582798691705857, -0.13036775608060974, 0.08014624525514531, 0.22183335740263435, 0.00901807893546633, -0.20504948461381334, 0.07006291082775284, -0.3015892800347838, -0.18449249313603255, 0.16861937313420183, -0.020378093608907685, 0.27374626626108073, -0.3002882046247977, -0.40177208660371544, 0.060727694761102395, -0.15560861903434056, -0.6198323253173901, -0.2296398098625511, -0.3242279921685424, 0.25917422166923615, 0.020524464592531124, 0.15951184526429896, -0.02992473442968088, 0.08411452525560299, 0.4387226282473214, 0.26750110429314733, 0.0809919442716363, -0.12210592722719785, -0.06264678099083193, 0.20622045248280085, 0.10057312919192747, -0.7265205089362523, -0.3395806820063787, -0.03052648180679946, -0.2877978806889309, 0.12021936788271796, -0.43195703611539354, -0.2982064839688199, -0.17798711608610193, 0.04300054230004144, 0.205830129859805, -0.4218086479175018, -0.09432796722399407, 0.05971936131836315, 0.14650109116443769, -0.08144732066513144, -0.010977823771757931, 1.096025925372312, -0.14428926296746128, 0.08274839607511757, 0.025826346888224584, 0.10837958165184423, -0.12073979804671242, -0.2546204577342847, 0.10057312919192747, 0.2560516406852694, 0.1986742151048813, 0.37783229905997073, 0.006863172787676811, -0.2530591672423014, 0.0904247409940357, 0.39630756988177374, 0.07299033050022162, 0.2701032551131196, -0.567789308917945, -0.4124409049656017, -0.08014624525514531, -0.2527989521603041, -0.025289653281605307, -0.11358388329178873, 0.27192476068710014, 0.688008676800663, 0.4147828407035767, 0.15040431739439608, 0.2953441180668504, -0.03399059508588752, 0.05549086623590824, -0.4215484328355046, 0.1640656091992504, -0.2598247593742292, 0.010571237706137267, -0.14897313444341134, 0.2265172288785844, -0.41035918430962387, -0.36404089971411785, -0.27062368527711406, -0.2420000262574193, -0.09927205378194136, -0.3744495029940068, 0.5558194151460727, -0.017792206231560262, -0.22508604592759965, 0.07220968525422995, -0.4936280105487359, 0.19073765510396595, -0.2620365875712056, -0.3114774531506784, 0.1984140000228841, -0.31512046429863955, -0.06625726525354343, -0.13752367083553343, 0.4696882230049912, 0.08300861115711479, 0.07442151345120636, -0.07819463214016613, 0.13882474624551955, -0.26984304003112236, -0.1371333482125376, 0.24134948855242622, -0.2420000262574193, -0.018117475084056794, -0.026021508199722505, 0.32084519610257844, 0.330733369218473, 0.06908710427026325, 0.01949986770716705, -0.30210971019877825, 0.0945881823059913, -0.06915215804076255, -0.32578928266052576, -0.4225892931634935, 0.0053181457383182865, 0.05939409246586661, -0.16861937313420183, -0.3609183187301511, 0.8056258938634088, 0.6375269508932013, -0.0945881823059913, -0.08483011673109536, -0.2295097023215525, -0.41426241053958224, 0.5232925298964195, 0.3182430452826062, -0.09614947279797466, 0.19763335477689242, -0.18267098756205197, -0.16861937313420183, -0.05601129639990269, 0.7088258833604411, -0.26724088921115013, 0.15131507018138635, -0.09706022558496494, -0.2140269049427176, 0.38017423479794576, -0.11930861509572768, -0.0067289993860219915, -0.02333804016662612, 0.2140269049427176, -0.28337422429497805, 0.24473228461839014, -0.2794709980650197, 0.11169732394730884, -0.2508473390453249, -0.26255701773520007, 0.007729201107448825, -0.11345377575079012, -0.011758469017749606, -0.012750539017864026, 0.10324033378239904, -0.3002882046247977, -0.1247731318176694, 0.30471186101875053, -0.21454733510671203, 0.18345163280804366, -0.0696075344342577, -0.26424841576818203, 0.3905828380778348, 0.005964617582655143, -0.4108796144736183, -0.08873334296105374, 0.029697046232933306, 0.22846884199356357, -0.09751560197846008, -0.06804624394227435, 0.21766991609067873, -0.25214841445531105, 0.11436452853778041, 0.3458258439743121, 0.4467892957892354, -0.05402715639967385, -0.07513710492669873, -0.32162584134857014, -0.15105485509938912, -0.3026301403627727, 0.7848086873036307, -0.07103871738524244, 0.03737339115185145, -1.0242065627410777, -0.12529356198166386, -0.08170753574712866, 0.1934699134649368, -0.050416672136962354, -0.2638580931451862, 1.520696939191783, -0.10772904394685116, -0.2745269115070724, 0.24369142429040125, 0.008635888033782907, -0.2422602413394165, 0.23861723019145537, -0.053701887547177314, -0.22625701379658716, -0.31538067938063674, -0.08483011673109536, 0.016165861969077606, 0.28961938626291145, -0.11774732460374433, -0.6364860905652124, 0.1902172249399715, 0.2297699174035497, -0.1600322754282934, -0.07956076132065155, 0.045440058693765426, 0.667191470240885, -0.3315140144644647, 0.7119484643444077, 0.03669032656160873, -0.04017070328332162, 0.0925064616500135, -0.03296599820052345, 0.2677613193751446, -0.1267247449326486, 0.45043230693719655, 0.12288657247318953, -0.19685270953090075, -0.0612806518103465, -0.30106884987078936, -0.4072366033256572, 0.17863765379109497, 0.30080863478879216, -0.13082313247410488, -0.22222368002563017, 0.056499199678647485, 0.32604949774252295, 0.4270129495574463, 0.03503145541387642, 0.792094709599553, -0.6036989902335621, 0.35181079086024825, -0.2732258360970863, -0.4418452092312881, -0.36430111479611504, 0.09601936525697603, -0.4564172538231327, 0.04313064984104005, 0.02489933065860947, -0.45225381251117713, -0.36143874889414557, -0.03974785377507613, -0.5750753312138673, -0.45147316726518544, -0.5297979069463502, 0.08853818164955582, 0.32266670167655903, -0.23042045510854278, -0.6749979227008017, 0.05880860853137286, -0.09504355869948644, 0.18527313838202422, -0.24603336002837628, -0.15834087739531144, -0.42102800267151014, 0.49128607481076086, 0.2745269115070724, 0.3666430505340901, -0.450952737101191, 0.2872774505249364, -0.13147367017909795, 0.21220539936873703, 0.43169682103339635, -0.10642796853686504, 0.34348390823633707, 0.07598280394318971, 0.35727530758218995, 0.4863419882528136, 0.10532205443837683, -1.1033119476682343, -0.35883659807417334, -0.31460003413464505, -0.060890329187350656, -0.25514088789827916, 0.12861130427712847, 0.014832259673841827, -0.27530755675306406, 0.12613926099815484, 0.1986742151048813, 0.00837567295178568, 0.08125215935363352, 0.2888387410169198, 0.34530541381031765, -0.18670432133300896, -0.15847098493631004, 0.0967349567324684, -0.28753766560693367, 0.10226452722490945, -0.7010194309005242, -0.007379537091015053, 0.4168645613595545, -0.1986742151048813, 0.5542581246540893, -0.2989871292148116, -0.2472043278973638, 0.320324765938584, -0.1725225993641602, 0.2802516433110114, 0.06365511443357118, -0.48686241841680805, 0.018914383772673293, 0.018914383772673293, -0.8618323515748093, 0.06876183541776672, 0.45771832923311884, 0.034836294102378505, 0.1622441036252698, 0.042675273447544904, 0.01733682983806512, 0.16861937313420183, 0.14832259673841827, -0.08411452525560299, -0.4168645613595545, 0.02377715311749644, 0.8581893404268481, 0.09114033246952807, -0.6973764197525631, -0.07292527672972232, 1.2438280919467357, 0.018345163280804364, -0.5776774820338396, 0.6900903974566408, 0.017385620165939596, -0.18527313838202422, -0.32162584134857014, 0.31251831347866726, 0.3270903580705119, -0.07591775017269041, 0.3546731567622177, -0.08040646033714254, -0.49857209710668315, -0.07058334099174729, -0.22820862691156635, -0.20543980723680916, -0.23536454166649004, 0.18657421379201036, 0.033437638036643416, 0.037991401971594854, -0.26320755544019314, -0.09927205378194136, 0.8118710558313421, 0.22872905707556082, -0.3502495003682649, 0.18982690231697566, -0.2742666964250752, 0.28207314888499196, -0.38615918168388197, 0.4002107961117321, -0.07266506164772508, -0.15990216788729478, -0.2818129338029947, 0.2608656197022181, 0.1517053928043822, -0.5045570439926194, -0.5152258623545056, -0.05984946885936176, -0.35987745840216223, 0.5610237167860171, 0.47463230956293845, 0.08300861115711479, -0.35076993053225936, -0.14311829509847376, 0.12230108853869577, 0.21350647477872314, 0.5108022059605527, -0.028054438527825826, 0.6416903922051569, -0.03649516525011081, -0.4959699462867109, 0.4592796197251022, -0.3031505705267672, 0.042675273447544904, 0.07793441705816889, 0.15144517772238497, -0.6682323305688739, 0.2244355082226066, 0.16159356592027674, -0.12483818558816871, -0.0758526964021911, -0.812911916159331, -0.34556562889231485, -0.27166454560510295, -0.18566346100502007, -0.2556613180622736, 0.2901398164269059, 0.32084519610257844, 0.26424841576818203, 0.008928630001029784, -0.20648066756479808, 0.11416936722628249, 0.29846669905081713, 0.1517053928043822, -0.20908281838477033, -0.5729936105578896, 0.5813204931818007, -0.5284968315363641, -0.2950839029848532, 0.13140861640859863, 0.6437721128611348, 0.018101211641431966, 0.1164462491937582, -0.03773118688959763, -0.6599054479449626, -0.12464302427667079, -0.050872048530457493, 0.12900162690012432, -0.19477098887492295, 0.2877978806889309, 0.21688927084468707, -0.24134948855242622, -0.058060490170630835, 0.11390915214428526, 0.19815378494088687, -0.30002798954280047, 0.05698710295739228, 0.03376290688913995, -0.44314628464127426, -0.1173570019807485, 0.3192839056105951, 0.13973549903250984, -0.33515702561242583, 0.10668818361886226, 0.08983925705954195, -0.1952914190389174, 0.2714043305231057, 0.14077635936049873, -0.08756237509206623, -0.12665969116214928, -0.10948549575033244, -0.050254037710714086, -0.3177226151186118, -0.13043280985110906, -0.4311763908694019, 0.002091885307618317, -0.23458389642049837, 0.08970914951854334, -0.23224196068252334, -0.10681829115986088, 0.18930647215298121, -0.08769248263306484, -0.040788714103065025, -0.14559033837744742, -0.2357548642894859, 0.05747500623613708, -0.13492152001556118, 0.4384624131653242, -0.5776774820338396, 0.2564419633082653, 0.16874948067520043, 0.05923145803961835, -0.2201419593696524, 0.30549250626474217, 0.4454882203792493, -0.3635204695501234, 0.16913980329819628, 0.13856453116352233, 0.17057098624918102, -0.526154895798389, -0.16029249051029063, -0.20726131281078974, 0.13661291804854314, -0.09374248328950031, -0.1102010872258248, -0.4866022033348108, 0.22196346494363295, 0.04583038131676126, 0.24356131674940262, 0.48061725644887465, 0.2969054085588338, 0.18241077248005474, 0.00951411393552354, -0.12041452919421589, -0.20517959215481194, -0.027111158855585883, 0.1350516275565598, 0.3174624000366145, 0.36247960922213446, 0.07943065377965294, -0.24460217707739154, -0.33723874626840367, 0.13544195017955563, 0.28207314888499196, -0.008717205246907039, -0.30757422692072, -0.024427690822489502, 0.30549250626474217, 0.16497636198624066, 0.12705001378514513, -0.020800943117153175, -0.07299033050022162, 0.3726279974200263, -0.21753980854968014, -0.23523443412549144, -0.060727694761102395, 0.12718012132614373, -0.6822839449967241, 0.20504948461381334, 0.058906189187121816, 0.11312850689829358, 0.0076804107795743455, 0.22586669117359134, -0.36430111479611504, -0.44783015611722427, 0.15847098493631004, -0.014563912870532188, -0.4363806925093464, -0.17317313706915327, -0.006119120287590995, -0.4376817679193325, 0.2317215305185289, -0.5735140407218839, 0.4811376866128691, -0.030835487216671165, 0.004476512582483512, 0.0014555781149219777, 0.23991830560144148, 0.23367314363350808, 0.39006240791384034, 0.46214198562707165, 0.3096559475766978, 0.6146280236774455, -0.4054150977516766, -0.1360924878845487, 0.2836344393769753, -0.030168686069053277, -0.0915957088630232, 0.1341408747695695, 0.41920649709752955, 0.14311829509847376, -0.046318284595506055, -0.14819248919741965, 0.03020121295430293, -0.045179843611768196, -0.012140659919433031, -0.24434196199539432, -0.11592581902976376, 0.4061957429976683, -0.35441294168022053, 0.15313657575536693, 0.06785108263077642, -0.409318323981635, -0.27192476068710014, -0.08892850427255165, 0.19464088133392432, 0.5139247869445195, -0.28597637511495033, -0.38095488004393746, -0.043911295087031725, -0.315640894462634, -0.08535054689508981, -0.19190862297295347, 0.07526721246769734, -0.2917011069188893, -0.49831188202468596, 0.26320755544019314, -0.2585236839642431, 0.31225809839667007, -0.11878818493173322, -0.23926776789644844, 0.33203444462845916, 0.16172367346127536, 0.2224838951076274, 0.07461667476270428, -0.03919489672583202, 0.12815592788363334, -0.2940430426568643, 0.2099935711717606, -0.24772475806135824, -0.393184988897807, -0.11508012001327278, 0.05275860787493738, 0.5253742505523974, 0.1671881901832171, 0.02751774492120655, 0.11690162558725335, 0.3718473521740346, 0.4855613430068219, 0.13153872394959726, 0.10083334427392471, 0.05900376984287078, -0.013051412706423317, 0.49388822563073315, 0.30289035544476994, 0.6260774872853234, 0.3710667069280429, -0.5657075882619672, -0.047326618038245304, -0.24265056396241236, -0.0055661632383468915, -0.1154053888657693, -0.10102850558542262, 0.10597259214336989, 0.17304302952815465, 0.24213013379841788, -0.1559989416573364, 0.3429634780723426, -0.28675702036094197, -0.026574465248966606, 0.2589140065872389, 0.1506645324763933, 0.3858989666018847, 0.21910109904166347, -0.30210971019877825, -0.15990216788729478, -0.09088011738753085, 0.028623659019694755, 0.03062406246254842, 0.23055056264954138, 0.315640894462634, 0.0161008081985783, -0.04215484328355046, 0.5771570518698451, 0.01347426221466881, -0.11560055017726723, 0.08509033181309258, -0.10057312919192747, 0.4571978990691244, 0.3505097154502621, -0.08613119214108149, 0.6333635095812458, 0.3333355200384453, -0.3999505810297349, -0.23627529445348033, 0.31251831347866726, -0.3486882098762816, -0.12444786296517288, 0.4564172538231327, 0.10792420525834909, 0.19477098887492295, -0.2524086295373083, 0.03197392820040903, 0.10428119411038793, 0.08086183673063768, 0.1351817350975584, -0.03782876754534659, -0.0478145213169901, -0.6739570623728128, -0.016092676477265887, -0.24889572593034576, -0.07637312656618554, -0.07006291082775284, -0.08437474033760022, 0.035421778036872256, 0.038121509512593466, 0.1060376459138692, -0.3606581036481539, -0.030998121642919433, 0.007155914754923689, 0.1787677613320936, 0.06658253410603995, 0.5844430741657675, -0.19399034362893128, 0.49414844071273034, -0.1463709836234391, 0.1610731357562823, -0.09406775214199685, -0.1102010872258248, 0.234714003961497, 0.3484279947942843, -0.07741398689417445, -0.02717621262608519, -0.18514303084102562, -0.3127785285606645, 0.4884237089087914, -0.14272797247547794, 0.02319166918300268, 0.6328430794172513, 0.22885916461655942, -0.23679572461747478, -0.5279764013723696, 0.05897124295762112, 0.05513307049816205, 0.01449072737872047, 0.09966237640493719, -0.19451077379292572, 0.014450068772158403, 0.1872247514970034, -0.38277638561791805, 0.11397420591478456, 0.3273505731525091, 0.00476925454973039, 0.04918065049747553, 0.022671239019008232, 0.07188441640173342, 0.29924734429680877, -0.12184571214520062, -0.5735140407218839, 0.026054035084972157, -0.40255273184970713, 0.23640540199447896, 0.16484625444524206, 0.14311829509847376, -0.30471186101875053, 0.0862612996820801, -0.12939194952312014, 0.11768227083324502, 0.4954495161227165, 0.22495593838660105, 0.06980269574575562, -0.5610237167860171, 0.087302160010069, -0.17603550297112275, -0.18696453641500618, -0.4179054216875434, 0.18150001969306445, -0.16679786756022125, 0.149753779689403, 0.01845900737917815, -0.38017423479794576, 0.013913375165539126, -0.4153032708675712, -0.3505097154502621, 0.11878818493173322, 0.3367183161044092, -0.13882474624551955, 0.5251140354704001, -0.0639153295155684, 0.12386237903067912, 0.05477527476041587, -0.0027810486888453427, -0.0914005475515253, 0.06300457672857811, -0.5646667279339783, 0.1787677613320936, -0.2326322833055192, 0.10271990361840458, -0.009050605820715983, 0.16367528657625455, 0.41400219545758504, -0.24147959609342484, 0.07513710492669873, -0.3432236931543398, 0.13635270296654592, 0.1267247449326486, 0.23679572461747478, 0.0275502718064562, 0.3669032656160873, 0.08931882689554749, 0.6468946938451015, 0.18358174034904226, 0.09289678427300933, -0.2645086308501792, 0.08645646099357802, 0.04215484328355046, -0.3611785338121484, 0.35519358692621217, -0.26060540462022086, -0.4108796144736183, -0.03864193967658792, 0.21376668986072037, 0.35285165118823714, 0.04693629541524947, -0.038121509512593466, 0.26281723281719727, -0.34530541381031765, -0.3557140170902066, -0.13069302493310628, 0.21558819543470095, 0.6911312577846297, 0.1287414118181271, -0.15521829641134474, -0.0410164022998126, 0.029615729019809175, -0.42649251939345184, -0.04566774689051299, 0.3356774557764203, 0.558421565966045, -0.021272582953273146, 0.22508604592759965, 0.4311763908694019, 0.0415693593490567, 0.3138193888886534, 0.20023550559686468, -0.10727366755335602, -0.06632231902404273, 0.25331938232429857, 0.07617796525468763, -0.05061183344846027, -0.3731484275840207, 0.14259786493447932, 0.03143723459378975, 0.06941237312275977, -0.28207314888499196, 0.12594409968665693, 0.027241266396584495, 0.07500699738570012, 0.06928226558176116, -0.6854065259806907, -0.07429140591020775, 0.08964409574804402, 0.020979840986026267, 0.12386237903067912, -0.5152258623545056, 0.015726749018207288, -0.24382153183139987, -0.12731022886714236, -0.2067408826467953, 0.34270326299034537, 0.23991830560144148, -0.2633376629811917, -0.3315140144644647, 0.07318549181171954, 0.7416129836920914, 0.0561414039409013, 0.40697638824365995, -0.27270540593309184, -0.1476720590334252, 0.3557140170902066, -0.01280746106705092, -0.3406215423343676, 0.6609463082729516, 0.012474060493241975, -0.2940430426568643, 0.220272066910651, -0.2641183082271834, -0.3450451987283204, 0.23809680002746092, 0.23419357379750252, -0.08326882623911201, -0.01875174934642503, 0.24980647871733602, 0.1600322754282934, 0.09920700001144205, 0.38095488004393746, -0.19151830034995762, -0.07962581509115087, -0.17915808395508945, 0.27608820199905576, 0.4954495161227165, 0.0706483947622466, 0.16081292067428507, -0.16588711477323095, -0.2028376564168369, -0.6760387830287906, 0.09940216132293997, -0.19581184920291184, 0.3973484302097626, -0.04059355279156711, 0.20609034494180223, -0.16341507149425732, 0.15443765116535307, 0.5123634964525361, 0.15196560788637942, -0.04322823049678901, 0.41426241053958224, -0.2500666937993333, -0.08086183673063768, -0.13531184263855703, 0.26255701773520007, 0.2969054085588338, -0.07116882492624105, 0.1445494780494585, 0.0904247409940357, -0.035844627545117747, -0.4819183318588608, 0.1256838846046597, 0.15769033969031837, 0.28337422429497805, 0.10337044132339765, 0.7744000840237417, 0.03929247738158098, 0.19242905313694791, -0.10083334427392471, 0.09380753705999963, 0.038967208529084446, -0.21793013117267596, 0.33385595020243974, 0.1299774334576139, -0.34634627413830654, -0.06531398558130348, 0.2295097023215525, 0.19594195674391046, -0.5500946833421337, 0.11455968984927832, 0.3999505810297349, -0.1319290465725931, -0.08684678361657386, -0.21910109904166347, -0.24134948855242622, -0.1526161455913725, -0.19242905313694791, -0.18345163280804366, -0.20752152789278697, 0.6401291017131736, -0.14220754231148347, -0.1774666859221075, 0.5219914544864335, 0.15131507018138635, 0.17447421247913938, -0.3564946623361983, -0.2669806741291529, -0.640649531877168, -0.35779573774618445, -0.3721075672560318, 0.3078344420027172, 0.469428007922994, 0.056791941645894364, 0.1526161455913725, -0.17408388985614354, -0.04508226295601924, 0.17798711608610193, -0.06385027574506909, -0.1276354977196389, -0.1671881901832171, 0.09790592460145592, 0.17733657838110886, -0.10330538755289834, 0.3947462793897904, -0.2014064734658522, 0.6042194203975565, 0.12119517444020757, -0.027664115904829988, -0.11833280853823809, 0.1383043160815251, -0.2420000262574193, 0.3762710085679874, -0.4707290833329801, -0.6031785600695676, 0.04612312328400814, 0.4626624157910661, -0.17304302952815465, -0.25032690888133047, 0.24160970363442344, 0.19008711739897288, -0.1401258216555057, -0.2961247633128421, -0.02263871213375858, -0.19490109641592154, 0.03392554131538821, 0.81863664796327, -0.0956290426339802, -0.004342339180828693, -0.4553763934951438, -0.4855613430068219, -0.020963577543401442, -0.13778388591753066, 0.1704408787081824, -0.482178546940858, 0.22417529314060938, -0.11670646427575543, 0.2170193783856857, 0.2099935711717606, -0.12139033575170548, 0.1805892669060742, 0.19984518297386883, -0.23068067019054, 0.8103097653393587, 0.2431709941264068, -0.27166454560510295, 0.14402904788546406, 0.3976086452917599, -0.29664519347683654, -0.18097958952907, 0.19763335477689242, -0.21272582953273148, 0.11579571148876514, 0.23315271346951363, -0.10415108656938932, -0.36221939414013726, -0.1322543154250896, 0.19932475280987438, 0.014815996231217, -0.06882688918826602, -0.01836142672342919, -0.42050757250751564, 0.6755183528647962, -0.2943032577388615, 0.19164840789095625, 0.2431709941264068, 0.06319973804007603, -0.059881995744611415, 0.11599087280026306, -0.23926776789644844, -0.18969679477597706, 0.12522850821116455, 0.5579011358020505, 0.21858066887766903, 0.31017637774069223, -0.17616561051212135, 0.20713120526979112, 0.3520710059422455, 0.19776346231789102, -0.47359144923494956, 0.35883659807417334, 0.21597851805769677, -0.18423227805403533, -0.0685666741062688, -0.24434196199539432, -0.4410645639852964, -0.23861723019145537, 0.09302689181400794, -0.6411699620411625, -0.5131441416985277, 0.18345163280804366, 0.025257126396355654, 0.05022151082546443, -0.20088604330185772, 0.15938173772330033, 0.2129860446147287, -0.1766860406761158, 0.28337422429497805, 0.6573032971249905, 0.11189248525880677, 0.055328231809659977, 0.1517053928043822, -0.41660434627755727, 0.2076516354337856, -0.3505097154502621, -0.09680001050296771, 0.011075404427506891, -0.0535717800061787, -0.07689355673018, 0.18618389116901451, -0.4894645692367803, -0.21988174428765517, 0.0955639888634809, 0.24694411281536657, 0.2485054033073499, -0.14871291936141412, -0.32058498102058125, 0.20570002231880638, 0.043195703611539356, -0.1309532400151035, -0.4488710164452132, 0.42206886299949903, -0.009920700001144204, 0.24525271478238458, 0.27270540593309184, 0.12340700263718397, 0.24382153183139987, -0.1589914151003045, 0.04189462820155323, 0.05858092033462529, 0.4535548879211632, 0.23653550953547756, 0.06681022230278753, -0.2805118583930086, -0.3421828328263509, -0.3856387515198875, -0.03077043344617186, 0.05188038197319674, 0.10063818296242678, 0.15378711346036, 0.024639115576612247, -0.28597637511495033, 0.261906480030207, -0.27686884724504746, 0.32761078823450634, 0.21806023871367458, -0.1215854970632034, -0.2080419580567814, 0.2400484131424401, -0.21259572199173285, -0.049733607546719634, -0.19698281707189935, -0.20101615084285634, -0.3140796039706506, 0.0202642495105339, 0.5984946885936175, 0.10532205443837683, -0.21793013117267596, -0.6187914649894012, 0.7733592236957528, -0.1622441036252698, -0.013116466476922625, -0.2794709980650197, 0.19490109641592154, -0.4564172538231327, -0.1570398019853253, 0.1102661409963241, 0.15235593050937526, 0.10974571083232966, 0.15014410231239886, -0.22885916461655942, 0.027875540658952733, -0.4311763908694019, 0.22898927215755804, -0.1467613062464349, 0.2076516354337856, 0.30809465708471445, -0.17213227674116435, -0.033860487544888906, -0.13856453116352233, 0.10779409771735048, 0.06733065246678198, -0.04270780033279456, 0.23224196068252334, -0.14077635936049873, 0.4061957429976683, -0.3999505810297349, 0.025403497379979094, -0.21493765772970788, 0.26724088921115013, 0.30080863478879216, 0.22274411018962464, 0.15560861903434056, -0.10239463476590806, -0.08170753574712866, -0.1296521646051174, 0.1350516275565598, -0.11189248525880677, -0.12126022821070687, -0.39526670955378485, 0.14194732722948625, 0.3921441285698181, 0.18423227805403533, -0.6042194203975565, -0.5227720997324251, -0.1122177541113033, 0.3796538046339513, -0.003000605164280501, 0.44939144660920766, 0.08437474033760022, 0.12080485181721172, 0.3255290675785285, 0.053246511153682174, -0.5495742531781392, -0.07318549181171954, 0.2236548629766149, -0.26281723281719727, 0.4837398374328413, -1.2355012093228246, -0.24173981117542206, -0.27608820199905576, 0.3159011095446312, -0.48868392399078864, 0.2630774478991945, 0.02911156229843955, 0.16510646952723929, -0.048692747218730736, -0.2472043278973638, -0.08443979410809953, -0.6229549063013567, -0.11390915214428526, 0.47098929841497733, 0.24278067150341096, 0.1256188308341604, -0.4915462898927581, 0.2036183016628286, 0.22846884199356357, -0.2721849757690974, -0.2077817429747842, -0.032608202462777264, -0.12178065837470131, 0.038088982627343816, -0.3783527292239652, 0.018198792297180928, -0.4020323016857127, 0.3796538046339513, -0.046611026562752934, 0.024021104756868836, -0.5636258676059894, -0.0914005475515253, -0.17174195411816853, -0.023403093937125426, -0.22118281969764128, 0.2825935790489864, 0.16744840526521432, 0.12178065837470131, -0.4436667148052687, 0.05340914557993044, -0.09153065509252391, -0.19880432264587994, -0.32162584134857014, -0.2932623974108726, 0.4543355331671549, 0.5391656498982503, 0.19893443018687854, -0.04020323016857127, -0.23640540199447896, 0.17213227674116435, -0.09627958033897327, -0.05376694131767663, 0.08014624525514531, -0.268281749539139, -0.1725225993641602, -0.37653122364998465, 0.27504734167106687, -0.4218086479175018, 0.16172367346127536, 0.17213227674116435, -0.45069252201919374, -0.025696239347225973, 0.21871077641866765, -0.28857852593492256, -0.5022151082546443, 0.26580970626016537, -0.2526688446193055, -0.26958282494912517, -0.10961560329133105, -0.016962770657694106, 0.32500863741453406, 0.14585055345944464, -0.5428086610462114, -0.1463709836234391, 0.07422635213970845, -0.5761161915418562, -0.21220539936873703, 0.20257744133483968, 0.28233336396698916, 0.3731484275840207, 0.14884302690241272, 0.11950377640722559, -0.6182710348254067, -0.024134948855242623, 0.017580781477437517, 0.02732258360970863, 0.20478926953181611, -0.08346398755060994, 0.6604258781089571, 0.006054066517091688, 0.11729194821024919, -0.8238409496032145, -0.3458258439743121, 0.2524086295373083, -0.12529356198166386, -0.2526688446193055, -0.05227070459619258, 0.06967258820475701, -0.4020323016857127, 0.031355917380665614, 0.20739142035178834, -0.10174409706091499, 0.2667204590471557, -0.1870946439560048, 0.16926991083919488, -0.1444193705084599, -0.08053656787814115, -0.16133335083827952, 0.023289249838751643, 0.045049736070769585, -0.0016883486374898078, -0.1818903423160603, 0.5186086584204695, -0.06316721115482637, 0.2901398164269059, -0.06580188886004829, -0.4345591869353658, -0.25175809183231523, 0.04368360689028415, 0.5969333981016343, 0.35076993053225936, 0.06817635148327296, -0.16510646952723929, -0.04000806885707335, 0.3512903606962538, 0.13349033706457644, 0.13960539149151124, 0.14897313444341134, -0.3190236905285979, -0.5027355384186388, 0.03356774557764203, 0.594331247281662, -0.42545165906546295, 0.3023699252807755, 0.1018742046019136, -0.6010968394135898, 0.20257744133483968]
    image_embedding_tensor = torch.tensor(image_embedding_list)
    normalized_tensor = torch.nn.functional.normalize(image_embedding_tensor, p=2, dim=0)
    image_embedding_tensor = torch.unsqueeze(image_embedding_tensor, 0)
    negative_image_embedding = None
    prompt_generation_policy = "top-k"

    # Generate img2img generation jobs with Kandinsky using the embeddings
    response = generate_img2img_generation_jobs_with_kandinsky(
        image_embedding=image_embedding_tensor,
        negative_image_embedding = None,  
        dataset_name="test-generations",
        prompt_generation_policy=prompt_generation_policy
    )

    print(response)